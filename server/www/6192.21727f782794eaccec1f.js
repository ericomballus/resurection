(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[6192],{6192:(i,t,e)=>{"use strict";e.r(t),e.d(t,{FichePointagePageModule:()=>y});var o=e(1511),n=e(6073),s=e(8158),r=e(8777),c=e(4762),a=e(1572),l=e(4144),h=e(731),d=e(1064),g=e(2874),u=e(4375),p=e(754),f=e(2968),m=e(4069);function Z(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-button",9),a.NdJ("click",function(){return a.CHM(i),a.oxw().updateFiche()}),a._uU(1),a.ALo(2,"translate"),a.qZA()}2&i&&(a.xp6(1),a.Oqu(a.lcZ(2,1,"MENU.update")))}function S(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-button",10),a.NdJ("click",function(){return a.CHM(i),a.oxw().saveFiche()}),a._uU(1,"Enregistrer"),a.qZA()}}function v(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-button",10),a.NdJ("click",function(){return a.CHM(i),a.oxw().createFiche()}),a._uU(1,"Enregistrer"),a.qZA()}}function b(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-button",10),a.NdJ("click",function(){return a.CHM(i),a.oxw().closeFiche()}),a._uU(1,"Terminer"),a.qZA()}}function T(i,t){1&i&&a._UZ(0,"ion-input",17)}function L(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-input",14),a.NdJ("ionChange",function(t){a.CHM(i);const e=a.oxw(),o=e.$implicit,n=e.index;return a.oxw().getStockFinale(t,o,n)}),a.qZA()}}const q=function(i){return{"background-color":i}};function A(i,t){if(1&i){const i=a.EpF();a.TgZ(0,"ion-row",11),a.TgZ(1,"ion-col",12),a.TgZ(2,"div",13),a._uU(3),a.qZA(),a.qZA(),a.TgZ(4,"ion-col",12),a.TgZ(5,"div",7),a._uU(6),a.qZA(),a.qZA(),a.TgZ(7,"ion-col",12),a.TgZ(8,"div",7),a.TgZ(9,"ion-input",14),a.NdJ("ionChange",function(e){a.CHM(i);const o=t.$implicit,n=t.index;return a.oxw().addIncrementProductService(e,o,n)}),a.qZA(),a.qZA(),a.qZA(),a.TgZ(10,"ion-col",12),a.TgZ(11,"div",7),a._uU(12),a.qZA(),a.qZA(),a.TgZ(13,"ion-col",12),a.TgZ(14,"div",7),a.YNc(15,T,1,0,"ion-input",15),a.YNc(16,L,1,0,"ion-input",16),a.qZA(),a.qZA(),a.TgZ(17,"ion-col",12),a.TgZ(18,"div",7),a._uU(19),a.qZA(),a.qZA(),a.qZA()}if(2&i){const i=t.$implicit,e=t.index,o=a.oxw();a.Q6J("ngStyle",a.VKq(7,q,e%2==0?"#f1f1f1":"white")),a.xp6(3),a.hij(" ",i.name," "),a.xp6(3),a.hij(" ",i.quantityStore?i.quantityStore:0," "),a.xp6(6),a.hij(" ",i.pointage?i.pointage:0," "),a.xp6(3),a.Q6J("ngIf",o.isOpen),a.xp6(1),a.Q6J("ngIf",!o.isOpen),a.xp6(3),a.hij(" ",i.ventes?i.ventes:0," ")}}const k=[{path:"",component:(()=>{class i{constructor(i,t,e,o,n,s,r,c,a){this.restApiService=i,this.translateConfigService=t,this.translate=e,this.notification=o,this.randomStorage=n,this.ficheService=s,this.urlService=r,this.location=c,this.servicelistService=a,this.productsServices=[],this.storeTypes=[],this.randomObj={},this.firstTime=!1,this.isOpen=!0,this.confirm=!1,this.lastFiche=[]}ngOnInit(){this.randomStorage.getSetting(),this.storeTypes=this.randomStorage.getAdminAccount().storeType,1==this.storeTypes.length&&this.storeTypes.includes("services"),this.takeFichePointage(),this.storeTypes.includes("services")}takeUrl(){this.urlService.getUrl().subscribe(i=>{this.url=i,this.adminId=localStorage.getItem("adminId")})}takeFichePointage(){this.notification.presentLoading(),this.ficheService.getPointageList().subscribe(i=>{let t=this.randomStorage.getStoreId();i.length&&(i=i.filter(i=>i.storeId==t)),this.notification.dismissLoading(),console.log("fiche pointage",i),i.length?(this.fiche=i[0],this.productsServices=i[0].list):this.notification.presentAlertConfirm("aucune fiche de pointage ouverte cr\xe9er une nouvelle fiche a partir des stocks actuelles ?","Oui","Non").then(i=>{this.firstTime=!0,this.notification.presentLoading(),this.takeLastFiche()}).catch(i=>{})},i=>{this.notification.dismissLoading(),console.log(i)})}takeLastFiche(){this.ficheService.getLastFiche().subscribe(i=>{console.log("la dernier fiche ici==>",i),0==i.length?this.takeProductServiceList():(i[0].list.forEach(i=>{i.quantityStore=i.stockFinale,i.pointage=0,i.ventes=0,i.pointageList=[],i.stockFinale=0,i.stockFinaleList=[]}),this.productsServices=i[0].list,this.notification.dismissLoading())})}languageChanged(){console.log("lang shop page");let i=localStorage.getItem("language");i&&this.translateConfigService.setLanguage(i)}takeProductServiceList(){let i=JSON.parse(localStorage.getItem("user")).storeId;this.restApiService.getBillardList().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){let e=t.product;e=this.randomStorage.getSuperManager()?t.product.sort((i,t)=>i.name>t.name?1:-1):t.product.filter(t=>t.storeId===i),this.productsServices=e,this.sortProductItem()}),i=>{console.log(i),this.notification.dismissLoading()})}sortProductItem(){this.productsServices=this.productsServices.sort((i,t)=>i.name.toLocaleLowerCase()>t.name.toLocaleLowerCase()?1:i.name.toLocaleLowerCase()<t.name.toLocaleLowerCase()?-1:0),this.notification.dismissLoading()}updateFiche(){this.notification.presentLoading(),this.fiche.list=this.productsServices,this.ficheService.updateFichePointage(this.fiche).subscribe(i=>{this.generateArray(this.randomObj).forEach(i=>{let t={id:i.prod._id,quantity:i.incommingValue,sender:JSON.parse(localStorage.getItem("user")).name,senderId:JSON.parse(localStorage.getItem("user"))._id,productType:i.prod.productType};this.updateServiceListStore(t)}),this.notification.dismissLoading(),this.notification.presentToast("la fiche a \xe9t\xe9 mise a jour","primary"),this.location.back()},i=>{console.log(i),this.notification.dismissLoading(),this.notification.presentToast("impossible de mettre a jour","danger")})}saveFiche(){this.notification.presentAlertConfirm("voulez vous cloturer la fiche de pointage ?","Oui","Non").then(i=>{this.notification.presentLoading(),setTimeout(()=>{this.notification.dismissLoading(),this.notification.presentAlertConfirm("veillez entrer le stock finale pour chacuns des produits ?","OK").then(()=>{this.isOpen=!1,this.confirm=!0})},1500)}).catch(i=>{})}closeFiche(){let i=[];if(console.log(this.fiche),console.log(this.productsServices),this.notification.presentLoading(),this.productsServices.forEach(t=>{"stockFinale"in t||i.push(t)}),i.length){let t="veillez entrer le stock finale pour les produits:";i.forEach(i=>{t=t+"-"+i.name+"\n"}),this.notification.dismissLoading(),this.notification.presentAlertConfirm(t,"Ok").then(()=>{})}else this.fiche.list=this.productsServices,this.fiche.open=!1,this.ficheService.updateFichePointage(this.fiche).subscribe(i=>{this.notification.dismissLoading(),this.notification.presentToast("la fiche a \xe9t\xe9 enregistr\xe9","success"),this.location.back()},i=>{this.notification.dismissLoading(),this.notification.presentToast("impossible de mettre a jour","danger")})}createFiche(){this.notification.presentAlertConfirm("cr\xe9er une nouvelle fiche de pointage ?","Oui","Non").then(()=>{this.notification.presentLoading(),this.ficheService.postPointage(this.productsServices).subscribe(i=>{this.randomObj&&this.generateArray(this.randomObj).forEach(i=>{let t={id:i.prod._id,quantity:i.incommingValue,sender:JSON.parse(localStorage.getItem("user")).name,senderId:JSON.parse(localStorage.getItem("user"))._id,productType:i.prod.productType};this.updateServiceListStore(t)}),this.notification.dismissLoading(),this.firstTime=!1,this.notification.presentToast("Nouvelle fiche de pointage cr\xe9e !","primary"),console.log(i)})}).catch(i=>{console.log(i),this.notification.dismissLoading()})}addIncrementProductService(i,t,e){let o=parseInt(i.target.value);if(Number.isNaN(o))delete this.randomObj[t._id],Object.keys(this.randomObj),t.pointageList&&(t.pointage=t.pointage-t.pointageList[t.pointageList.length-1].qty,t.pointageList.pop());else{let i=t._id,e=o,n={date:Date.now(),qty:e},s=this.randomObj[i];t.pointageList||(t.pointageList=[]),t.pointageList.push(n),t.pointage=0,t.pointageList.forEach(i=>{t.pointage=t.pointage?t.pointage+i.qty:i.qty}),this.randomObj[i]=s?{incommingValue:e+this.randomObj[i].incommingValue,prod:t}:{incommingValue:e,prod:t},this.generateArray(this.randomObj)}}getStockFinale(i,t,e){let o=parseInt(i.target.value);if(Number.isNaN(o))delete this.randomObj[t._id],Object.keys(this.randomObj),t.stockFinaleList&&t.stockFinaleList.length&&(t.stockFinale=t.stockFinale-t.stockFinaleList[t.stockFinaleList.length-1].qty,t.stockFinaleList.pop()),console.log(t);else{let i=t._id,e=o,n={date:Date.now(),qty:e},s=this.randomObj[i];t.stockFinaleList&&t.stockFinaleList.length||(t.stockFinaleList=[]),t.stockFinaleList.push(n),t.stockFinale=0,t.stockFinaleList.forEach(i=>{t.stockFinale=t.stockFinale?t.stockFinale+i.qty:i.qty}),t.ventes=t.quantityStore+t.pointage-t.stockFinale,this.randomObj[i]=s?{finaleValue:e+this.randomObj[i].finaleValue,prod:t}:{finaleValue:e,prod:t},this.generateArray(this.randomObj)}}generateArray(i){const t=[];for(var e in i)t.push(i[e]);return t}updateServiceListStore(i){this.servicelistService.updateServiceStore(i).subscribe(i=>{})}}return i.\u0275fac=function(t){return new(t||i)(a.Y36(l.e),a.Y36(h.w),a.Y36(d.sK),a.Y36(g.g),a.Y36(u.i),a.Y36(p.i),a.Y36(f.i),a.Y36(o.Ye),a.Y36(m.y))},i.\u0275cmp=a.Xpm({type:i,selectors:[["app-fiche-pointage"]],decls:31,vars:5,consts:[["slot","start"],["defaultHref","/start"],["slot","end"],["color","success","fill","outline",3,"click",4,"ngIf"],["fill","outline",3,"click",4,"ngIf"],["color","primary",1,"header-component"],["size-sm","2","size-md","2","size-lg","2"],[1,"ion-text-center","ion-text-uppercase"],["class","row-component",3,"ngStyle",4,"ngFor","ngForOf"],["color","success","fill","outline",3,"click"],["fill","outline",3,"click"],[1,"row-component",3,"ngStyle"],["size-sm","2","size-md","2","size-lg","2",1,"ion-align-self-center"],[1,"ion-text-start","ion-text-uppercase",2,"font-weight","bold"],["slot","end","placeholder","Enter quantity","type","number","debounce","2000",3,"ionChange"],["slot","end","placeholder","0","type","number","disabled","",4,"ngIf"],["slot","end","placeholder","Enter quantity","type","number","debounce","2000",3,"ionChange",4,"ngIf"],["slot","end","placeholder","0","type","number","disabled",""]],template:function(i,t){1&i&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar"),a._UZ(2,"ion-title"),a.TgZ(3,"ion-buttons",0),a._UZ(4,"ion-back-button",1),a.qZA(),a.TgZ(5,"ion-buttons",2),a.YNc(6,Z,3,3,"ion-button",3),a.YNc(7,S,2,0,"ion-button",4),a.YNc(8,v,2,0,"ion-button",4),a.YNc(9,b,2,0,"ion-button",4),a.qZA(),a.qZA(),a.qZA(),a.TgZ(10,"ion-content"),a.TgZ(11,"ion-row",5),a.TgZ(12,"ion-col",6),a.TgZ(13,"div",7),a._uU(14,"name"),a.qZA(),a.qZA(),a.TgZ(15,"ion-col",6),a.TgZ(16,"div",7),a._uU(17,"S.I"),a.qZA(),a.qZA(),a.TgZ(18,"ion-col",6),a.TgZ(19,"div",7),a._uU(20,"Pointage"),a.qZA(),a.qZA(),a.TgZ(21,"ion-col",6),a.TgZ(22,"div",7),a._uU(23,"Qt\xe9"),a.qZA(),a.qZA(),a.TgZ(24,"ion-col",6),a.TgZ(25,"div",7),a._uU(26,"S.F"),a.qZA(),a.qZA(),a.TgZ(27,"ion-col",6),a.TgZ(28,"div",7),a._uU(29,"VENTES"),a.qZA(),a.qZA(),a.qZA(),a.YNc(30,A,20,9,"ion-row",8),a.qZA()),2&i&&(a.xp6(6),a.Q6J("ngIf",!t.firstTime),a.xp6(1),a.Q6J("ngIf",!t.firstTime&&t.isOpen),a.xp6(1),a.Q6J("ngIf",t.firstTime),a.xp6(1),a.Q6J("ngIf",t.confirm),a.xp6(21),a.Q6J("ngForOf",t.productsServices))},directives:[s.Gu,s.sr,s.wd,s.Sm,s.oU,s.cs,o.O5,s.W2,s.Nd,s.wI,o.sg,s.YG,o.PC,s.pK,s.as],pipes:[d.X$],styles:[""]}),i})()}];let F=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[[r.Bz.forChild(k)],r.Bz]}),i})(),y=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=a.oAB({type:i}),i.\u0275inj=a.cJS({imports:[[o.ez,n.u5,s.Pc,F,d.aw.forChild()]]}),i})()}}]);