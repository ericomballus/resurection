(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[6784],{6784:(t,e,i)=>{"use strict";i.r(e),i.d(e,{SalePerDayPageModule:()=>O});var o=i(1511),n=i(6073),s=i(8777),l=i(8158),a=i(4762),r=i(1572),c=i(5946),g=i(5511),d=i(4144),u=i(2874),h=i(9719),Z=i(8698),m=i(4375);function f(t,e){1&t&&r._UZ(0,"ion-back-button",8)}function p(t,e){1&t&&r._UZ(0,"ion-back-button",9)}function v(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-buttons",1),r.TgZ(1,"ion-button",10),r.NdJ("click",function(){return r.CHM(t),r.oxw().cleall()}),r._uU(2," Back "),r.qZA(),r.qZA()}}function q(t,e){if(1&t&&(r.TgZ(0,"ion-col",25),r.TgZ(1,"pre"),r._uU(2),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(2),r.lnq("",t.model.day,"/",t.model.month,"/",t.model.year,"")}}function A(t,e){if(1&t&&(r.TgZ(0,"ion-col",25),r.TgZ(1,"pre"),r._uU(2),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(2),r.lnq("",t.model2.day,"/",t.model2.month,"/",t.model2.year,"")}}function T(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-col",26),r.TgZ(1,"div",27),r.TgZ(2,"ion-button",28),r.NdJ("click",function(){return r.CHM(t),r.oxw(2).takeInventory()}),r._uU(3," submit"),r.qZA(),r.qZA(),r.qZA()}}const y=function(){return{padding:"15px"}};function S(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div",11),r.TgZ(1,"ion-row"),r.TgZ(2,"ion-col",12),r.TgZ(3,"form",13),r.TgZ(4,"div",14),r.TgZ(5,"div",15),r.TgZ(6,"input",16,17),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().model=e}),r.qZA(),r.TgZ(8,"div",18),r.TgZ(9,"ion-button",19),r.NdJ("click",function(){return r.CHM(t),r.MAs(7).toggle()}),r._uU(10,"start "),r._UZ(11,"ion-icon",20),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.YNc(12,q,3,3,"ion-col",21),r.YNc(13,A,3,3,"ion-col",21),r.TgZ(14,"ion-col",12),r.TgZ(15,"form",13),r.TgZ(16,"div",14),r.TgZ(17,"div",15),r.TgZ(18,"input",16,22),r.NdJ("ngModelChange",function(e){return r.CHM(t),r.oxw().model2=e}),r.qZA(),r.TgZ(20,"div",18),r.TgZ(21,"ion-button",19),r.NdJ("click",function(){return r.CHM(t),r.MAs(19).toggle()}),r._uU(22,"End "),r._UZ(23,"ion-icon",20),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(24,"ion-row",23),r.YNc(25,T,4,0,"ion-col",24),r.qZA(),r.qZA()}if(2&t){const t=r.oxw();r.Q6J("ngStyle",r.DdM(6,y)),r.xp6(6),r.Q6J("ngModel",t.model),r.xp6(6),r.Q6J("ngIf",t.model),r.xp6(1),r.Q6J("ngIf",t.model2),r.xp6(5),r.Q6J("ngModel",t.model2),r.xp6(7),r.Q6J("ngIf",t.model&&t.model2)}}function _(t,e){1&t&&(r.TgZ(0,"div"),r.TgZ(1,"ion-row",29),r.TgZ(2,"ion-col",30),r.TgZ(3,"div",31),r._uU(4,"name"),r.qZA(),r.qZA(),r.TgZ(5,"ion-col",32),r._UZ(6,"div",31),r.qZA(),r.TgZ(7,"ion-col",32),r._UZ(8,"div",31),r.qZA(),r.TgZ(9,"ion-col",33),r._UZ(10,"div",31),r.qZA(),r.TgZ(11,"ion-col",34),r.TgZ(12,"div",31),r._uU(13,"found"),r.qZA(),r.qZA(),r.qZA(),r.qZA())}const b=function(){return{"background-color":"#f1f1f1"}};function x(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-row",37),r.TgZ(1,"ion-col",38),r.TgZ(2,"div",39),r._uU(3),r.qZA(),r.qZA(),r.TgZ(4,"ion-col",38),r._UZ(5,"div",40),r.qZA(),r.TgZ(6,"ion-col",38),r._UZ(7,"div",40),r.qZA(),r.TgZ(8,"ion-col",33),r._UZ(9,"div",40),r.qZA(),r.TgZ(10,"ion-col",34),r.TgZ(11,"div",41),r.TgZ(12,"ion-input",42),r.NdJ("ionChange",function(i){r.CHM(t);const o=e.$implicit;return r.oxw(2).addIncrement(i,o)}),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&t){const t=e.$implicit;r.xp6(3),r.hij(" ",t._id.name," "),r.xp6(9),r.Q6J("ngStyle",r.DdM(2,b))}}function I(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"div"),r.YNc(1,x,13,3,"ion-row",35),r.TgZ(2,"ion-button",36),r.NdJ("click",function(){return r.CHM(t),r.oxw().saveAll()}),r._uU(3," save "),r.qZA(),r.qZA()}if(2&t){const t=r.oxw();r.xp6(1),r.Q6J("ngForOf",t.invoices)}}function N(t,e){if(1&t){const t=r.EpF();r.TgZ(0,"ion-row"),r.TgZ(1,"ion-col",48),r.TgZ(2,"div",40),r._uU(3),r.ALo(4,"date"),r.qZA(),r.qZA(),r.TgZ(5,"ion-col",48),r.TgZ(6,"div",40),r._uU(7),r.qZA(),r.qZA(),r.TgZ(8,"ion-col",48),r.TgZ(9,"div",40),r._uU(10),r.qZA(),r.qZA(),r.TgZ(11,"ion-col",48),r.TgZ(12,"div",40),r.TgZ(13,"ion-button",50),r.NdJ("click",function(){r.CHM(t);const i=e.$implicit,o=r.oxw().$implicit;return r.oxw(3).findAll(i,o)}),r._uU(14,"voir"),r.qZA(),r.qZA(),r.qZA(),r.qZA()}if(2&t){const t=e.$implicit;r.xp6(3),r.Oqu(r.lcZ(4,3,t.openDate)),r.xp6(4),r.Oqu(t.ouverture),r.xp6(3),r.hij(" ",t.fermeture?t.fermeture:"ouvert"," ")}}function k(t,e){if(1&t&&(r.TgZ(0,"ion-slide"),r.TgZ(1,"ion-grid"),r.TgZ(2,"ion-row"),r.TgZ(3,"ion-col"),r.TgZ(4,"div",31),r.TgZ(5,"h4"),r._uU(6),r.qZA(),r.qZA(),r.qZA(),r.qZA(),r.TgZ(7,"ion-row",29),r.TgZ(8,"ion-col",48),r.TgZ(9,"div",31),r._uU(10,"jour"),r.qZA(),r.qZA(),r.TgZ(11,"ion-col",48),r.TgZ(12,"div",31),r._uU(13,"ouverture"),r.qZA(),r.qZA(),r.TgZ(14,"ion-col",48),r.TgZ(15,"div",31),r._uU(16,"fermeture"),r.qZA(),r.qZA(),r.TgZ(17,"ion-col",48),r.TgZ(18,"div",31),r._uU(19,"action"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(20,"div",49),r.YNc(21,N,15,5,"ion-row",47),r.qZA(),r.qZA(),r.qZA()),2&t){const t=e.$implicit;r.xp6(6),r.hij(" ",t.storeName?t.storeName:"no name"," "),r.xp6(15),r.Q6J("ngForOf",t)}}function w(t,e){if(1&t&&(r.TgZ(0,"div",45),r.TgZ(1,"ion-slides",46),r.YNc(2,k,22,2,"ion-slide",47),r.qZA(),r.qZA()),2&t){const t=r.oxw(2);r.xp6(2),r.Q6J("ngForOf",t.multiStoreProductitem)}}function J(t,e){if(1&t&&(r.TgZ(0,"div",43),r.YNc(1,w,3,1,"div",44),r.qZA()),2&t){const t=r.oxw();r.xp6(1),r.Q6J("ngIf",!t.invoices)}}const C=[{path:"",component:(()=>{class t{constructor(t,e,i,o,n,s,l,a,r){this.adminService=t,this.calendar=e,this.restApiService=i,this.loadingController=o,this.router=n,this.notif=s,this.getStoreName=l,this.inventoryService=a,this.saveRandom=r,this.total_amount=0,this.total_glace=0,this.total_nonglace=0,this.total_ristourne=0,this.total_quantity=0,this.isLoading=!1,this.totalBu=0,this.totalBenefice=0,this.vendorRole=!1,this.multiStoreProductitem=[],this.onvarevenirdessus=!1,JSON.parse(localStorage.getItem("user"))[0]&&JSON.parse(localStorage.getItem("user"))[0].venderRole&&(this.vendorRole=JSON.parse(localStorage.getItem("user"))[0].venderRole),this.model=this.calendar.getToday(),this.model2=this.calendar.getToday(),this.getSetting(),this.takeCashOpen()}getSetting(){let t=JSON.parse(localStorage.getItem("setting"));console.log(t),t.length?this.manageStockWithService=t[0].manageStockWithService:t.manageStockWithService&&(this.manageStockWithService=t.manageStockWithService)}ngOnInit(){}takeInventory(){let t,e,i;if(i=`${this.model.year.toString()}`,this.model.day.toString(),t=`${this.model.day+1}`,this.model.month.toString(),e=`${this.model.month}`,new Date(this.model.year,this.model.month,this.model.day).getTime()>new Date(this.model2.year,this.model2.month,this.model2.day).getTime())console.log("impossible"),this.notif.presentError("Sorry, the start date must be less than the end date","danger");else{let t={};t.openDate=new Date(this.model.year,this.model.month-1,this.model.day).toISOString(),t.closeDate=new Date(this.model2.year,this.model2.month-1,this.model2.day).toISOString()}}display(t){let e=new Date(this.data).getFullYear(),i=new Date(this.data).getMonth()+1,o=new Date(this.data).getDate()+1;this.adminService.getInvoiceByDate2(`${e}-${i}-${o}`).subscribe(t=>{})}displayDetails(t){console.log(t)}takeCashOpen(){this.notif.presentLoading(),this.adminService.getOpenCashAll().subscribe(t=>{if(console.log("cash",t),t.docs.length){let e=t.docs.reverse().reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{});this.multiStoreProductitem=[],console.log(e);for(const t in e)this.multiStoreProductitem.push(e[t]);console.log("group here",this.multiStoreProductitem),this.multiStoreProductitem.forEach(t=>(0,a.mG)(this,void 0,void 0,function*(){let e=yield this.getStoreName.takeName(t);t.storeName=e})),this.openCashDate=this.multiStoreProductitem,this.notif.dismissLoading()}else this.notif.dismissLoading(),this.notif.presentToast("pas de donn\xe9es disponibles pour le moment","dark")},t=>this.notif.dismissLoading())}del(t){this.adminService.deleteCashOpen(t).subscribe(t=>{console.log(t),this.takeCashOpen()})}findAll(t,e){this.queryDate=t,localStorage.setItem("dpick",JSON.stringify(t)),localStorage.setItem("queryDate",JSON.stringify(t)),localStorage.getItem("openCashDateId"),localStorage.setItem("d",JSON.stringify(t)),this.saveRandom.setExpensiveAndCash(t),this.manageStockWithService?t.open?(localStorage.setItem("open",JSON.stringify(!0)),localStorage.setItem("findThis",JSON.stringify(t)),this.router.navigateByUrl("display-sale")):this.router.navigateByUrl("display-sale"):this.findAll2(t)}findAll2(t){localStorage.setItem("d",JSON.stringify(t)),this.router.navigateByUrl("display-sale")}cleall(){this.invoices="",this.totalBu=0,this.totalBenefice=0,this.total_ristourne=0,this.total_amount=0,this.total_glace=0,this.total_nonglace=0,this.total_quantity=0,this.total_ristourne=0}takeProductItems(){this.restApiService.getProductItem().subscribe(t=>{console.log(t)})}takeBills(t){this.presentLoading2(),this.totalBu=0,this.totalBenefice=0;let e=0;this.adminService.getBillAggregate(t._id).subscribe(t=>{console.log(t),this.dismissLoading(),this.invoices=t.docs;let i=[];i=t.Inventory,console.log(i.length),this.invoices.forEach(t=>{this.moreInfo(i,t),t.commandes.forEach(t=>{e+=t.commande.products.price})}),console.log("total ====>",e),this.invoices.length&&this.invoices.forEach(t=>{this.total_amount=this.total_amount+t.totalSalesAmount,t.glace&&(this.total_glace=this.total_glace+t.glace),t.nonglace&&(this.total_nonglace=this.total_nonglace+t.nonglace),this.total_quantity=this.total_quantity+t.quantity,t.ristourneGenerate=parseInt(t._id.ristourneByProduct)*t.quantity,setTimeout(()=>{let e=t.entry.length-1,i=t.entry[e].item.sellingPrice-t.entry[e].item.purchasingPrice;t.beneficeUnitaire=i,t.beneficeTotal=i*t.quantity,t.pachat=t.entry[e].item.purchasingPrice,t.pvente=t.entry[e].item.sellingPrice,this.totalBu=this.totalBu+i,this.totalBenefice=this.totalBenefice+t.beneficeTotal,t.ristourneGenerate?this.total_ristourne=parseInt(t.ristourneGenerate)+this.total_ristourne:t.ristourneGenerate=0},200)})})}moreInfo(t,e){return new Promise((i,o)=>{t[0].listsStart.forEach(t=>{t._id==e._id.id&&(e.out=e.quantity,e.start=e.entry[0].item.quantityStore,e.reste=e.start-e.out,e.remaining2=0,console.log(e))}),i(e)})}addIncrement(t,e){let i=parseInt(t.target.value);console.log(i),console.log(e),Number.isNaN(i)?console.log(e):i<=e.start?e.remaining=e.reste-i:this.notif.presentToast("quantit\xe9 invalide sup\xe9rieur \xe0 celle de depart","danger")}addMore(t){console.log(t),t.displayQty=t.reste+1,t.isChecked=!1}getInventory(){localStorage.setItem("queryDate",JSON.stringify(this.queryDate)),this.router.navigateByUrl("display-sale")}presentLoading2(){return(0,a.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:6e4}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then()})})})}dismissLoading(){return(0,a.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then()})}saveAll(){}}return t.\u0275fac=function(e){return new(e||t)(r.Y36(c.l),r.Y36(g.vL),r.Y36(d.e),r.Y36(l.HT),r.Y36(s.F0),r.Y36(u.g),r.Y36(h.$),r.Y36(Z.V),r.Y36(m.i))},t.\u0275cmp=r.Xpm({type:t,selectors:[["app-sale-per-day"]],decls:13,vars:7,consts:[[1,"titre"],["slot","start"],["defaultHref","/start",4,"ngIf"],["defaultHref","/vendor-start",4,"ngIf"],["slot","start",4,"ngIf"],[3,"ngStyle",4,"ngIf"],[4,"ngIf"],["class","slide1",4,"ngIf"],["defaultHref","/start"],["defaultHref","/vendor-start"],["fill","clear","color","primary",3,"click"],[3,"ngStyle"],["size","3"],[1,"form-inline"],[1,"form-group"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control",2,"display","none",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],[1,"input-group-append"],["fill","clear","size","small","type","button",1,"btn","btn-outline-secondary","calendar",3,"click"],["name","calendar"],["size","3","class","ion-padding ion-align-self-center",4,"ngIf"],["d2","ngbDatepicker"],[1,"ion-align-items-center"],["class","ion-align-self-center",4,"ngIf"],["size","3",1,"ion-padding","ion-align-self-center"],[1,"ion-align-self-center"],[1,"ion-text-center"],["size","small",3,"click"],[1,"header-row"],["size","2","size-md","1",1,"ion-align-self-center"],[1,"ion-text-center","ion-text-uppercase"],["size","2"],["size","1",1,"ion-align-self-center"],["size","5",1,"ion-align-self-center"],["class","data-row data-update",4,"ngFor","ngForOf"],["expand","full","fill","outline",3,"click"],[1,"data-row","data-update"],["size","2",1,"ion-align-self-center"],[1,"ion-text-center","inte","ion-text-uppercase"],[1,"ion-text-center","inte"],[1,"ion-text-center","found","inte"],["slot","end","placeholder","bouteille","type","number","debounce","700",3,"ngStyle","ionChange"],[1,"slide1"],["class","slide2",4,"ngIf"],[1,"slide2"],["pager","true"],[4,"ngFor","ngForOf"],["size","3",1,"ion-align-self-center"],[1,"nodejs"],["fill","outline","size","small",3,"click"]],template:function(t,e){1&t&&(r.TgZ(0,"ion-header"),r.TgZ(1,"ion-toolbar"),r.TgZ(2,"ion-title",0),r._uU(3,"gestion des ventes"),r.qZA(),r.TgZ(4,"ion-buttons",1),r.YNc(5,f,1,0,"ion-back-button",2),r.YNc(6,p,1,0,"ion-back-button",3),r.qZA(),r.YNc(7,v,3,0,"ion-buttons",4),r.qZA(),r.qZA(),r.TgZ(8,"ion-content"),r.YNc(9,S,26,7,"div",5),r.YNc(10,_,14,0,"div",6),r.YNc(11,I,4,1,"div",6),r.YNc(12,J,2,1,"div",7),r.qZA()),2&t&&(r.xp6(5),r.Q6J("ngIf",!e.vendorRole&&!e.invoices),r.xp6(1),r.Q6J("ngIf",e.vendorRole&&!e.invoices),r.xp6(1),r.Q6J("ngIf",e.invoices),r.xp6(2),r.Q6J("ngIf",e.onvarevenirdessus),r.xp6(1),r.Q6J("ngIf",e.invoices),r.xp6(1),r.Q6J("ngIf",e.invoices),r.xp6(1),r.Q6J("ngIf",!e.invoices))},directives:[l.Gu,l.sr,l.wd,l.Sm,o.O5,l.W2,l.oU,l.cs,l.YG,o.PC,l.Nd,l.wI,n.Y7,n.JL,n.F,g.J4,n.Fj,n.JJ,n.On,l.gu,o.sg,l.pK,l.as,l.Hr,l.A$,l.jY],pipes:[o.uU],styles:[".userName[_ngcontent-%COMP%]{font-size:11px;position:absolute;left:80%;bottom:8%;color:#fa3434}.tableNumber[_ngcontent-%COMP%]{font-size:2px;position:absolute;left:50%;bottom:40%}ion-col[_ngcontent-%COMP%]   .inte[_ngcontent-%COMP%], ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:9px}.data-lastrow[_ngcontent-%COMP%]{background-color:#f1f1f1;padding-top:10px;padding-bottom:10px}.found[_ngcontent-%COMP%]{background-color:#16acf1;height:100%;width:100%;display:block}.header-row[_ngcontent-%COMP%]{padding-top:10px;padding-bottom:10px}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:9px}.icone[_ngcontent-%COMP%]{font-size:30px}"]}),t})()}];let O=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=r.oAB({type:t}),t.\u0275inj=r.cJS({imports:[[o.ez,n.u5,l.Pc,s.Bz.forChild(C),g.IJ]]}),t})()}}]);