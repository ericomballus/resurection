(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[3080],{4418:(t,e,i)=>{"use strict";i.d(e,{W:()=>d});var o=i(1344),s=i.n(o),r=i(8512),n=i(1572),c=i(2968);let d=(()=>{class t{constructor(t){this.urlService=t,this.mysocket=new r.X(null),this.sock=!1,this.takeUrl()}takeUrl(){console.log("je demmare ici url"),this.urlService.getUrl().subscribe(t=>{this.url=t,this.adminId=localStorage.getItem("adminId"),this.sockets=s()(this.url),this.mysocket.next(this.sockets)})}getSocket(){return this.mysocket}disconnectSocket(){this.sockets.disconnect()}getMySocket(){return this.sockets}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(c.i))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},3080:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ShopListPageModule:()=>k});var o=i(1511),s=i(6073),r=i(8158),n=i(8777),c=i(1064),d=i(4762),l=i(6855),a=i(8076),u=i(1572),h=i(4144),p=i(2874),g=i(9719),m=i(4418);function f(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-button",11),u.NdJ("click",function(){u.CHM(t);const e=u.oxw().$implicit;return u.oxw(2).deleteShopListProd(e)}),u._UZ(1,"ion-icon",12),u.qZA()}}function Z(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-item"),u.TgZ(1,"ion-label"),u.TgZ(2,"p"),u._uU(3),u.qZA(),u.TgZ(4,"p"),u._uU(5),u.qZA(),u.TgZ(6,"p"),u._uU(7),u.qZA(),u.qZA(),u.TgZ(8,"ion-button",8),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit,o=e.index,s=u.oxw().index;return u.oxw().TransferOne(i,s,o)}),u._uU(9),u.ALo(10,"translate"),u.qZA(),u.TgZ(11,"ion-button",9),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit;return u.oxw(2).productUpdate(i)}),u._uU(12),u.ALo(13,"translate"),u.qZA(),u.YNc(14,f,2,0,"ion-button",10),u.qZA()}if(2&t){const t=e.$implicit,i=u.oxw(2);u.xp6(3),u.Oqu(t.name),u.xp6(2),u.Oqu(t.sellingPrice),u.xp6(2),u.Oqu(t.purchasingPrice),u.xp6(2),u.hij(" ",u.lcZ(10,6,"MENU.transfer")," "),u.xp6(3),u.hij(" ",u.lcZ(13,8,"MENU.update")," "),u.xp6(2),u.Q6J("ngIf",i.admin)}}function S(t,e){if(1&t&&(u.TgZ(0,"ion-slide"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u.TgZ(4,"div",7),u.TgZ(5,"h4"),u._uU(6),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"ion-list"),u.YNc(8,Z,15,10,"ion-item",6),u.qZA(),u.qZA(),u.qZA()),2&t){const t=e.$implicit;u.xp6(6),u.Oqu(t.storeName?t.storeName:"no name"),u.xp6(2),u.Q6J("ngForOf",t)}}const b=[{path:"",component:(()=>{class t{constructor(t,e,i,o,s,r,n,c,d,l){this.restApiService=t,this.modalController=e,this.toastController=i,this.loadingController=o,this.actionSheetController=s,this.alertController=r,this.notif=n,this.router=c,this.getStoreName=d,this.manageSocket=l,this.products=[],this.tabRoles=[],this.admin=!1,this.multiStoreProductitem=[],this.segment="enabled",this.display_segment=!1,this.actif_products=[],this.storeList=[],this.tabRoles=JSON.parse(localStorage.getItem("roles")),(this.tabRoles.includes(1)||this.tabRoles.includes(2))&&this.takeProduct(),this.tabRoles.includes(1)&&(this.admin=!0),this.webServerSocket()}ngOnInit(){let t=JSON.parse(localStorage.getItem("user"))[0];this.storeList=t.storeId}webServerSocket(){let t=localStorage.getItem("adminId");this.manageSocket.getSocket().subscribe(e=>{console.log(e),e.on(`${t}newProductList`,t=>{setTimeout(()=>{this.rangeProductByStore()},1e3)})})}takeProduct(){this.notif.presentLoading(),this.restApiService.getShopList().subscribe(t=>{console.log(t),this.notif.dismissLoading(),this.products=t.product,this.actif_products=this.products,this.rangeProductByStore()})}presentLoading(){return(0,d.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:6e3}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then(()=>console.log("abort presenting"))})})})}dismissLoading(){return(0,d.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then(()=>console.log("dismissed"))})}addProduct(){return(0,d.mG)(this,void 0,void 0,function*(){let t=this.products;const e=yield this.modalController.create({component:l.d,componentProps:{tabproducts:{products:t,page:"shop-list.page"}}});return e.onDidDismiss().then(t=>{}),yield e.present()})}deleteShopListProd(t){this.restApiService.deleteShopList(t._id).subscribe(e=>{this.products=this.products.filter(e=>e._id!==t._id),this.rangeProductByStore()})}addCategorie(){this.router.navigateByUrl("/category?page=shop-list.page")}rangeProductByStore(){let t=this.products.reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{});this.multiStoreProductitem=[];for(const e in t)this.multiStoreProductitem.push(t[e]);this.multiStoreProductitem.forEach(t=>(0,d.mG)(this,void 0,void 0,function*(){t.forEach(t=>{t.desabled&&(this.display_segment=!0)});let e=yield this.getStoreName.takeName(t);t.storeName=e}))}productUpdate(t){return(0,d.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.modalController.create({component:a.h,componentProps:{product:t,page:"billard.page"}});return e.onDidDismiss().then(t=>{if(console.log(t),"no_update"===t.data)console.log(t.data);else if(console.log(t.data),t.data&&t.data.product){let e=t.data.product,i=this.products.findIndex(t=>t._id===e._id);this.products.splice(i,1,e),this.rangeProductByStore()}}),yield e.present()})}TransferOne(t,e,i){return(0,d.mG)(this,void 0,void 0,function*(){this.notif.presentLoading();let e=1;for(let o of this.storeList)if(o.id==t.storeId);else try{yield this.checkIfExist(t,o.id),e+=1,e==this.storeList.length&&this.notif.dismissLoading()}catch(i){let s=yield this.buildProduct(t,o);e+=1,console.log(s),this.products.push(s),e==this.storeList.length&&(this.notif.dismissLoading(),this.rangeProductByStore())}})}checkIfExist(t,e){return new Promise((i,o)=>{let s=this.products.find(i=>i.storeId==e&&i.name==t.name);s?i(s):o(!1)})}buildProduct(t,e){return new Promise((i,o)=>{let s=!1,r=[];if(e.super_warehouse){s=!0;for(let e of this.products)e.filename==t.filename&&e.name==t.name&&(r.includes(e._id)||r.push(e._id));let o=this.buildProd(t,e,r,s);this.restApiService.transferShopList(o).subscribe(t=>{i(t.data)},t=>{i(t)})}else{let o=this.buildProd(t,e,r,s);this.restApiService.transferShopList(o).subscribe(t=>(0,d.mG)(this,void 0,void 0,function*(){for(let t of this.storeList);i(t.data)}),t=>{i(t)})}})}buildProd(t,e,i,o){return{adminId:t.adminId,name:t.name,sellingPrice:t.sellingPrice,purchasingPrice:t.purchasingPrice,categoryName:t.categoryName,categoryId:t.categoryId,superCategory:t.superCategory,storeId:e.id,url:t.url,filename:t.filename,originalname:t.originalname,super_warehouse:o,productId:t._id,idList:i}}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(h.e),u.Y36(r.IN),u.Y36(r.yF),u.Y36(r.HT),u.Y36(r.BX),u.Y36(r.Br),u.Y36(p.g),u.Y36(n.F0),u.Y36(g.$),u.Y36(m.W))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-shop-list"]],decls:14,vars:4,consts:[["slot","end"],[3,"click"],["slot","icon-only","name","add-outline"],["slot","start"],["autoHide","false"],["pager","true"],[4,"ngFor","ngForOf"],[1,"ion-text-center","ion-text-uppercase"],["color","primary","slot","end","small","",3,"click"],["color","primary","slot","end","small","",1,"round",3,"click"],["color","danger","class","round","slot","end","small","",3,"click",4,"ngIf"],["color","danger","slot","end","small","",1,"round",3,"click"],["name","trash"]],template:function(t,e){1&t&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u._UZ(2,"ion-title"),u.TgZ(3,"ion-buttons",0),u.TgZ(4,"ion-button",1),u.NdJ("click",function(){return e.addCategorie()}),u._uU(5),u.ALo(6,"translate"),u.qZA(),u.TgZ(7,"ion-button",1),u.NdJ("click",function(){return e.addProduct()}),u._UZ(8,"ion-icon",2),u.qZA(),u.qZA(),u.TgZ(9,"ion-buttons",3),u._UZ(10,"ion-menu-button",4),u.qZA(),u.qZA(),u.qZA(),u.TgZ(11,"ion-content"),u.TgZ(12,"ion-slides",5),u.YNc(13,S,9,2,"ion-slide",6),u.qZA(),u.qZA()),2&t&&(u.xp6(5),u.hij(" ",u.lcZ(6,2,"MENU.addcategorie")," "),u.xp6(8),u.Q6J("ngForOf",e.multiStoreProductitem))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.YG,r.gu,r.fG,r.W2,r.Hr,o.sg,r.A$,r.jY,r.Nd,r.wI,r.q_,r.Ie,r.Q$,o.O5],pipes:[c.X$],styles:[""]}),t})()}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[n.Bz.forChild(b),c.aw.forChild()],n.Bz]}),t})(),k=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[o.ez,s.u5,r.Pc,y,c.aw.forChild()]]}),t})()}}]);