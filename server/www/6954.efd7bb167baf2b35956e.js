(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[6954],{6954:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ProductListPageModule:()=>E});var o=i(1511),n=i(6073),s=i(8777),r=i(8158),c=i(4762),d=i(4831),l=i(5896),a=i(1344),u=i.n(a),p=i(347),g=i(1419),h=i(1572),m=i(4144),f=i(4892),Z=i(2968),b=i(9719),x=i(2874),A=i(1064);function v(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",2),h.NdJ("click",function(){return h.CHM(t),h.oxw().selectSource()}),h._UZ(1,"ion-icon",8),h.qZA()}}function P(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-segment",12),h.NdJ("ngModelChange",function(e){return h.CHM(t),h.oxw(2).segment=e}),h.TgZ(1,"ion-segment-button",13),h._uU(2," products enable "),h.qZA(),h.TgZ(3,"ion-segment-button",14),h._uU(4," products desable "),h.qZA(),h.qZA()}if(2&t){const t=h.oxw(2);h.Q6J("ngModel",t.segment)}}function U(t,e){if(1&t&&(h.TgZ(0,"p",20),h._uU(1),h.qZA()),2&t){const t=h.oxw(2).$implicit;h.xp6(1),h.AsE(" ",t.sizeUnit," ",t.unitName," ")}}function k(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",21),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).$implicit,i=h.oxw(2).index;return h.oxw().productUpdate(e,i)}),h._uU(1),h.ALo(2,"translate"),h.qZA()}2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"MENU.update")))}function y(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",22),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).$implicit;return h.oxw(3).deleteProduct(e)}),h._UZ(1,"ion-icon",23),h.qZA()}}function T(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-avatar",4),h._UZ(2,"img",15),h.qZA(),h.TgZ(3,"ion-label"),h.TgZ(4,"p",16),h._uU(5),h.qZA(),h.TgZ(6,"p",16),h._uU(7),h.qZA(),h.YNc(8,U,2,2,"p",17),h.qZA(),h.YNc(9,k,3,3,"ion-button",18),h.YNc(10,y,2,0,"ion-button",19),h.qZA()),2&t){const t=h.oxw().$implicit,e=h.oxw(3);h.xp6(2),h.s9C("src",t.url,h.LSH),h.xp6(3),h.Oqu(t.name),h.xp6(2),h.AsE(" ",t.purchasingPrice," -- ",t.sellingPrice," "),h.xp6(1),h.Q6J("ngIf",t.unitName&&t.sizeUnit),h.xp6(1),h.Q6J("ngIf",e.admin),h.xp6(1),h.Q6J("ngIf",e.admin)}}function N(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,T,11,7,"ion-item",11),h.qZA()),2&t){const t=e.$implicit;h.xp6(1),h.Q6J("ngIf",!t.desabled)}}function _(t,e){if(1&t&&(h.TgZ(0,"ion-list"),h.YNc(1,N,2,1,"div",7),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Q6J("ngForOf",t)}}function q(t,e){if(1&t&&(h.TgZ(0,"p",20),h._uU(1),h.qZA()),2&t){const t=h.oxw(2).$implicit;h.xp6(1),h.AsE(" ",t.sizeUnit," ",t.unitName," ")}}function I(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"ion-button",21),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).$implicit,i=h.oxw(2).index;return h.oxw().productUpdate(e,i)}),h._uU(1),h.ALo(2,"translate"),h.qZA()}2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,1,"MENU.restore")))}function C(t,e){if(1&t&&(h.TgZ(0,"ion-item"),h.TgZ(1,"ion-avatar",4),h._UZ(2,"ion-img",15),h.qZA(),h.TgZ(3,"ion-label"),h.TgZ(4,"p",16),h._uU(5),h.qZA(),h.TgZ(6,"p",16),h._uU(7),h.qZA(),h.YNc(8,q,2,2,"p",17),h.qZA(),h.YNc(9,I,3,3,"ion-button",18),h.qZA()),2&t){const t=h.oxw().$implicit,e=h.oxw(3);h.xp6(2),h.Q6J("src",t.url),h.xp6(3),h.Oqu(t.name),h.xp6(2),h.AsE(" ",t.purchasingPrice," -- ",t.sellingPrice," "),h.xp6(1),h.Q6J("ngIf",t.unitName&&t.sizeUnit),h.xp6(1),h.Q6J("ngIf",e.admin)}}function S(t,e){if(1&t&&(h.TgZ(0,"div"),h.YNc(1,C,10,6,"ion-item",11),h.qZA()),2&t){const t=e.$implicit;h.xp6(1),h.Q6J("ngIf",t.desabled)}}function w(t,e){if(1&t&&(h.TgZ(0,"ion-list"),h.YNc(1,S,2,1,"div",7),h.qZA()),2&t){const t=h.oxw().$implicit;h.xp6(1),h.Q6J("ngForOf",t)}}function M(t,e){if(1&t&&(h.TgZ(0,"ion-slide"),h.TgZ(1,"ion-grid"),h.TgZ(2,"ion-row"),h.TgZ(3,"ion-col"),h.TgZ(4,"div",9),h.TgZ(5,"h4"),h._uU(6),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(7,P,5,1,"ion-segment",10),h.YNc(8,_,2,1,"ion-list",11),h.YNc(9,w,2,1,"ion-list",11),h.qZA(),h.qZA()),2&t){const t=e.$implicit,i=h.oxw();h.xp6(6),h.Oqu(t.storeName?t.storeName:"no name"),h.xp6(1),h.Q6J("ngIf",i.display_segment),h.xp6(1),h.Q6J("ngIf",t&&"enabled"==i.segment),h.xp6(1),h.Q6J("ngIf",t&&"disabled"==i.segment)}}let J=(()=>{class t{constructor(t,e,i,o,n,s,r,c,d,l,a){this.restApiService=t,this.modalController=e,this.toastController=i,this.loadingController=o,this.socket=n,this.alertController=s,this.router=r,this.urlService=c,this.getStoreName=d,this.notifi=l,this.translate=a,this.products=[],this.products_disable=[],this.all_products=[],this.tabRoles=[],this.packsArray=[],this.productArray=[],this.admin=!1,this.multiStoreProductitem=[],this.segment="enabled",this.display_segment=!1}ngOnInit(){}ionViewDidEnter(){this.takeUrl(),this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId)}ionViewWillEnter(){this.tabRoles=JSON.parse(localStorage.getItem("roles")),(this.tabRoles.includes(1)||this.tabRoles.includes(2))&&this.takeProduct(),this.tabRoles.includes(1)&&(this.admin=!0),console.log(JSON.parse(localStorage.getItem("setting")))}takeUrl(){this.urlService.getUrl().subscribe(t=>{this.url=t})}webServerSocket(t){this.sockets=u()(this.url),this.sockets.on(`${t}newProduct`,t=>(0,c.mG)(this,void 0,void 0,function*(){t.url=yield this.restApiService.getProducById(t._id),console.log(t),console.log(this.products);let e=this.products.findIndex(e=>e._id==t._id);console.log(e),e>=0||(this.products.unshift(t),console.log(this.products)),this.rangeProductByStore()})),this.sockets.on(`${t}productUpdate`,t=>(0,c.mG)(this,void 0,void 0,function*(){console.log("update here",t),console.log(this.products);let e=[];if(this.numIndex>=0&&(e=this.multiStoreProductitem[this.numIndex]),e.length){let i=e.findIndex(e=>e._id==t._id);console.log(i),i>=0&&this.multiStoreProductitem[this.numIndex].splice(i,1,t)}console.log(this.multiStoreProductitem)}))}takeProduct(){this.presentLoading(),this.restApiService.getProductList().subscribe(t=>{console.log(t),t.products.forEach(t=>{t.name.replace(/\s/g,""),t.name=t.name.toUpperCase()}),t.products.sort((t,e)=>t.name>e.name?1:e.name>t.name?-1:0),this.products=[],this.products=t.products,this.products=t.products.filter(t=>0==t.desabled),this.dismissLoading().then(()=>{}).catch(t=>{console.log(t)}),this.actif_products=this.products,this.rangeProductByStore()})}productAdd(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:d.t,componentProps:{tabproducts:{products:this.products,flag:"product_add"},page:"product-list"}});return t.onDidDismiss().then(t=>{t.data.length&&setTimeout(()=>{},500)}),yield t.present()})}deleteProduct(t){this.notifi.presentLoading();let e=t._id;this.restApiService.productUpdate(t._id,{capacity:"false",_id:t._id,display:!1}).subscribe(i=>{this.products=this.products.filter(e=>e._id!==t._id),this.notifi.dismissLoading(),this.takePack(e),this.deleteProductItems(e),this.rangeProductByStore(),this.presentToast()},t=>{console.log(t)})}productUpdate(t,e){return(0,c.mG)(this,void 0,void 0,function*(){this.numIndex=e,this.storeProductArray=this.multiStoreProductitem[e];let i=t.url;const o=yield this.modalController.create({component:l.D,componentProps:{product:t,page:"product-list"}});return o.onDidDismiss().then(e=>{"no_update"===e.data?console.log(e.data):(e.data.url=i,t.url=e.data.url)}),yield o.present()})}presentLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:6e3}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then(()=>console.log("abort presenting"))})})})}dismissLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then(()=>console.log("dismissed"))})}presentToast(){return(0,c.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:"product have been update.",duration:2e3,position:"top",animated:!0,cssClass:"my-custom-class"})).present()})}takePack(t){setTimeout(()=>{this.restApiService.deletePack(t).subscribe(e=>{console.log(e),this.restApiService.deletePackItem2(t).subscribe(t=>{console.log(t)})})},1500)}deletePack(t){console.log(t),this.restApiService.deletePack(t._id).subscribe(t=>{console.log(t)})}deleteProductItems(t){this.restApiService.deleteProductItem(t).subscribe(t=>{console.log(t)})}pickProduct(){this.router.navigateByUrl("pick-product")}rangeProductByStore(){let t=this.products.reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{});this.multiStoreProductitem=[],console.log(t);for(const e in t)this.multiStoreProductitem.push(t[e]);console.log("group here",this.multiStoreProductitem),this.multiStoreProductitem.forEach(t=>(0,c.mG)(this,void 0,void 0,function*(){t.forEach(t=>{t.desabled&&(this.display_segment=!0)});let e=yield this.getStoreName.takeName(t);t.storeName=e}))}selectSource(){return(0,c.mG)(this,void 0,void 0,function*(){let t={};this.translate.get("MENU.selectMaeri").subscribe(e=>{t.selectMaeri=e}),this.translate.get("MENU.ok").subscribe(e=>{t.ok=e}),this.translate.get("MENU.no").subscribe(e=>{t.no=e});const e=yield this.alertController.create({message:t.selectMaeri,buttons:[{text:t.no,role:"cancel",cssClass:"secondary",handler:t=>{this.selectProductType()}},{text:t.ok,handler:()=>{this.productAdd()}}]});yield e.present()})}selectProductType(){return(0,c.mG)(this,void 0,void 0,function*(){let t={};this.translate.get("MENU.productType").subscribe(e=>{t.productType=e}),this.translate.get("MENU.product").subscribe(e=>{t.product=e}),this.translate.get("MENU.cancel").subscribe(e=>{t.cancel=e});const e=yield this.alertController.create({message:t.productType,buttons:[{text:t.product,role:"cancel",cssClass:"secondary",handler:t=>{this.userAddOwnProduct()}},{text:"COKTAIL",handler:()=>{this.userAddCocktail()}},{text:t.cancel,handler:()=>{}}]});yield e.present()})}userAddOwnProduct(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:p.I,componentProps:{page:"product-list"}});return t.onDidDismiss().then(t=>{console.log(t)}),yield t.present()})}userAddCocktail(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:g.J,componentProps:{page:"product-list"}});return t.onDidDismiss().then(t=>{console.log(t)}),yield t.present()})}addCategorie(){this.router.navigateByUrl("/category?page=product-list")}addResource(){this.router.navigateByUrl("/resource?page=product-list")}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(m.e),h.Y36(r.IN),h.Y36(r.yF),h.Y36(r.HT),h.Y36(f.sk),h.Y36(r.Br),h.Y36(s.F0),h.Y36(Z.i),h.Y36(b.$),h.Y36(x.g),h.Y36(A.sK))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-product-list"]],decls:16,vars:8,consts:[["color","primary"],["slot","end"],[3,"click"],[3,"click",4,"ngIf"],["slot","start"],["autoHide","false"],["pager","true"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add"],[1,"ion-text-center","ion-text-uppercase"],[3,"ngModel","ngModelChange",4,"ngIf"],[4,"ngIf"],[3,"ngModel","ngModelChange"],["value","enabled"],["value","disabled"],[3,"src"],[1,"packName"],["class","packUnit",4,"ngIf"],["class","divBtnUpdate",3,"click",4,"ngIf"],["class","divBtnDelete","color","danger",3,"click",4,"ngIf"],[1,"packUnit"],[1,"divBtnUpdate",3,"click"],["color","danger",1,"divBtnDelete",3,"click"],["slot","icon-only","name","trash"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar",0),h._UZ(2,"ion-title"),h.TgZ(3,"ion-buttons",1),h.TgZ(4,"ion-button",2),h.NdJ("click",function(){return e.addCategorie()}),h._uU(5),h.ALo(6,"translate"),h.qZA(),h.TgZ(7,"ion-button",2),h.NdJ("click",function(){return e.addResource()}),h._uU(8),h.ALo(9,"translate"),h.qZA(),h.YNc(10,v,2,0,"ion-button",3),h.qZA(),h.TgZ(11,"ion-buttons",4),h._UZ(12,"ion-menu-button",5),h.qZA(),h.qZA(),h.qZA(),h.TgZ(13,"ion-content"),h.TgZ(14,"ion-slides",6),h.YNc(15,M,10,4,"ion-slide",7),h.qZA(),h.qZA()),2&t&&(h.xp6(5),h.Oqu(h.lcZ(6,4,"MENU.addcategorie")),h.xp6(3),h.hij(" ",h.lcZ(9,6,"MENU.addresources"),""),h.xp6(2),h.Q6J("ngIf",e.admin),h.xp6(5),h.Q6J("ngForOf",e.multiStoreProductitem))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.YG,o.O5,r.fG,r.W2,r.Hr,o.sg,r.gu,r.A$,r.jY,r.Nd,r.wI,r.cJ,r.QI,n.JJ,n.On,r.GO,r.q_,r.Ie,r.BJ,r.Q$,r.Xz],pipes:[A.X$],styles:[".round[_ngcontent-%COMP%]{--width:5px;--height:5px;--vertical-align:middle;margin:2px;font-size:10px}.packName[_ngcontent-%COMP%], .packUnit[_ngcontent-%COMP%]{font-size:12px}.divBtn[_ngcontent-%COMP%]{height:10px;width:15}.divBtn[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{font-size:55%}.divBtnUpdate[_ngcontent-%COMP%]{font-size:45%}"]}),t})();var Y=i(9547);const O=[{path:"",component:J}];let E=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[o.ez,n.u5,r.Pc,s.Bz.forChild(O),A.aw.forChild(),Y.G]]}),t})()}}]);