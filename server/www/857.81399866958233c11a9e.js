(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[857],{857:(t,e,i)=>{"use strict";i.d(e,{w:()=>b});var s=i(4762),r=i(1344),o=i.n(r),a=i(1572),c=i(8158),n=i(866),l=i(2181),u=i(4144),d=i(3437),h=i(5604),p=i(5946),m=i(2968),g=i(1511);function I(t,e){if(1&t&&(a.TgZ(0,"ion-select-option",8),a._uU(1),a.qZA()),2&t){const t=e.$implicit;a.s9C("value",t.id),a.xp6(1),a.Oqu(t.numStore)}}let b=(()=>{class t{constructor(t,e,i,s,r,o,a,c,n){this.modalCtrl=t,this.loadingController=e,this.warehouseService=i,this.auth=s,this.restApiService=r,this.manageCartService=o,this.countItemsService=a,this.adminService=c,this.urlService=n,this.storeList=[],this.totalItems=0,this.totalPrice=0,this.packs=[],this.randomObj={},this.quantity=0,this.productItem=this.warehouseService.getProductItem(),console.log(this.productItem),this.getUserAllStore(),this.takeUrl()}ngOnInit(){}dismiss(t){t&&(this.activitie=t),this.modalCtrl.dismiss({dismissed:!0})}getUserAllStore(){this.auth.getUser().subscribe(t=>{this.user=t,console.log(t),this.storeList=this.user[0].storeId})}assignSore(t){return(0,s.mG)(this,void 0,void 0,function*(){let e=t.target.value;this.store=e,console.log(e)})}addQuantity(t){this.quantity=t.target.value,console.log(this.quantity)}updateProductItems(){this.getValue(this.quantity,this.productItem)}displayPriceQuantity(t){let e=Object.keys(t);this.restApiService.saveCart({}),this.totalItems=0,this.totalPrice=0;for(const i of e)t[i].prod.removeQuantity=t[i].sale,1===t[i].remove?(this.totalItems=this.totalItems+t[i].sale,this.totalPrice=this.totalPrice+t[i].coast):(t[i].prod.nbrBtl&&(this.totalPrice=this.totalPrice+t[i].prod.nbrBtl*t[i].prod.purchasingPrice),this.totalItems=this.totalItems+t[i].sale,this.totalPrice=this.totalPrice+t[i].coast),this.buyPackProduct(t[i].prod)}buyPackProduct(t){let e=t._id;if(this.cartValue=this.restApiService.getCart2(),console.log("hello 2",this.cartValue),this.cartValue&&this.cartValue.cart){let i={};i.product=t,i.cart=this.cartValue.cart;let s=this.manageCartService.addToCart(i);console.log(s);let r=s.items;for(const t in r);let o=[];o=s.generateArray().filter(t=>t.item._id===e);let a=this.packs.findIndex(e=>e._id===t._id);t.qty=o[0].qty,this.packs.splice(a,1,t),this.restApiService.saveCart({cart:s,products:s.generateArray()})}else{let i=this.manageCartService.addToCart(t),s=i.items;for(const t in s);let r=[];r=i.generateArray().filter(t=>t.item._id===e);let o=this.packs.findIndex(e=>e._id===t._id);t.qty=r[0].qty,this.packs.splice(o,1,t),this.packs.splice(o,1,t),this.restApiService.saveCart({cart:i,products:i.generateArray()})}this.updateProd()}getValue(t,e){return(0,s.mG)(this,void 0,void 0,function*(){let i=e._id,s=t;if(e.myValue=Number.isNaN(t)?0:s,!e.noHandle){if(this.randomObj[i])if(s){let t=this.randomObj[i];t.sale&&(s=t.sale+s),this.randomObj[i]=e.packPrice?{sale:s,coast:s*parseInt(e.packPrice),prod:e}:{sale:s,coast:0,prod:e}}else e.nbrBtl=0,delete this.randomObj[i];else e.packPrice?(this.randomObj[i]={sale:s,coast:s*parseInt(e.packPrice),prod:e},e.fisrtValueAdd=s):this.randomObj[i]={sale:s,coast:0,prod:e};e.nbrCassier=e.nbrCassier?e.nbrCassier+s:s,this.displayPriceQuantity(this.randomObj)}})}updateProd(){return(0,s.mG)(this,void 0,void 0,function*(){this.restApiService.getCart().subscribe(t=>{this.allCart=t;let e=0,i=[];i=this.allCart.products,console.log(i),i.forEach(t=>{t.qty=this.quantity,t.item.packPrice&&(e+=parseInt(t.item.packPrice)*t.qty)}),console.log(e);let s=[],r=[],o=[];for(let a=0;a<i.length;a++){let t={};console.log(i[a]),t=i[a].item.nbrBtl?{newquantity:i[a].qty+i[a].item.nbrBtl,id:i[a].item._id}:{newquantity:i[a].qty,id:i[a].item._id},i[a].item.productType&&"manufacturedItems"==i[a].item.productType&&o.push(t),i[a].item.productType?s.push(t):(i[a].item.newquantity=i[a].qty,r.push(i[a]))}r.length&&this.sendPackToServer(r,s),o.length&&this.sendProductRestoToServer(o),this.adminService.sendPurchase({articles:this.allCart,quantity:this.quantity,totalPrice:e}).subscribe(t=>{console.log("end of all"),console.log(t)}),console.log(r.length),r.length||(s[0].productId=this.productItem.productId,s[0].storeId=this.store,s[0].multi_store=!0,this.restApiService.updateMoreProductItem({tab:s,multi_store:!0,storeId:this.store}).subscribe(t=>{console.log("send pack ok"),console.log(t),this.warehouseService.updateProductItemStore1({id:this.productItem._id,quantity:this.quantity,prod:this.productItem,sender:"this.userName",storeId:this.store,multi_store:!0,productId:this.productItem.productId}).subscribe(t=>{console.log(t),this.quantity=0})}))})})}sendPackToServer(t,e){return new Promise((i,s)=>{this.countItemsService.countProductsItems(t).then(t=>{t.length&&this.restApiService.updateMorePackItem({tab:t}).subscribe(s=>{t.forEach(t=>{console.log(t),e.push({newquantity:t.newquantity,id:t.productItemId,noRistourne:t.noRistourne})}),this.restApiService.updateMoreProductItem({tab:e}).subscribe(t=>{console.log("send pack ok"),console.log(t),i("ok")})})})})}sendProductRestoToServer(t){}takeUrl(){this.urlService.getUrl().subscribe(t=>{this.url=t;let e=localStorage.getItem("adminId");this.webServerSocket(e)})}webServerSocket(t){console.log(this.url),this.sockets=o()(this.url),this.sockets.on("connect",function(){}),this.sockets.on(`${t}productItemStore`,t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(c.IN),a.Y36(c.HT),a.Y36(n.l),a.Y36(l.u),a.Y36(u.e),a.Y36(d.B),a.Y36(h.w),a.Y36(p.l),a.Y36(m.i))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-refueling"]],decls:19,vars:3,consts:[["slot","start"],[3,"click"],["name","arrow-back-outline"],["position","floating"],["type","number","autofocus","true",3,"value","input"],["slot","end","color","success"],["cancelText","cancel","okText","Okay","interface","popover",3,"ionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar"),a.TgZ(2,"ion-buttons",0),a.TgZ(3,"ion-button",1),a.NdJ("click",function(){return e.dismiss()}),a._UZ(4,"ion-icon",2),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(5,"ion-content"),a.TgZ(6,"ion-item"),a.TgZ(7,"ion-label",3),a._uU(8,"quantity"),a.qZA(),a.TgZ(9,"ion-input",4),a.NdJ("input",function(t){return e.addQuantity(t)}),a.qZA(),a.TgZ(10,"ion-note",5),a._uU(11),a.qZA(),a.qZA(),a.TgZ(12,"ion-item"),a.TgZ(13,"ion-label"),a._uU(14,"SELECT STORE"),a.qZA(),a.TgZ(15,"ion-select",6),a.NdJ("ionChange",function(t){return e.assignSore(t)}),a.YNc(16,I,2,2,"ion-select-option",7),a.qZA(),a.qZA(),a.TgZ(17,"ion-button",1),a.NdJ("click",function(){return e.updateProductItems()}),a._uU(18,"submit"),a.qZA(),a.qZA()),2&t&&(a.xp6(9),a.Q6J("value",e.quantity),a.xp6(2),a.hij("disponible: ",e.productItem.quantityItems,""),a.xp6(5),a.Q6J("ngForOf",e.storeList))},directives:[c.Gu,c.sr,c.Sm,c.YG,c.gu,c.W2,c.Ie,c.Q$,c.pK,c.as,c.uN,c.t9,c.QI,g.sg,c.n0],styles:[""]}),t})()},866:(t,e,i)=>{"use strict";i.d(e,{l:()=>n});var s=i(529),r=i(1036),o=i(1572),a=i(9063),c=i(2968);let n=(()=>{class t{constructor(t,e){this.http=t,this.urlService=e,this.url="http://192.168.100.10:3000/",this.takeUrl()}takeUrl(){s.N.production?this.urlService.getUrl().subscribe(t=>{this.url=t,console.log("url",this.url)}):this.url=s.V}updateProductItemStore(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}updateProductItemStore1(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.put(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}confirmProductItemStore(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e="";if(localStorage.getItem("openCashDateId")?e=localStorage.getItem("openCashDateId"):JSON.parse(localStorage.getItem("openCashDateObj"))&&(e=JSON.parse(localStorage.getItem("openCashDateObj"))._id),e)return this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm?db=${this.id}&openCashDate=${e}`,t)}updateManufacturedItemStore(t){this.id=localStorage.getItem("adminId");let e=localStorage.getItem("openCashDateId");return this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store?db=${this.id}&openCashDate=${e}`,t).pipe()}updateManufacturedItemStoreConfirm(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e=localStorage.getItem("openCashDateId");return this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store/confirm?db=${this.id}&openCashDate=${e}`,t).pipe()}updateIce(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm/glacer?db=${this.id}`,t)}setProductItem(t){console.log(t),this.product=t}getProductItem(){return(0,r.isNullOrUndefined)(this.product)?0:this.product}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(a.eN),o.LFG(c.i))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);