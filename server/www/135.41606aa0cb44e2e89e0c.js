(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[135],{135:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ActivitiePageModule:()=>J});var o=i(1511),n=i(6073),s=i(8777),c=i(8158),a=i(4762),r=i(994),l=i(1344),d=i.n(l),g=i(529),h=i(1572),m=i(5946),p=i(731),u=i(2968),f=i(4144),v=i(5541),Z=i(7886),C=i(8249);function x(t,e){1&t&&(h.TgZ(0,"ion-row"),h.TgZ(1,"ion-col"),h.TgZ(2,"div",12),h.TgZ(3,"h3"),h._uU(4,"Not result"),h.qZA(),h.qZA(),h.qZA(),h.qZA())}function O(t,e){1&t&&(h.TgZ(0,"ion-row",13),h.TgZ(1,"ion-col",14),h.TgZ(2,"div",15),h._uU(3,"N0"),h.qZA(),h.qZA(),h.TgZ(4,"ion-col",16),h.TgZ(5,"div",15),h._uU(6,"date"),h.qZA(),h.qZA(),h.TgZ(7,"ion-col",17),h.TgZ(8,"div",15),h._uU(9,"montant"),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",14),h.TgZ(11,"div",15),h._uU(12,"table"),h.qZA(),h.qZA(),h.TgZ(13,"ion-col",16),h.TgZ(14,"div",15),h._uU(15,"N0 com"),h.qZA(),h.qZA(),h.TgZ(16,"ion-col",16),h.TgZ(17,"div",15),h._UZ(18,"small"),h.qZA(),h.qZA(),h.qZA())}const T=function(t){return{"order-pick":t}};function I(t,e){if(1&t&&(h.TgZ(0,"small",24),h._UZ(1,"ion-icon",25),h.qZA()),2&t){const t=h.oxw().$implicit;h.Q6J("ngClass",h.VKq(1,T,!0===t.pick))}}function A(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"small"),h._UZ(2,"ion-icon",26),h.qZA(),h.TgZ(3,"small"),h.TgZ(4,"ion-icon",27),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().displayDetails(e)}),h.qZA(),h.qZA(),h.qZA()}}function P(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"small"),h._UZ(2,"ion-icon",28),h.qZA(),h.TgZ(3,"small"),h.TgZ(4,"ion-icon",27),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().displayDetails(e)}),h.qZA(),h.qZA(),h.qZA()}}function S(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div",29),h.TgZ(1,"small"),h.TgZ(2,"ion-icon",30),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().serviceConfirm(e)}),h.qZA(),h.qZA(),h.TgZ(3,"small"),h.TgZ(4,"ion-icon",31),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().pickInvoice(e)}),h.qZA(),h.qZA(),h.TgZ(5,"small"),h.TgZ(6,"ion-icon",27),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().displayDetails(e)}),h.qZA(),h.qZA(),h.qZA()}}function _(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"small",34),h.NdJ("click",function(){h.CHM(t);const e=h.oxw(2).$implicit;return h.oxw().confirmCancel(e)}),h._UZ(1,"ion-icon",35),h.qZA()}}function q(t,e){if(1&t){const t=h.EpF();h.TgZ(0,"div"),h.TgZ(1,"small"),h.TgZ(2,"ion-icon",32),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().serviceConfirm(e)}),h.qZA(),h.qZA(),h.TgZ(3,"small"),h.TgZ(4,"ion-icon",27),h.NdJ("click",function(){h.CHM(t);const e=h.oxw().$implicit;return h.oxw().displayDetails(e)}),h.qZA(),h.qZA(),h.YNc(5,_,2,0,"small",33),h.qZA()}if(2&t){const t=h.oxw().$implicit;h.xp6(5),h.Q6J("ngIf",!t.sale)}}const b=function(t){return{"background-color":t}},w=function(t){return[t,"FCFA","symbol","3.0-0","fr"]};function y(t,e){if(1&t&&(h.TgZ(0,"ion-row",18),h.TgZ(1,"ion-col",14),h.TgZ(2,"div",19),h._uU(3),h.qZA(),h.qZA(),h.TgZ(4,"ion-col",16),h.TgZ(5,"div",19),h._uU(6),h.ALo(7,"date"),h.qZA(),h.qZA(),h.TgZ(8,"ion-col",17),h.TgZ(9,"div",19),h.YNc(10,I,2,3,"small",20),h._uU(11),h.ALo(12,"currency"),h.qZA(),h.qZA(),h.TgZ(13,"ion-col",14),h.TgZ(14,"div",19),h._uU(15),h.qZA(),h.qZA(),h.TgZ(16,"ion-col",16),h.TgZ(17,"div",19),h._uU(18),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",21),h.TgZ(20,"div",22),h.YNc(21,A,5,0,"div",7),h.YNc(22,P,5,0,"div",7),h.YNc(23,S,7,0,"div",23),h.YNc(24,q,6,1,"div",7),h.qZA(),h.qZA(),h.qZA()),2&t){const t=e.$implicit;h.Q6J("ngStyle",h.VKq(20,b,e.index%2==0?"#f1f1f1":"white")),h.xp6(3),h.hij(" ",t.numFacture," "),h.xp6(3),h.hij(" ",h.xi3(7,11,t.created,"h:mm:ss")," "),h.xp6(4),h.Q6J("ngIf",t.pick),h.xp6(1),h.hij(" ",h.G7q(12,14,h.VKq(22,w,t.totalPrice))," "),h.xp6(4),h.hij(" ",t.tableNumber," "),h.xp6(3),h.hij(" ",t.commandes.length," "),h.xp6(3),h.Q6J("ngIf",t.sale),h.xp6(1),h.Q6J("ngIf",!t.confirm&&!t.Posconfirm),h.xp6(1),h.Q6J("ngIf",t.confirm&&t.Posconfirm&&!t.sale),h.xp6(1),h.Q6J("ngIf",!t.confirm&&t.Posconfirm)}}let N=(()=>{class t{constructor(t,e,i,o,n,s,c,a,r,l,d,g){this.adminService=t,this.modalController=e,this.translateConfigService=i,this.router=o,this.urlService=n,this.restApiService=s,this.loadingController=c,this.events=a,this.httpN=r,this.alertController=l,this.platform=d,this.invoiceService=g,this.invoices=[],this.invoices2=[],this.numPage=0,this.nbrPages=0,this.total=0,this.total2=0,this.sum=0,this.isLoading=!1,this.cmpt=0,this.languageChanged(),setTimeout(()=>{},1e3)}ngOnInit(){this.presentLoading3(),this.takeUrl()}ionViewWillEnter(){}getInvoicesFromStorage(){}takeUrl(){g.N.production?this.urlService.getUrl().subscribe(t=>{this.url=t}):(this.url=g.V,console.log(this.url)),this.urlService.getUrl().subscribe(t=>{this.getReadyCommande(),this.adminId=localStorage.getItem("adminId"),this.getInvoicesFromStorage()}),this.urlService.getUrlEvent().subscribe(t=>{this.urlEvent=t})}languageChanged(){let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}getInvoice(){return(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.loadingController.create({cssClass:"my-custom-class",message:"Traitement en cours...",duration:1e3});yield t.present(),this.events.storeOrders({},"get",[]).then(t=>{this.invoices=t,this.invoices.forEach(t=>{let e=0;t.commandes.forEach(t=>{e+=parseInt(t.cartdetails.totalPrice)}),t.totalPrice=e}),this.invoices=this.invoices.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1);let e=[];e=this.invoices.filter(t=>!0===t.sale),e.forEach(t=>{this.total=this.total+t.commande.cartdetails.totalPrice,t.commandes.forEach(t=>{this.total=this.total+parseInt(t.cartdetails.totalPrice)})});let i=[];i=this.invoices.filter(t=>!1===t.sale),i.forEach(t=>{t.commandes.forEach(t=>{this.total2=this.total+parseInt(t.cartdetails.totalPrice)})}),this.sum=this.total+this.total2})})}loadData(t){let e=this.numPage+1;e>this.nbrPages?t.target.disabled=!0:this.adminService.getInvoiceByEmployee(e).subscribe(e=>{if(t.target.complete(),console.log(e),e&&e.docs.docs){this.numPage=parseInt(e.docs.page),this.nbrPages=e.docs.pages;let t=[...this.invoices,...e.docs.docs];this.invoices=t;let i=[];i=this.invoices.filter(t=>!0===t.sale),i.forEach(t=>{this.total=this.total+t.commande.cartdetails.totalPrice});let o=[];o=this.invoices.filter(t=>!1===t.sale),o.forEach(t=>{this.total2=this.total2+t.commande.cartdetails.totalPrice}),this.sum=this.total+this.total2}},t=>{console.log("error here",t)})}serviceConfirm(t){return(0,a.mG)(this,void 0,void 0,function*(){let e=localStorage.getItem("adminId");localStorage.getItem("adminemail"),this.presentLoading3(),JSON.parse(localStorage.getItem("setting")).use_desktop?this.invoiceService.updateInvoice(this.url+`invoice/confirmOders/service?localId=${t.localId}`,{localId:t.localId,adminId:e}).subscribe(e=>{console.log(e),this.dismissLoading(),t.confirm=!0,this.events.storeOrders(t,"patch",this.invoices).then(t=>{let e=this.invoices.findIndex(e=>e.localId===t.localId);e>=0&&this.invoices.splice(e,1,t)})}):setTimeout(()=>{if(t.localId){let i=JSON.stringify({localId:t.localId,adminId:e}),o=this.url+`invoice/confirmOders/service?localId=${t.localId}`;this.httpN.setDataSerializer("utf8"),this.httpN.patch(o,i,{}).then(e=>{this.dismissLoading(),t.confirm=!0,this.events.storeOrders(t,"patch",this.invoices).then(t=>{let e=this.invoices.findIndex(e=>e.localId===t.localId);e>=0&&this.invoices.splice(e,1,t)}),JSON.parse(localStorage.getItem("roles")).includes(4)}).catch(e=>{setTimeout(()=>{this.serviceConfirm(t)},3e3)})}else this.dismissLoading()},3e3)})}orderServicesCancel(t){let e=localStorage.getItem("adminId");if(t.localId){this.presentLoading3();let i=JSON.stringify({localId:t.localId,adminId:e}),o=this.url+`invoice/confirmOders/invoice/cancel?localId=${t.localId}`;this.httpN.setDataSerializer("utf8"),this.httpN.patch(o,i,{}).then(e=>{this.dismissLoading(),this.invoices=this.invoices.filter(e=>e.localId!=t.localId),localStorage.setItem("allCommande",JSON.stringify(this.invoices))}).catch(t=>{alert("impossible de joindre la caisse")})}}displayDetails(t){return(0,a.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.modalController.create({component:r.k,componentProps:{order:t,Pos:!0},cssClass:"custom-modal"});return e.onDidDismiss().then(t=>{console.log(t)}),yield e.present()})}webServerSocket(t){let e=JSON.parse(localStorage.getItem("user")).storeId;this.sockets=d()(this.urlEvent),this.sockets.on(`${t}${e}buyOrder`,t=>{this.events.storeOrders(t,"add",this.invoices).then(t=>{this.invoices=t}),this.displayAmount()}),this.sockets.on(`${t}invoiceCancel`,t=>{}),this.sockets.on(`${t}confirmOrder`,t=>{})}displayAmount(){this.total2=0,this.sum=0,this.total=0;let t=[];t=this.invoices.filter(t=>!0===t.sale),t.forEach(t=>{this.total=this.total+t.commande.cartdetails.totalPrice});let e=[];e=this.invoices.filter(t=>!1===t.sale),e.forEach(t=>{this.total2=this.total2+t.commande.cartdetails.totalPrice}),this.sum=this.total+this.total2}pickInvoice(t){return(0,a.mG)(this,void 0,void 0,function*(){localStorage.setItem("order",JSON.stringify(t)),localStorage.setItem("addFlag",JSON.stringify(!0)),this.router.navigateByUrl("shop")})}updateOrder(t){return(0,a.mG)(this,void 0,void 0,function*(){localStorage.setItem("order_update",JSON.stringify(t)),localStorage.setItem("old",JSON.stringify(t)),this.router.navigateByUrl("update-order")})}presentLoading2(){return(0,a.mG)(this,void 0,void 0,function*(){return yield this.loadingController.create({duration:2e3,cssClass:"my-custom-class",message:"Traitement en cours..."}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then()})})})}presentLoading3(){return(0,a.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:6e3,cssClass:"my-custom-class",message:"Traitement en cours..."}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then()})})})}dismissLoading(){return(0,a.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then()})}confirmCancel(t){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield this.alertController.create({cssClass:"my-custom-class",header:"Confirm!",message:"Cancel bill?",buttons:[{text:"NO",role:"cancel",cssClass:"secondary",handler:t=>{console.log("Confirm Cancel: blah")}},{text:"OK",handler:()=>{this.orderServicesCancel(t)}}]});yield e.present()})}getReadyCommande(){let t=JSON.parse(localStorage.getItem("setting")),e=JSON.parse(localStorage.getItem("roles"));if(this.platform.is("desktop")||this.platform.is("electron")||t.use_desktop)return console.log("desktop activity"),void this.adminService.getInvoiceNotPaie().subscribe(t=>{let e=JSON.parse(localStorage.getItem("user"))._id;this.dismissLoading(),this.invoices=t.docs,this.invoices=this.invoices.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1).filter(t=>!1===t.sale&&t.senderId==e),this.invoices.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e})},t=>{console.log(t)});if(e.includes(5)){let t=JSON.parse(localStorage.getItem("user"))._id,e=JSON.stringify({sender:t}),i=this.url+`invoice/ready/to/take?localId=${t}`;this.httpN.setDataSerializer("utf8"),this.httpN.patch(i,e,{}).then(t=>{let e=JSON.parse(JSON.stringify(t));this.invoices=JSON.parse(e.data),this.events.storeOrders(this.invoices,"saveAll",this.invoices).then(t=>{}),this.dismissLoading(),this.invoices=this.invoices.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),this.invoices.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e})}).catch(t=>{this.cmpt=this.cmpt+1,5===this.cmpt?this.dismissLoading():setTimeout(()=>{this.getReadyCommande()},2e3)})}else{let t=JSON.parse(localStorage.getItem("user"))._id,e=JSON.stringify({sender:t}),i=`http://127.0.0.1:3000/invoice/ready/to/take?localId=${t}`;this.httpN.setDataSerializer("utf8"),this.httpN.patch(i,e,{}).then(t=>{let e=JSON.parse(JSON.stringify(t));this.invoices=JSON.parse(e.data),this.events.storeOrders(this.invoices,"saveAll",this.invoices).then(t=>{}),this.dismissLoading(),this.invoices=this.invoices.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),this.invoices.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e})}).catch(t=>{this.cmpt=this.cmpt+1,5===this.cmpt?this.dismissLoading():setTimeout(()=>{this.getReadyCommande()},2e3)})}}}return t.\u0275fac=function(e){return new(e||t)(h.Y36(m.l),h.Y36(c.IN),h.Y36(p.w),h.Y36(s.F0),h.Y36(u.i),h.Y36(f.e),h.Y36(c.HT),h.Y36(v.t),h.Y36(Z.t),h.Y36(c.Br),h.Y36(c.t4),h.Y36(C.x))},t.\u0275cmp=h.Xpm({type:t,selectors:[["app-activitie"]],decls:16,vars:3,consts:[["color","primary"],["slot","start"],["autoHide","false"],[1,"ion-justify-content-start"],["size","3"],[1,"ion-text-start","ion-text-uppercase","ion-text-nowrap",3,"click"],["fill","outline","color","light"],[4,"ngIf"],["class","header-row",4,"ngIf"],["class","data-row data-update",3,"ngStyle",4,"ngFor","ngForOf"],["threshold","100px",3,"ionInfinite"],["loadingSpinner","bubbles","loadingText","Loading more data..."],[1,"ion-text-center","ion-text-uppercase"],[1,"header-row"],["size","1","size-md","1",1,"ion-align-self-center"],[1,"ion-text-center"],["size","2","size-md","2",1,"ion-align-self-center"],["size","3","size-md","3",1,"ion-align-self-center"],[1,"data-row","data-update",3,"ngStyle"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap"],[3,"ngClass",4,"ngIf"],["size","3","size-md","2",1,"ion-align-self-center"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap","status"],["class","iconaction",4,"ngIf"],[3,"ngClass"],["name","checkbox-outline"],["color","medium","name","checkmark-circle-outline"],["color","dark","name","eye",3,"click"],["color","danger","name","checkmark-circle-outline"],[1,"iconaction"],["color","success","name","checkmark-circle-outline",3,"click"],["name","add",3,"click"],["color","warning","name","checkmark-circle-outline",3,"click"],["class","smallToadd",3,"click",4,"ngIf"],[1,"smallToadd",3,"click"],["name","trash"]],template:function(t,e){1&t&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar",0),h.TgZ(2,"ion-buttons",1),h._UZ(3,"ion-menu-button",2),h.qZA(),h.TgZ(4,"ion-row",3),h.TgZ(5,"ion-col",4),h.TgZ(6,"div",5),h.NdJ("click",function(){return e.router.navigateByUrl("shop")}),h.TgZ(7,"ion-button",6),h._uU(8," service "),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(9,"ion-content"),h.TgZ(10,"ion-grid"),h.YNc(11,x,5,0,"ion-row",7),h.YNc(12,O,19,0,"ion-row",8),h.YNc(13,y,25,24,"ion-row",9),h.qZA(),h.TgZ(14,"ion-infinite-scroll",10),h.NdJ("ionInfinite",function(t){return e.loadData(t)}),h._UZ(15,"ion-infinite-scroll-content",11),h.qZA(),h.qZA()),2&t&&(h.xp6(11),h.Q6J("ngIf",0==e.invoices.length),h.xp6(1),h.Q6J("ngIf",e.invoices.length),h.xp6(1),h.Q6J("ngForOf",e.invoices))},directives:[c.Gu,c.sr,c.Sm,c.fG,c.Nd,c.wI,c.YG,c.W2,c.jY,o.O5,o.sg,c.ju,c.MB,o.PC,o.mk,c.gu],pipes:[o.uU,o.H9],styles:["p[_ngcontent-%COMP%]{margin:0;padding:0}.orders[_ngcontent-%COMP%]{background-color:#f1f1f1;width:100%}.iconprint[_ngcontent-%COMP%]{margin-left:15px}.userName[_ngcontent-%COMP%]{font-size:11px;position:absolute;left:80%;bottom:8%;color:#fa3434}.allIcon[_ngcontent-%COMP%]{position:absolute;left:88%;font-size:24px;margin-bottom:15px}.tableNumber2[_ngcontent-%COMP%]{font-size:9px;position:absolute;left:50%;bottom:1%;color:#1d72f3}ion-badge[_ngcontent-%COMP%]{text-transform:uppercase;font-size:7px}.vente[_ngcontent-%COMP%]{font-size:8px;display:flex;flex-wrap:nowrap;flex-direction:row-reverse}.vente[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:10px;text-align:center}.statSale[_ngcontent-%COMP%]{position:absolute;left:9%;top:0;margin:5px}.a1[_ngcontent-%COMP%]{font-size:8px;margin-left:10px}.a2[_ngcontent-%COMP%]{font-size:10px;color:#4e4ef8}.allIconText[_ngcontent-%COMP%]{position:absolute;color:#adff2f}.btnDetails[_ngcontent-%COMP%]{position:relative;top:20%;left:9%;font-size:22px}.iconStart[_ngcontent-%COMP%]{position:relative;bottom:12%;margin-right:10%}.label[_ngcontent-%COMP%]{margin-bottom:15%}.header-row[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#000;padding-top:5px;padding-bottom:5px}.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-transform:uppercase;font-size:11px}.data-row[_ngcontent-%COMP%]{border-bottom:1px solid #f1f1f1}.divrow[_ngcontent-%COMP%]{width:100%}.priceactivie[_ngcontent-%COMP%]{font-size:12px}.priceactivie2[_ngcontent-%COMP%]{padding-right:4px}p[_ngcontent-%COMP%]{display:flex;justify-content:space-between}p[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:32px;padding:0}.status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.status[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:25px;padding:0}.order-pick[_ngcontent-%COMP%]{z-index:2;position:absolute}.order-pick[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#adff2f;font-size:20px}.smallToadd[_ngcontent-%COMP%]{font-size:17px}ion-col[_ngcontent-%COMP%]{--ion-grid-column-padding:0px;margin:0}.ion-text-uppercase[_ngcontent-%COMP%]{font-size:13px;padding:0;margin:0}.ion-text-uppercase[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{padding:0;margin:0}.ion-text-uppercase[_ngcontent-%COMP%]   .iconaction[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]}),t})();var k=i(1064);const M=[{path:"",component:N}];let J=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=h.oAB({type:t}),t.\u0275inj=h.cJS({imports:[[o.ez,n.u5,c.Pc,s.Bz.forChild(M),k.aw.forChild()]]}),t})()}}]);