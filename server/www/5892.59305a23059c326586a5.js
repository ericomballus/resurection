(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[5892],{5892:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ProductBuyPageModule:()=>R});var s=i(1511),r=i(6073),o=i(8777),a=i(8158),c=i(4762),n=i(9942),l=i(1572),d=i(4144),u=i(3437),h=i(4892),p=i(1044),m=i(9719),g=i(1611),v=i(4375),f=i(5075);const b=["mySlider"];function P(t,e){if(1&t&&(l.TgZ(0,"ion-badge",2),l._uU(1),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.Oqu(t.totalItems)}}function y(t,e){if(1&t&&(l.TgZ(0,"ion-badge",2),l._uU(1),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.Oqu(t.totalItems+t.totalBtl)}}function S(t,e){if(1&t){const t=l.EpF();l.TgZ(0,"ion-button",6),l.NdJ("click",function(){return l.CHM(t),l.oxw().openCart()}),l.YNc(1,P,2,1,"ion-badge",7),l.YNc(2,y,2,1,"ion-badge",7),l._UZ(3,"ion-icon",8),l.qZA()}if(2&t){const t=l.oxw();l.xp6(1),l.Q6J("ngIf",0==t.totalBtl),l.xp6(1),l.Q6J("ngIf",t.totalBtl>=1)}}function k(t,e){if(1&t&&(l.TgZ(0,"div",11),l._uU(1),l.ALo(2,"currency"),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.AsE(" ",t.totalItems," items = FCFA ",l.gM2(2,2,t.totalPrice,"CFA","symbol","3.0-0")," ")}}function I(t,e){if(1&t&&(l.TgZ(0,"div",11),l._uU(1),l.ALo(2,"currency"),l.qZA()),2&t){const t=l.oxw(2);l.xp6(1),l.lnq(" ",t.totalItems," items + ",t.totalBtl,"item = FCFA ",l.gM2(2,3,t.totalPrice,"CFA","symbol","3.0-0")," ")}}function A(t,e){if(1&t&&(l.TgZ(0,"div",9),l.YNc(1,k,3,7,"div",10),l.YNc(2,I,3,8,"div",10),l.qZA()),2&t){const t=l.oxw();l.xp6(1),l.Q6J("ngIf",0==t.totalBtl),l.xp6(1),l.Q6J("ngIf",t.totalBtl>=1)}}let C=(()=>{class t{constructor(t,e,i,s,r,o,a,c,n,l,d,u){this.restApiService=t,this.manageCartService=e,this.navCtrl=i,this.modalController=s,this.alertController=r,this.router=o,this.loadingController=a,this.socket=c,this.rangeByStoreService=n,this.getStoreName=l,this.resourceService=d,this.saveRandom=u,this.products=[],this.productRestoItem=[],this.packs=[],this.packs2=[],this.allProducts=[],this.totalItems=0,this.totalPrice=0,this.isItemAvailable=!1,this.isItemAvailable2=!1,this.btnProducts=!1,this.btnAllProducts=!1,this.btnResto=!1,this.btnPack=!0,this.isLoading=!1,this.tabRoles=[],this.multiStoreResourceitem=[],this.multiStoreList=[],this.multiStoreService=[],this.totalBtl=0,this.storeTypeTab=[],this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.storeTypeTab=JSON.parse(localStorage.getItem("adminUser")).storeType,(this.storeTypeTab.includes("bar")||this.storeTypeTab.includes("resto"))&&this.storeTypeTab.push("resource"),this.tabRoles.includes(1)||this.tabRoles.includes(2)||this.tabRoles.includes(6)?this.adminId=localStorage.getItem("adminId"):this.router.navigateByUrl("Login"),this.tabRoles.includes(2)}ionViewWillEnter(){}getItems(){this.takePack(),setTimeout(()=>{this.takePackitems(),this.takeProduct(),this.getResources(),this.takeProductListShop(),this.takeProductServiceList()},500),setTimeout(()=>{this.takeProductResto()},1e3)}ngOnInit(){this.getItems()}webServerSocket(t){this.socket.connect(),this.socket.emit("set-name",name),this.socket.fromEvent(`${t}newProductItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){})),this.socket.fromEvent(`${t}productItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){if(t&&t._id){let e=yield this.products.findIndex(e=>e._id===t._id),i=this.products[e].url;this.products.splice(e,1,t),this.products[e].url=i}})),this.socket.fromEvent(`${t}productItemDelete`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){})),this.socket.fromEvent(`${t}manufacturedItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){if(t&&t._id){let e=yield this.productResto.findIndex(e=>e._id===t._id);if(e>=0){this.productResto.splice(e,1,t);let i=this.productResto[e].url;this.productResto.splice(e,1,t),this.productResto[e].url=i}}}))}takeProduct(){return(0,c.mG)(this,void 0,void 0,function*(){this.restApiService.getProductItem().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){this.products=t,console.log("this is product====>",t)}))})}takePackitems(){return(0,c.mG)(this,void 0,void 0,function*(){let t={};this.restApiService.getProduct().subscribe(e=>{console.log("product get here====>",e);let i=e.products.filter(t=>0==t.desabled);e.products.forEach(e=>{t[e._id]=e}),i.forEach(t=>(0,c.mG)(this,void 0,void 0,function*(){t.resourceList.length>0?this.packs=this.packs.filter(e=>e.productId!==t._id):this.packs.forEach(e=>{e.productId==t._id&&(e.packPrice=t.packPrice)})}));let s=[];this.packs.forEach(e=>{t[e.productId]&&s.push(e)}),this.packs=s,this.rangeByStoreService.rangeProductByStore(this.packs).then(t=>{this.multiStoreProductitem=t})})})}removeToPack(t){return new Promise((e,i)=>{this.packs=this.packs.find(e=>e.productId!==t._id),e("ok")})}takePack(){this.restApiService.getPack().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){t.forEach(t=>{t.name.replace(/\s/g,""),t.name=t.name.toUpperCase()}),t.sort((t,e)=>t.name>e.name?1:e.name>t.name?-1:0),this.packs=t,this.packs=this.packs.filter(t=>null!==t.productId),console.log("packs===",this.packs)}))}getResources(){this.resourceService.getResourcesItem().subscribe(t=>{this.resourceItem=t.resources.filter(t=>0==t.desabled),this.rangeByStoreService.rangeProductByStore(this.resourceItem).then(t=>{this.multiStoreResourceitem=t})})}next(){this.slides.slideNext()}prev(){this.slides.slidePrev()}buyItem(t){let e=Object.keys(t);this.restApiService.saveCart({}),this.totalItems=0,this.totalPrice=0;for(const i of e)t[i].prod.removeQuantity=t[i].sale,this.totalItems=this.totalItems+t[i].sale,this.totalPrice=this.totalPrice+t[i].coast,this.buyPackProduct(t[i].prod)}updatePackProduct(t){this.cartValue=this.restApiService.getCart2(),console.log(this.cartValue)}buyPackProduct(t){let e=t._id;if(this.cartValue=this.restApiService.getCart2(),this.cartValue&&this.cartValue.cart){let i={};i.product=t,i.cart=this.cartValue.cart;let s=this.manageCartService.addToCart(i),r=s.items;for(const t in r);let o=[];o=s.generateArray().filter(t=>t.item._id===e);let a=this.packs.findIndex(e=>e._id===t._id);t.qty=o[0].qty,this.packs.splice(a,1,t),this.restApiService.saveCart({cart:s,products:s.generateArray()})}else{let i=this.manageCartService.addToCart(t),s=i.items;for(const t in s);let r=[];r=i.generateArray().filter(t=>t.item._id===e);let o=this.packs.findIndex(e=>e._id===t._id);t.qty=r[0].qty,this.packs.splice(o,1,t),this.packs.splice(o,1,t),this.restApiService.saveCart({cart:i,products:i.generateArray()})}}displayPriceQuantity(t){let e=Object.keys(t);this.restApiService.saveCart({}),this.totalItems=0,this.totalPrice=0;for(const i of e)t[i].prod.removeQuantity=t[i].sale,1===t[i].remove?(this.totalItems=this.totalItems+t[i].sale,this.totalPrice=this.totalPrice+t[i].coast):(t[i].prod.nbrBtl>=1&&(this.totalPrice=this.totalPrice+t[i].prod.nbrBtl*t[i].prod.purchasingPrice,this.totalBtl=this.totalBtl+t[i].prod.nbrBtl),this.totalItems=this.totalItems+t[i].sale,this.totalPrice=this.totalPrice+t[i].coast),console.log(t[i].prod),this.buyPackProduct(t[i].prod)}segmentChanged(t){let e=t.target.value;"product"===e?(this.btnAllProducts=!1,this.btnPack=!1,this.btnProducts=!0,this.btnResto=!1,console.log(this.products)):"productResto"===e?(this.btnResto=!0,this.btnProducts=!1,this.btnAllProducts=!1,this.btnPack=!1):"pack"===e?(this.btnResto=!1,this.btnProducts=!1,this.btnAllProducts=!1,this.btnPack=!0):(this.btnResto=!1,this.btnProducts=!1,this.btnAllProducts=!0,this.btnPack=!1)}buyPack(t){if(this.cartValue=this.restApiService.getCart2(),this.cartValue){let e={};e.product=t,e.cart=this.cartValue.cart;let i=this.manageCartService.addToCart(e);this.totalItems=i.totalQty,this.restApiService.saveCart({cart:i,products:i.generateArray()})}else{let e=this.manageCartService.addToCart(t);this.totalItems=e.totalQty,this.restApiService.saveCart({cart:e,products:e.generateArray()})}}getCart(){this.cartValue=this.restApiService.getCart()}displayCart(){this.navCtrl.navigateForward("cart")}openCart(){return(0,c.mG)(this,void 0,void 0,function*(){this.saveRandom.setResumePurchase({totalPrice:this.totalPrice,totalItems:this.totalItems,totalBtl:this.totalBtl});const t=yield this.modalController.create({component:n.V,componentProps:{commande:!0}});return t.onDidDismiss().then(t=>(this.restApiService.saveCart(t.data),"update"===t.data?(this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.products.forEach(t=>{t.qty=0,t.fisrtValueAdd=0,t.inputValue=0}),this.packs.forEach(t=>{t.qty=0,t.fisrtValueAdd=0,t.inputValue=""}),void setTimeout(()=>{this.packs=[],this.productRestoItem=[],this.router.navigateByUrl("/purchase")},2e3)):t.data.length?(this.packs.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabPacks(e,i))})}),void this.products.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabProducts(e,i))})})):void("update"===t.data?(this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.router.navigateByUrl("product-item-list"),this.products.forEach(t=>{t.qty&&(t.qty=0)}),this.packs.forEach(t=>{t.qty&&(t.qty=0)}),this.router.navigateByUrl("product-item-list")):this.restApiService.saveCart(t.data)))),yield t.present()})}priceChange(t){console.log(t),this.Itemprice=t.sellingPrice}displayPrice(t){this.Reduction=t}presentAlert(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"Alert",subHeader:"Subtitle",message:"le prix entr\xe9 n.est pas bon.",buttons:["OK"]});yield t.present()})}initializeItems(){this.products2=this.products}handleInputItems(t){this.presentLoading();const e=t.target.value;e&&""!=e.trim()?(this.isItemAvailable=!0,this.restApiService.getProductByName(e).subscribe(t=>{this.dismissLoading(),this.products2=t.product})):(this.isItemAvailable=!1,this.products2=[])}handleInputPack(t){this.presentLoading();const e=t.target.value;e&&""!=e.trim()?(this.isItemAvailable2=!0,this.restApiService.getPackitemByName(e).subscribe(t=>{this.dismissLoading(),this.pack2=t.pack})):(this.isItemAvailable2=!1,this.pack2=[])}presentLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:3e3}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then(()=>{})})})})}dismissLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then(()=>{})})}search(t){this.isItemAvailable=!1,this.isItemAvailable2=!1}updateTabPacks(t,e){let i=t,s=this.packs.findIndex(t=>t._id===e);this.packs.splice(s,1,i)}updateTabProducts(t,e){let i=t,s=this.products.findIndex(t=>t._id===e);this.products.splice(s,1,i)}buyItemResto(t){return(0,c.mG)(this,void 0,void 0,function*(){let e=t._id;if(this.cartValue=this.restApiService.getCart2(),this.cartValue&&this.cartValue.cart){let i={};i.product=t,i.cart=this.cartValue.cart;let s=this.manageCartService.addToCart(i);this.totalItems=s.totalQty,this.totalPrice=s.totalPrice;let r=[];r=s.generateArray().filter(t=>t.item._id===e);let o=this.productResto.findIndex(e=>e._id===t._id);t.qty=r[0].qty,this.productResto.splice(o,1,t),this.restApiService.saveCart({cart:s,products:s.generateArray()}),this.rangeByStoreService.rangeProductByStore(this.productResto).then(t=>{})}else{let i=this.manageCartService.addToCart(t);this.totalItems=i.totalQty,this.totalPrice=i.totalPrice;let s=[];s=i.generateArray().filter(t=>t.item._id===e);let r=this.productResto.findIndex(e=>e._id===t._id);t.qty=s[0].qty,this.productResto.splice(r,1,t),this.productResto.splice(r,1,t),this.restApiService.saveCart({cart:i,products:i.generateArray()}),this.rangeByStoreService.rangeProductByStore(this.productResto).then(t=>{})}})}takeProductResto(){this.restApiService.getManufacturedProductItemResto2().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){this.productResto=t,this.rangeByStoreService.rangeProductByStore(t).then(t=>{})}))}takeProductServiceList(){this.restApiService.getBillardList().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){let e=t.product.sort((t,e)=>t.name>e.name?1:-1);if(this.tabRoles.includes(2)){let t=this.saveRandom.getStoreId();e=e.filter(e=>e.storeId==t),this.productServiceTab=yield this.rangeByStoreService.rangeProductByStore(e),this.multiStoreService=this.productServiceTab}else this.productServiceTab=yield this.rangeByStoreService.rangeProductByStore(e),this.multiStoreService=this.productServiceTab}))}takeProductListShop(){this.restApiService.getShopList().subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){let e=t.product.sort((t,e)=>t.name>e.name?1:-1);this.productListTab=yield this.rangeByStoreService.rangeProductByStore(e),this.multiStoreList=this.productListTab}))}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(d.e),l.Y36(u.B),l.Y36(a.SH),l.Y36(a.IN),l.Y36(a.Br),l.Y36(o.F0),l.Y36(a.HT),l.Y36(h.sk),l.Y36(p.n),l.Y36(m.$),l.Y36(g.z),l.Y36(v.i))},t.\u0275cmp=l.Xpm({type:t,selectors:[["app-product-buy"]],viewQuery:function(t,e){if(1&t&&l.Gf(b,3),2&t){let t;l.iGM(t=l.CRH())&&(e.slides=t.first)}},decls:9,vars:8,consts:[["slot","start"],["defaultHref","/start"],["slot","end"],[3,"click",4,"ngIf"],[3,"multiStoreResource","multiStoreList","multiStoreService","multiStoreResto","packs","storeTypeTab","buyProduct","buyPacks","addBtl","displayItems"],["class","footer",4,"ngIf"],[3,"click"],["slot","end",4,"ngIf"],["color","dark","slot","end","name","cart"],[1,"footer"],["class","container footer2",4,"ngIf"],[1,"container","footer2"]],template:function(t,e){1&t&&(l.TgZ(0,"ion-header"),l.TgZ(1,"ion-toolbar"),l.TgZ(2,"ion-buttons",0),l._UZ(3,"ion-back-button",1),l.qZA(),l.TgZ(4,"ion-buttons",2),l.YNc(5,S,4,2,"ion-button",3),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"ion-content"),l.TgZ(7,"app-courses",4),l.NdJ("buyProduct",function(t){return e.buyItem(t)})("buyPacks",function(t){return e.buyPackProduct(t)})("addBtl",function(t){return e.updatePackProduct(t)})("displayItems",function(t){return e.displayPriceQuantity(t)}),l.qZA(),l.qZA(),l.YNc(8,A,3,2,"div",5)),2&t&&(l.xp6(5),l.Q6J("ngIf",e.totalItems||e.totalBtl),l.xp6(2),l.Q6J("multiStoreResource",e.multiStoreResourceitem)("multiStoreList",e.multiStoreList)("multiStoreService",e.multiStoreService)("multiStoreResto",e.productRestoItem)("packs",e.packs)("storeTypeTab",e.storeTypeTab),l.xp6(1),l.Q6J("ngIf",e.totalItems>0||e.totalBtl>0))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,s.O5,a.W2,f.j,a.YG,a.gu,a.yp],pipes:[s.H9],styles:[".lesbtn2[_ngcontent-%COMP%]{font-size:50%;text-transform:uppercase}.shopbtn[_ngcontent-%COMP%]{position:relative;left:8px}.col[_ngcontent-%COMP%]{align-items:center;background-color:aqua}.Btnitempack[_ngcontent-%COMP%], .col[_ngcontent-%COMP%]{text-align:center}ion-list[_ngcontent-%COMP%] > .productname[_ngcontent-%COMP%]{text-transform:uppercase;font-weight:700}.title[_ngcontent-%COMP%]{font-size:7px}.spane[_ngcontent-%COMP%], .title[_ngcontent-%COMP%]{font-weight:700}.spane[_ngcontent-%COMP%]{font-size:8px;position:absolute;bottom:70%;background-color:#151615;color:#fff}ion-card[_ngcontent-%COMP%]{box-shadow:none!important}.footer[_ngcontent-%COMP%]{background-color:#fff;padding-top:8%;padding-left:8%;padding-right:8%;position:relative}.footer2[_ngcontent-%COMP%]{background-color:#08d46e;padding:3%;text-align:center}ion-card-content[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#000;padding:1%;text-align:center}.colp[_ngcontent-%COMP%]{font-size:10px;text-transform:uppercase;padding:0}.badge[_ngcontent-%COMP%]{position:absolute;top:7%}"]}),t})();var _=i(9547);const T=[{path:"",component:C}];let R=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.oAB({type:t}),t.\u0275inj=l.cJS({imports:[[s.ez,r.u5,a.Pc,o.Bz.forChild(T),_.G]]}),t})()}}]);