(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[5499],{5499:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ProcurmentProductItemPageModule:()=>y});var o=i(1511),n=i(6073),s=i(8777),a=i(8158),r=i(4762),c=i(1344),l=i.n(c),d=i(1572),g=i(5946),u=i(866),m=i(731),Z=i(1064),h=i(2968),p=i(4144),f=i(4375),q=i(2874);function T(t,e){1&t&&(d.TgZ(0,"ion-title"),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,1,"MENU.outgoing_item")))}function I(t,e){1&t&&(d.TgZ(0,"ion-title"),d._uU(1),d.ALo(2,"translate"),d.qZA()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,1,"MENU.incoming_item")))}function A(t,e){1&t&&d._UZ(0,"ion-back-button",4)}function S(t,e){1&t&&d._UZ(0,"ion-back-button",5)}function v(t,e){if(1&t&&(d.TgZ(0,"small",13),d._uU(1),d.qZA()),2&t){const t=d.oxw().$implicit;d.xp6(1),d.hij(" ",t.quantityItems?t.quantityItems:0," ")}}function b(t,e){if(1&t&&(d.TgZ(0,"small",13),d.TgZ(1,"a",16),d._uU(2),d.qZA(),d._uU(3,"cas + "),d.TgZ(4,"a"),d._uU(5),d.qZA(),d._uU(6,"btl"),d.qZA()),2&t){const t=d.oxw().$implicit;d.xp6(2),d.Oqu(t.cassier?t.cassier:0),d.xp6(3),d.hij("",t.btls," ")}}const _=function(t){return{"background-color":t}};function U(t,e){if(1&t){const t=d.EpF();d.TgZ(0,"ion-row",10),d.TgZ(1,"ion-col",11),d.TgZ(2,"div",12),d.TgZ(3,"small",13),d._uU(4),d.ALo(5,"date"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"ion-col",11),d.TgZ(7,"div",12),d.TgZ(8,"small",13),d._uU(9),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-col",11),d.TgZ(11,"div",12),d.TgZ(12,"small",13),d._uU(13),d.qZA(),d.qZA(),d.qZA(),d.TgZ(14,"ion-col",11),d.TgZ(15,"div",12),d.YNc(16,v,2,1,"small",14),d.YNc(17,b,7,2,"small",14),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",11),d.TgZ(19,"div",12),d._uU(20),d.qZA(),d.qZA(),d.TgZ(21,"ion-col",11),d.TgZ(22,"div",12),d.TgZ(23,"ion-button",15),d.NdJ("click",function(){d.CHM(t);const i=e.$implicit,o=e.index;return d.oxw(2).confirmTrasaction(i,o)}),d._uU(24,"valider"),d.qZA(),d.qZA(),d.qZA(),d.qZA()}if(2&t){const t=e.$implicit;d.Q6J("ngStyle",d.VKq(10,_,e.index%2==0?"#f1f1f1":"white")),d.xp6(4),d.hij(" ",d.xi3(5,7,t.created,"medium"),""),d.xp6(5),d.hij(" ",t.sender,""),d.xp6(4),d.hij(" ",t.name," "),d.xp6(3),d.Q6J("ngIf","productItems"!==t.productType),d.xp6(1),d.Q6J("ngIf","productItems"==t.productType),d.xp6(3),d.hij(" ",t.confirm?"ok":"waiting..."," ")}}function x(t,e){if(1&t&&(d.TgZ(0,"ion-content"),d.TgZ(1,"ion-row",6),d.TgZ(2,"ion-col",7),d.TgZ(3,"div",8),d.TgZ(4,"small"),d._uU(5,"send at"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"ion-col",7),d.TgZ(7,"div",8),d.TgZ(8,"small"),d._uU(9,"send By"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-col",7),d.TgZ(11,"div",8),d.TgZ(12,"small"),d._uU(13,"name"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(14,"ion-col",7),d.TgZ(15,"div",8),d.TgZ(16,"small"),d._uU(17,"quantity"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",7),d.TgZ(19,"div",8),d.TgZ(20,"small"),d._uU(21,"status"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(22,"ion-col",7),d._UZ(23,"div",8),d.qZA(),d.qZA(),d.YNc(24,U,25,12,"ion-row",9),d.qZA()),2&t){const t=d.oxw();d.xp6(24),d.Q6J("ngForOf",t.transaction)}}function w(t,e){if(1&t&&(d.TgZ(0,"small",13),d._uU(1),d.qZA()),2&t){const t=d.oxw().$implicit;d.xp6(1),d.hij(" ",t.quantityItems?t.quantityItems:0," ")}}function N(t,e){if(1&t&&(d.TgZ(0,"small",13),d.TgZ(1,"a",16),d._uU(2),d.qZA(),d._uU(3,"cas + "),d.TgZ(4,"a"),d._uU(5),d.qZA(),d._uU(6,"btl"),d.qZA()),2&t){const t=d.oxw().$implicit;d.xp6(2),d.Oqu(t.cassier?t.cassier:0),d.xp6(3),d.hij("",t.btls," ")}}function k(t,e){if(1&t&&(d.TgZ(0,"ion-row",10),d.TgZ(1,"ion-col",11),d.TgZ(2,"div",12),d.TgZ(3,"small",13),d._uU(4),d.ALo(5,"date"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"ion-col",11),d.TgZ(7,"div",12),d.TgZ(8,"small",13),d._uU(9),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-col",11),d.TgZ(11,"div",12),d.TgZ(12,"small",13),d._uU(13),d.qZA(),d.qZA(),d.qZA(),d.TgZ(14,"ion-col",18),d.TgZ(15,"div",12),d.YNc(16,w,2,1,"small",14),d.YNc(17,N,7,2,"small",14),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",18),d.TgZ(19,"div",12),d.TgZ(20,"p",19),d._uU(21),d.qZA(),d.qZA(),d.qZA(),d.qZA()),2&t){const t=e.$implicit;d.Q6J("ngStyle",d.VKq(11,_,e.index%2==0?"#f1f1f1":"white")),d.xp6(4),d.hij(" ",d.xi3(5,8,t.created,"medium"),""),d.xp6(5),d.hij(" ",t.receiver,""),d.xp6(4),d.hij(" ",t.name," "),d.xp6(3),d.Q6J("ngIf","productItems"!==t.productType),d.xp6(1),d.Q6J("ngIf","productItems"==t.productType),d.xp6(3),d.Q6J("ngStyle",d.VKq(13,_,t.confirm?"var(--ion-color-success)":"var(--ion-color-danger)")),d.xp6(1),d.hij(" ",t.confirm?"ok":"waiting..."," ")}}function $(t,e){if(1&t&&(d.TgZ(0,"ion-content"),d.TgZ(1,"ion-row",6),d.TgZ(2,"ion-col",7),d.TgZ(3,"div",8),d.TgZ(4,"small"),d._uU(5,"send at"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(6,"ion-col",7),d.TgZ(7,"div",8),d.TgZ(8,"small"),d._uU(9,"receive By"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(10,"ion-col",7),d.TgZ(11,"div",8),d.TgZ(12,"small"),d._uU(13,"name"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(14,"ion-col",17),d.TgZ(15,"div",8),d.TgZ(16,"small"),d._uU(17,"quantity"),d.qZA(),d.qZA(),d.qZA(),d.TgZ(18,"ion-col",17),d.TgZ(19,"div",8),d.TgZ(20,"small"),d._uU(21,"status"),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.YNc(22,k,22,15,"ion-row",9),d.qZA()),2&t){const t=d.oxw();d.xp6(22),d.Q6J("ngForOf",t.transaction)}}const C=[{path:"",component:(()=>{class t{constructor(t,e,i,o,n,s,a,r){this.adminService=t,this.warehouService=e,this.translateConfigService=i,this.translate=o,this.urlService=n,this.restApiService=s,this.saveRandom=a,this.notifi=r,this.transaction=[],this.adminFlag=!1,this.managerFlag=!1,this.cashierFlag=!1,this.wareHouseFlag=!1,this.tabRoles=[],this.vendorRole=!1,JSON.parse(localStorage.getItem("user"))[0]&&JSON.parse(localStorage.getItem("user"))[0].venderRole&&(this.vendorRole=JSON.parse(localStorage.getItem("user"))[0].venderRole),this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.takeUrl(),this.takeTransaction(),this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId),(this.tabRoles.includes(1)||this.tabRoles.includes(2)||this.tabRoles.includes(3))&&(this.adminFlag=!0),this.tabRoles.includes(2)&&(this.managerFlag=!0),this.tabRoles.includes(4)&&(this.cashierFlag=!0),this.languageChanged()}ngOnInit(){}takeUrl(){this.urlService.getUrl().subscribe(t=>{this.url=t})}languageChanged(){console.log("lang shop page");let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}takeTransaction(){let t=2;t=this.tabRoles.includes(2)?2:0,this.adminService.getStoreMballusTransaction(this.saveRandom.getStoreId(),t).subscribe(t=>{this.transaction=t.docs})}confirmTrasaction(t,e){console.log(t),this.notifi.presentLoading(),t.confirm=!0;let i={id:t._id,receiver:JSON.parse(localStorage.getItem("user")).name,receiverId:JSON.parse(localStorage.getItem("user"))._id,confirm:!0};this.adminService.cashierConfirmTransaction(i).subscribe(e=>{console.log(e),this.notifi.dismissLoading(),this.transaction=this.transaction.filter(e=>e._id!==t._id)},e=>{this.notifi.dismissLoading(),this.notifi.presentToast("impossible de mettre a jour","danger"),t.confirm=!1})}webServerSocket(t){this.sockets=l()(this.url),this.sockets.on("connect",function(){}),this.sockets.on(`${t}transactionNewItem`,t=>{let e=t.data;if(console.log("new order",t),t.prod.prod){let i=t.prod.prod.packSize,o=e.quantityItems%i;e.cassier=parseInt((e.quantityItems/i).toString()),e.btls=parseInt(o.toString()),e.sizeUnitProduct=t.prod.prod.sizeUnitProduct,e.unitNameProduct=t.prod.prod.unitNameProduct}this.transaction.unshift(e)}),this.sockets.on(`${t}transactionUpdateItem`,t=>(0,r.mG)(this,void 0,void 0,function*(){if(console.log("hello",t),t&&t._id){let e=yield this.transaction.findIndex(e=>e._id===t._id);this.transaction[e]&&(this.transaction[e].receiver=t.receiver,this.transaction[e].confirm=t.confirm)}}))}takeProduct(){let t,e=[];this.restApiService.getProductItem().subscribe(i=>{this.transaction.forEach(o=>{e=[],e=i.filter(t=>t._id==o.idprod),e.length&&e[0].packSize&&(t=o.quantityItems/e[0].packSize,o.btls=o.quantityItems%e[0].packSize,o.cassier=parseInt(t.toString()),o.unitNameProduct=e[0].unitNameProduct,o.sizeUnitProduct=e[0].sizeUnitProduct)})},t=>{})}}return t.\u0275fac=function(e){return new(e||t)(d.Y36(g.l),d.Y36(u.l),d.Y36(m.w),d.Y36(Z.sK),d.Y36(h.i),d.Y36(p.e),d.Y36(f.i),d.Y36(q.g))},t.\u0275cmp=d.Xpm({type:t,selectors:[["app-procurment-product-item"]],decls:9,vars:6,consts:[[4,"ngIf"],["slot","start"],["defaultHref","/start",4,"ngIf"],["defaultHref","/vendor-start",4,"ngIf"],["defaultHref","/start"],["defaultHref","/vendor-start"],[1,"header-component"],["size","2","size-md","2"],[1,"ion-text-center"],["class","data-row data-update",3,"ngStyle",4,"ngFor","ngForOf"],[1,"data-row","data-update",3,"ngStyle"],["size","2","size-md","2",1,"ion-align-self-center"],[1,"ion-text-center","ion-text-uppercase","taille"],[1,"namesmall"],["class","namesmall",4,"ngIf"],[3,"click"],[1,"cassier"],["size","3","size-md","3"],["size","3","size-md","3",1,"ion-align-self-center"],[3,"ngStyle"]],template:function(t,e){1&t&&(d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.YNc(2,T,3,3,"ion-title",0),d.YNc(3,I,3,3,"ion-title",0),d.TgZ(4,"ion-buttons",1),d.YNc(5,A,1,0,"ion-back-button",2),d.YNc(6,S,1,0,"ion-back-button",3),d.qZA(),d.qZA(),d.qZA(),d.YNc(7,x,25,1,"ion-content",0),d.YNc(8,$,23,1,"ion-content",0)),2&t&&(d.xp6(2),d.Q6J("ngIf",!e.cashierFlag),d.xp6(1),d.Q6J("ngIf",e.cashierFlag),d.xp6(2),d.Q6J("ngIf",!e.vendorRole),d.xp6(1),d.Q6J("ngIf",e.vendorRole),d.xp6(1),d.Q6J("ngIf",e.tabRoles.includes(4)),d.xp6(1),d.Q6J("ngIf",e.tabRoles.includes(2)))},directives:[a.Gu,a.sr,o.O5,a.Sm,a.wd,a.oU,a.cs,a.W2,a.Nd,a.wI,o.sg,o.PC,a.YG],pipes:[Z.X$,o.uU],styles:[".testbtn[_ngcontent-%COMP%]{position:relative;left:50px}.testbtn[_ngcontent-%COMP%] > ion-button[_ngcontent-%COMP%]{font-size:50%}ion-icon[_ngcontent-%COMP%]{font-size:20px}.cassier[_ngcontent-%COMP%], small[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:700}"]}),t})()}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=d.oAB({type:t}),t.\u0275inj=d.cJS({imports:[[o.ez,n.u5,a.Pc,s.Bz.forChild(C),Z.aw.forChild()]]}),t})()},866:(t,e,i)=>{"use strict";i.d(e,{l:()=>c});var o=i(529),n=i(1036),s=i(1572),a=i(9063),r=i(2968);let c=(()=>{class t{constructor(t,e){this.http=t,this.urlService=e,this.url="http://192.168.100.10:3000/",this.takeUrl()}takeUrl(){o.N.production?this.urlService.getUrl().subscribe(t=>{this.url=t,console.log("url",this.url)}):this.url=o.V}updateProductItemStore(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}updateProductItemStore1(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.put(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}confirmProductItemStore(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e="";if(localStorage.getItem("openCashDateId")?e=localStorage.getItem("openCashDateId"):JSON.parse(localStorage.getItem("openCashDateObj"))&&(e=JSON.parse(localStorage.getItem("openCashDateObj"))._id),e)return this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm?db=${this.id}&openCashDate=${e}`,t)}updateManufacturedItemStore(t){this.id=localStorage.getItem("adminId");let e=localStorage.getItem("openCashDateId");return this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store?db=${this.id}&openCashDate=${e}`,t).pipe()}updateManufacturedItemStoreConfirm(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e=localStorage.getItem("openCashDateId");return this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store/confirm?db=${this.id}&openCashDate=${e}`,t).pipe()}updateIce(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm/glacer?db=${this.id}`,t)}setProductItem(t){console.log(t),this.product=t}getProductItem(){return(0,n.isNullOrUndefined)(this.product)?0:this.product}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(a.eN),s.LFG(r.i))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);