(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[9460],{9460:(t,e,i)=>{"use strict";i.r(e),i.d(e,{BillardPageModule:()=>U});var s=i(1511),o=i(6073),r=i(8777),n=i(8158),d=i(4762),l=i(5318),c=i(9611),a=i(1886),u=i(9764),h=i(8289),g=i(9996),p=i(1572),m=i(4144),f=i(2874),Z=i(9719),b=i(4418),A=i(4375),v=i(731),S=i(1064);function y(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"ion-button",1),p.NdJ("click",function(){return p.CHM(t),p.oxw().selectSource()}),p._UZ(1,"ion-icon",7),p.qZA()}}function q(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"ion-item"),p.TgZ(1,"ion-label"),p.TgZ(2,"p"),p._uU(3),p.qZA(),p.TgZ(4,"p"),p._uU(5),p.qZA(),p.TgZ(6,"p"),p._uU(7),p.qZA(),p.qZA(),p.TgZ(8,"ion-button",10),p.NdJ("click",function(){p.CHM(t);const i=e.$implicit;return p.oxw(3).TransferOne(i)}),p._uU(9),p.ALo(10,"translate"),p.qZA(),p.TgZ(11,"ion-button",1),p.NdJ("click",function(){p.CHM(t);const i=e.$implicit;return p.oxw(3).productUpdate(i)}),p._uU(12),p.ALo(13,"translate"),p.qZA(),p.TgZ(14,"ion-button",11),p.NdJ("click",function(){p.CHM(t);const i=e.$implicit;return p.oxw(3).deleteBillard(i)}),p._UZ(15,"ion-icon",12),p.qZA(),p.qZA()}if(2&t){const t=e.$implicit;p.xp6(3),p.Oqu(t.name),p.xp6(2),p.Oqu(t.sellingPrice),p.xp6(2),p.Oqu(t.purchasingPrice),p.xp6(2),p.hij(" ",p.lcZ(10,5,"MENU.transfer")," "),p.xp6(3),p.Oqu(p.lcZ(13,7,"MENU.modify"))}}function k(t,e){if(1&t&&(p.TgZ(0,"ion-list"),p.YNc(1,q,16,9,"ion-item",6),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Q6J("ngForOf",t)}}function P(t,e){if(1&t&&(p.TgZ(0,"ion-avatar",3),p._UZ(1,"ion-img",15),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Q6J("src",t.url)}}function T(t,e){if(1&t){const t=p.EpF();p.TgZ(0,"ion-button",16),p.NdJ("click",function(){p.CHM(t);const e=p.oxw().$implicit;return p.oxw(3).productUpdate(e)}),p._uU(1,"Restore"),p.qZA()}}function I(t,e){if(1&t&&(p.TgZ(0,"ion-item"),p.YNc(1,P,2,1,"ion-avatar",13),p.TgZ(2,"ion-label"),p.TgZ(3,"p"),p._uU(4),p.qZA(),p.TgZ(5,"p"),p._uU(6),p.qZA(),p.TgZ(7,"p"),p._uU(8),p.qZA(),p.qZA(),p.YNc(9,T,2,0,"ion-button",14),p.qZA()),2&t){const t=e.$implicit,i=p.oxw(3);p.xp6(1),p.Q6J("ngIf",t.url),p.xp6(3),p.Oqu(t.name),p.xp6(2),p.Oqu(t.sellingPrice),p.xp6(2),p.Oqu(t.quantity),p.xp6(1),p.Q6J("ngIf",i.admin)}}function L(t,e){if(1&t&&(p.TgZ(0,"ion-list"),p.YNc(1,I,10,5,"ion-item",6),p.qZA()),2&t){const t=p.oxw().$implicit;p.xp6(1),p.Q6J("ngForOf",t)}}function _(t,e){if(1&t&&(p.TgZ(0,"ion-slide"),p.TgZ(1,"ion-grid"),p.TgZ(2,"ion-row"),p.TgZ(3,"ion-col"),p.TgZ(4,"div",8),p.TgZ(5,"h4"),p._uU(6),p.qZA(),p.qZA(),p.qZA(),p.qZA(),p.YNc(7,k,2,1,"ion-list",9),p.YNc(8,L,2,1,"ion-list",9),p.qZA(),p.qZA()),2&t){const t=e.$implicit,i=p.oxw();p.xp6(6),p.Oqu(t.storeName?t.storeName:"no name"),p.xp6(1),p.Q6J("ngIf",t&&"enabled"==i.segment),p.xp6(1),p.Q6J("ngIf",t&&"disabled"==i.segment)}}const x=[{path:"",component:(()=>{class t{constructor(t,e,i,s,o,r,n,d,l,c,a,u,h,g){this.restApiService=t,this.modalController=e,this.toastController=i,this.loadingController=s,this.actionSheetController=o,this.alertController=r,this.notif=n,this.router=d,this.getStoreName=l,this.manageSocket=c,this.saveRandom=a,this.restApi=u,this.translateConfigService=h,this.translate=g,this.products=[],this.tabRoles=[],this.admin=!1,this.multiStoreProductitem=[],this.segment="enabled",this.display_segment=!1,this.actif_products=[],this.storeList=[],this.desactive=!0,this.displayImages=!0,this.randObj={},this.listenEvent=!0,this.webServerSocket(),this.tabRoles=JSON.parse(localStorage.getItem("roles")),(this.tabRoles.includes(1)||this.tabRoles.includes(2)||this.tabRoles.includes(6))&&this.takeProduct(),this.tabRoles.includes(1)&&(this.admin=!0),this.selectedLanguage=this.translateConfigService.getDefaultLanguage()}ngOnInit(){let t=JSON.parse(localStorage.getItem("user"))[0];this.storeList=t.storeId,console.log("store List here===>",this.storeList)}webServerSocket(){let t=localStorage.getItem("adminId");this.manageSocket.getSocket().subscribe(e=>{e.on(`${t}newProductService`,t=>{if(this.listenEvent){let e=t.data;e.url=t.url,this.products.push(e),this.rangeProductByStore()}})})}takeProduct(){this.notif.presentLoading(),this.restApiService.getBillardList().subscribe(t=>{this.notif.dismissLoading(),this.products=[],this.products=t.product,console.log("less produit",this.products),this.actif_products=t.product,this.products.length>40&&(this.displayImages=!1),this.rangeProductByStore()})}presentLoading(){return(0,d.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:6e3}).then(t=>{t.present().then(()=>{this.isLoading||t.dismiss().then(()=>console.log("abort presenting"))})})})}dismissLoading(){return(0,d.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then(()=>console.log("dismissed"))})}selectSource(){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:l.i,componentProps:{tabproducts:{products:this.products,page:"billard"}}});return t.onDidDismiss().then(t=>{console.log(t)}),yield t.present()})}deleteBillard(t){this.notif.presentLoading(),this.restApiService.deleteBillardGame(t).subscribe(e=>{this.notif.dismissLoading(),this.notif.presentToast("delete ok !","primary"),this.products=this.products.filter(e=>e._id!==t._id),this.rangeProductByStore()})}addCategorie(){this.router.navigateByUrl("/category?page=billard.page")}productUpdate(t){return(0,d.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.modalController.create({component:c.f,componentProps:{product:t,page:"billard"}});return e.onDidDismiss().then(t=>{if(console.log(t),"no_update"===t.data)console.log(t.data);else if(t.data.product){let e=t.data.product,i=this.products.findIndex(t=>t._id===e._id);this.products.splice(i,1,e),this.rangeProductByStore()}}),yield e.present()})}rangeProductByStore(){let t=this.products.reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{});this.multiStoreProductitem=[];for(const e in t)this.multiStoreProductitem.push(t[e]);console.log("group here",this.multiStoreProductitem),this.multiStoreProductitem.length>1&&(this.desactive=!1),this.multiStoreProductitem.length&&this.multiStoreProductitem.forEach(t=>(0,d.mG)(this,void 0,void 0,function*(){t.forEach(t=>{t.desabled&&(this.display_segment=!0)});let e=yield this.getStoreName.takeName(t);t.storeName=e}))}addResource(){this.router.navigateByUrl("/resource?page=billard")}addToAllStore(){return(0,d.mG)(this,void 0,void 0,function*(){this.listenEvent=!1,this.notif.presentLoading();for(let t of this.storeList)for(let e of this.products)e.storeId!==t.id&&(e.storeId=t.id,yield this.buildProduct(e,t));console.log("=======jai finis tous ici ====>"),this.notif.dismissLoading(),this.takeProduct()})}TransferOne(t){return(0,d.mG)(this,void 0,void 0,function*(){this.notif.presentLoading();let e=1;for(let s of this.storeList)if(s.id==t.storeId);else try{yield this.checkIfExist(t,s.id),e+=1,e==this.storeList.length&&this.notif.dismissLoading()}catch(i){let o=yield this.buildProduct(t,s);e+=1,console.log(o),this.products.push(o),e==this.storeList.length&&(this.notif.dismissLoading(),this.rangeProductByStore())}})}buildProduct(t,e){return new Promise((i,s)=>{let o=!1,r=[];if(e.super_warehouse){o=!0;for(let e of this.products)e.filename==t.filename&&e.name==t.name&&(r.includes(e._id)||r.push(e._id));let s=this.buildProd(t,e,r,o);this.restApi.transferBillardGame(s).subscribe(t=>{i(t.data)},t=>{i(t)})}else{let s=this.buildProd(t,e,r,o);this.restApi.transferBillardGame(s).subscribe(t=>(0,d.mG)(this,void 0,void 0,function*(){for(let t of this.storeList);i(t.data)}),t=>{i(t)})}})}checkIfExist(t,e){return new Promise((i,s)=>{let o=this.products.find(i=>i.storeId==e&&i.filename==t.filename&&i.name==t.name);o?i(o):s(!1)})}removeWrongData(t){(0,a.$R)((0,u.D)(t),(0,h.F)(100)).pipe((0,g.U)(([t])=>t)).subscribe(t=>{console.log("delete this==>",t),this.restApiService.deleteBillardGame(t).subscribe(t=>{console.log(t)})},t=>{},()=>{})}buildProd(t,e,i,s){return{adminId:t.adminId,name:t.name,sellingPrice:t.sellingPrice,purchasingPrice:t.purchasingPrice,categoryName:t.categoryName,categoryId:t.categoryId,superCategory:t.superCategory,storeId:e.id,url:t.url,filename:t.filename,originalname:t.originalname,super_warehouse:s,productId:t._id,idList:i}}updateAll(){let t=0;this.notif.presentLoading(),this.products.forEach(e=>(0,d.mG)(this,void 0,void 0,function*(){if(yield this.wareHouseUtils(e),t+=1,t==this.products.length){this.notif.dismissLoading();let t=this.generateArray();t.length&&(console.log("array length ===>",t.length),this.updateSuperWareHouseProducts(t))}}))}wareHouseUtils(t){return new Promise((e,i)=>{let s=this.storeList.find(t=>1==t.super_warehouse),o=this.products.find(e=>e.name==t.name&&e.storeId==s.id);o&&o.idList&&(o&&o.idList.includes(t._id)||(o.idList.push(t._id),o.changes=!0,this.randObj[t._id]=o),e(!0))})}update(t){this.restApi.updateBillardGame(t).subscribe(t=>{console.log("update hello",t)})}generateArray(){const t=[];for(var e in this.randObj)t.push(this.randObj[e]);return t}updateSuperWareHouseProducts(t){(0,a.$R)((0,u.D)(t),(0,h.F)(200)).pipe((0,g.U)(([t])=>t)).subscribe(t=>{this.update(t)},t=>{},()=>{})}addProdToSuperWareHouse(t,e){return new Promise((i,s)=>{let o=this.products.find(i=>i.storeId==e&&i.name==t.name);o&&o.idList&&!o.idList.includes(t._id)?(o.idList.push(t._id),this.update(o),i(t)):i(t)})}}return t.\u0275fac=function(e){return new(e||t)(p.Y36(m.e),p.Y36(n.IN),p.Y36(n.yF),p.Y36(n.HT),p.Y36(n.BX),p.Y36(n.Br),p.Y36(f.g),p.Y36(r.F0),p.Y36(Z.$),p.Y36(b.W),p.Y36(A.i),p.Y36(m.e),p.Y36(v.w),p.Y36(S.sK))},t.\u0275cmp=p.Xpm({type:t,selectors:[["app-billard"]],decls:20,vars:5,consts:[["slot","end"],[3,"click"],[3,"click",4,"ngIf"],["slot","start"],["autoHide","false"],["pager","true"],[4,"ngFor","ngForOf"],["slot","icon-only","name","add"],[1,"ion-text-center","ion-text-uppercase"],[4,"ngIf"],["color","primary","slot","end","small","",3,"click"],["color","danger","slot","end","small","",1,"round",3,"click"],["name","trash"],["slot","start",4,"ngIf"],["class","divBtnUpdate",3,"click",4,"ngIf"],[3,"src"],[1,"divBtnUpdate",3,"click"]],template:function(t,e){1&t&&(p.TgZ(0,"ion-header"),p.TgZ(1,"ion-toolbar"),p.TgZ(2,"ion-title"),p._uU(3,"service"),p.qZA(),p.TgZ(4,"ion-buttons",0),p.TgZ(5,"ion-button",1),p.NdJ("click",function(){return e.updateAll()}),p._uU(6,"changes"),p.qZA(),p.TgZ(7,"ion-button",1),p.NdJ("click",function(){return e.addToAllStore()}),p._uU(8),p.ALo(9,"translate"),p.qZA(),p.TgZ(10,"ion-button",1),p.NdJ("click",function(){return e.addCategorie()}),p._uU(11," categorie "),p.qZA(),p.TgZ(12,"ion-button",1),p.NdJ("click",function(){return e.addResource()}),p._uU(13,"resources "),p.qZA(),p.YNc(14,y,2,0,"ion-button",2),p.qZA(),p.TgZ(15,"ion-buttons",3),p._UZ(16,"ion-menu-button",4),p.qZA(),p.qZA(),p.qZA(),p.TgZ(17,"ion-content"),p.TgZ(18,"ion-slides",5),p.YNc(19,_,9,3,"ion-slide",6),p.qZA(),p.qZA()),2&t&&(p.xp6(8),p.Oqu(p.lcZ(9,3,"MENU.transfer")),p.xp6(6),p.Q6J("ngIf",e.admin),p.xp6(5),p.Q6J("ngForOf",e.multiStoreProductitem))},directives:[n.Gu,n.sr,n.wd,n.Sm,n.YG,s.O5,n.fG,n.W2,n.Hr,s.sg,n.gu,n.A$,n.jY,n.Nd,n.wI,n.q_,n.Ie,n.Q$,n.BJ,n.Xz],pipes:[S.X$],styles:[""]}),t})()}];let U=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=p.oAB({type:t}),t.\u0275inj=p.cJS({imports:[[s.ez,o.u5,n.Pc,r.Bz.forChild(x),S.aw.forChild()]]}),t})()},4418:(t,e,i)=>{"use strict";i.d(e,{W:()=>l});var s=i(1344),o=i.n(s),r=i(8512),n=i(1572),d=i(2968);let l=(()=>{class t{constructor(t){this.urlService=t,this.mysocket=new r.X(null),this.sock=!1,this.takeUrl()}takeUrl(){console.log("je demmare ici url"),this.urlService.getUrl().subscribe(t=>{this.url=t,this.adminId=localStorage.getItem("adminId"),this.sockets=o()(this.url),this.mysocket.next(this.sockets)})}getSocket(){return this.mysocket}disconnectSocket(){this.sockets.disconnect()}getMySocket(){return this.sockets}}return t.\u0275fac=function(e){return new(e||t)(n.LFG(d.i))},t.\u0275prov=n.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);