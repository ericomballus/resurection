(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[9817],{9817:(t,e,i)=>{"use strict";i.r(e),i.d(e,{PointOfSalePageModule:()=>ee});var o=i(1511),n=i(6073),s=i(8777),r=i(8158),c=i(4762),a=i(994),l=i(681),d=i(8512),h=i(5959),g=i(5416),u=i(3334),p=i(1344),m=i.n(p),f=i(1572),v=i(5946),Z=i(731),b=i(5508),I=i(5541),C=i(6529),A=i(4144);let T=(()=>{class t{constructor(t){this.plateform=t,this.plateform.is("android")}addGeofence(t,e){}}return t.\u0275fac=function(e){return new(e||t)(f.LFG(r.t4))},t.\u0275prov=f.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var x=i(2968),O=i(7149),S=i(7886),q=i(6863),_=i(2874),P=i(9719),y=i(2181),k=i(4375),w=i(1094),N=i(4418),M=i(1064),$=i(9942),U=i(3437),E=i(5604),R=i(4892),J=i(2357),L=i(9063),Y=i(3515);const F=["mySlider"];function D(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-item",19),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw(2).search(i)}),f.TgZ(1,"ion-avatar",2),f._UZ(2,"img",20),f.qZA(),f.TgZ(3,"ion-label"),f.TgZ(4,"h4",21),f._uU(5),f.qZA(),f.TgZ(6,"h3",22),f._uU(7),f.ALo(8,"translate"),f.qZA(),f.qZA(),f.TgZ(9,"ion-button",23),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw(2).buyPack(i)}),f._uU(10),f.ALo(11,"translate"),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.xp6(2),f.s9C("src",t.url,f.LSH),f.xp6(3),f.hij(" ",t.name," "),f.xp6(2),f.AsE(" ",f.lcZ(8,5,"MENU.sellingPirce"),": ",t.sellingPrice," "),f.xp6(3),f.Oqu(f.lcZ(11,7,"MENU.buy"))}}function Q(t,e){if(1&t&&(f.TgZ(0,"ion-list",17),f.YNc(1,D,12,9,"ion-item",18),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.Q6J("ngForOf",t.pack2)}}function G(t,e){if(1&t&&(f.TgZ(0,"ion-badge",32),f._uU(1),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(1),f.Oqu(t.qty)}}function j(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-col",24),f.TgZ(1,"ion-card",19),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw().buyItem(i)}),f.YNc(2,G,2,1,"ion-badge",25),f.TgZ(3,"div",26),f._UZ(4,"img",27),f.qZA(),f.TgZ(5,"ion-card-content"),f.TgZ(6,"ion-row"),f.TgZ(7,"ion-col",28),f.TgZ(8,"div",29),f._uU(9),f.qZA(),f.qZA(),f.TgZ(10,"ion-col",28),f.TgZ(11,"div",29),f._uU(12),f.qZA(),f.qZA(),f.TgZ(13,"ion-col",30),f.TgZ(14,"div",31),f._uU(15),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.xp6(2),f.Q6J("ngIf",t.qty),f.xp6(2),f.s9C("src",t.url,f.LSH),f.xp6(5),f.hij(" ",t.name," "),f.xp6(3),f.hij(" ",t.sellingPrice,"FCFA "),f.xp6(3),f.hij(" Avaible: ",t.quantityStore," ")}}function B(t,e){if(1&t&&(f.TgZ(0,"ion-badge",32),f._uU(1),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(1),f.Oqu(t.qty)}}function z(t,e){if(1&t&&(f.TgZ(0,"ion-col",28),f.TgZ(1,"div",31),f._uU(2),f.ALo(3,"translate"),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(2),f.AsE(" ",f.lcZ(3,2,"MENU.avaible"),": ",t.quantityStore," ")}}function H(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-col",24),f.TgZ(1,"ion-card",19),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw().buyItem(i)}),f.YNc(2,B,2,1,"ion-badge",25),f._UZ(3,"img",33),f.TgZ(4,"ion-card-content"),f.TgZ(5,"ion-row"),f.TgZ(6,"ion-col",28),f.TgZ(7,"div",31),f._uU(8),f.qZA(),f.qZA(),f.TgZ(9,"ion-col",28),f.TgZ(10,"div",31),f._uU(11),f.qZA(),f.qZA(),f.YNc(12,z,4,4,"ion-col",34),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.xp6(2),f.Q6J("ngIf",t.qty),f.xp6(1),f.s9C("src",t.url,f.LSH),f.xp6(5),f.hij(" ",t.name," "),f.xp6(3),f.hij(" ",t.sellingPrice,"FCFA "),f.xp6(1),f.Q6J("ngIf",t.quantityStore)}}function V(t,e){if(1&t&&(f.TgZ(0,"ion-badge",32),f._uU(1),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(1),f.Oqu(t.qty)}}function W(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-col",24),f.TgZ(1,"ion-card",19),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw().buyItemResto(i)}),f.YNc(2,V,2,1,"ion-badge",25),f.TgZ(3,"div",26),f._UZ(4,"img",27),f.qZA(),f.TgZ(5,"ion-card-content"),f.TgZ(6,"ion-row"),f.TgZ(7,"ion-col",28),f.TgZ(8,"div",29),f._uU(9),f.qZA(),f.qZA(),f.TgZ(10,"ion-col",28),f.TgZ(11,"div",29),f._uU(12),f.qZA(),f.qZA(),f.TgZ(13,"ion-col",28),f._UZ(14,"div",31),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.xp6(2),f.Q6J("ngIf",t.qty),f.xp6(2),f.s9C("src",t.url,f.LSH),f.xp6(5),f.hij(" ",t.name," "),f.xp6(3),f.hij(" ",t.sellingPrice,"FCFA ")}}let X=(()=>{class t{constructor(t,e,i,o,n,s,r,c,a,l,d,h,g,u,p,m,v){this.restApiService=t,this.manageCartService=e,this.countItemsService=i,this.navCtrl=o,this.modalController=n,this.alertController=s,this.router=r,this.loadingController=c,this.socket=a,this.translateConfigService=l,this.networkService=d,this.toastController=h,this.network=g,this.http=u,this.adminService=p,this.imageLoader=m,this.cache=v,this.valueChange=new f.vpe,this.productResto=[],this.packs=[],this.allProducts=[],this.totalItems=0,this.totalPrice=0,this.isItemAvailable=!1,this.isItemAvailable2=!1,this.btnProducts=!0,this.btnAllProducts=!1,this.btnResto=!1,this.btnPack=!1,this.isLoading=!1,this.tabRoles=[],this.jsonProducts=null,this.networkService.initializeNetworkEvents(),this.takeCashOpen(),JSON.parse(localStorage.getItem("user")).name&&(this.userName=JSON.parse(localStorage.getItem("user")).name),this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.tabRoles.includes(1)||this.tabRoles.includes(5)||this.tabRoles.includes(4)?(this.getItems(),this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId)):this.router.navigateByUrl("Login"),this.languageChanged()}languageChanged(){let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}getItems(){return(0,c.mG)(this,void 0,void 0,function*(){setTimeout(()=>{this.takeProduct(),setTimeout(()=>{console.log("serveur resto take"),this.takeProductResto()},1e3)},2e3)})}ngOnInit(){}takeCashOpen(){setTimeout(()=>{this.adminService.getOpenCash().subscribe(t=>{t.docs.length?(this.openCashDate=t.docs[0].openDate,this.getItems()):this.cashDateAlert()})},5e3)}webServerSocket(t){this.socket.connect(),this.socket.emit("set-name",name),this.socket.fromEvent(`${t}newProductItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){})),this.socket.fromEvent(`${t}productItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){if(t&&t._id){let e=yield this.products.findIndex(e=>e._id===t._id);this.products.splice(e,1,t);let i=yield this.allProducts.findIndex(e=>e._id===t._id);this.allProducts.splice(i,1,t)}})),this.socket.fromEvent(`${t}productItemDelete`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){})),this.socket.fromEvent(`${t}manufacturedItem`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){if(t&&t._id){let e=yield this.productResto.findIndex(e=>e._id===t._id);this.productResto.splice(e,1,t)}})),this.socket.fromEvent(`${this.adminId}cashOpen`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){this.takeCashOpen()})),this.socket.fromEvent(`${this.adminId}cashClose`).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){this.products=[],this.productResto=[]}))}takeProduct(){this.restApiService.getProductItem().subscribe(t=>{this.products=t,this.cache.cacheRequest("productsItem",t).then(t=>{}),this.products.length>0&&(this.allProducts=[...this.allProducts,...this.products])},t=>{})}takePackitems(){this.restApiService.getPackItem().subscribe(t=>{this.packs=t.items,this.packs.length>0&&(this.allProducts=[...this.allProducts,...this.packs])})}takeProductResto(){this.restApiService.getManufacturedProductItemResto2().subscribe(t=>{this.productResto=t,this.productResto2=this.productResto,this.cache.cacheRequest("productsResto",t).then(t=>{}),this.productResto.length>0&&(this.allProducts=[...this.productResto,...this.allProducts])})}next(){this.slides.slideNext()}prev(){this.slides.slidePrev()}buyItem(t){if(this.networkService.getCurrentNetworkStatus()==O.Q.Offline&&this.tabRoles.includes(5))this.toastController.create({message:"please check with point of sale.",duration:5e3,position:"bottom"}).then(t=>t.present());else if(this.cartValue=this.restApiService.getCart2(),console.log("la valeur du cart",this.cartValue),this.Itemprice-this.Reduction<=100)this.presentAlert();else if(this.Itemprice>0&&this.Itemprice-this.Reduction>100);else if(t.quantityStore<=0)this.showPresentAlert();else if(console.log(t._id),console.log("products",t),console.log("store",t.quantityStore),this.cartValue&&this.cartValue.cart){console.log("table after value",this.cartValue.cart),console.log("table after",this.cartValue.products);let e=this.cartValue.products.filter(e=>e.item._id===t._id)[0];if(console.log("table",e),e&&e.qty===t.quantityStore)return void this.showPresentAlert();{let e={};e.product=t,e.cart=this.cartValue.cart;let i=this.manageCartService.addToCart(e);console.log(i),this.totalItems=i.totalQty,this.valueChange.emit(this.totalItems),this.totalPrice=i.totalPrice,this.restApiService.saveCart({cart:i,products:i.generateArray()});let o=this.countItemsService.getQtyItems(this.products,i.generateArray(),t);console.log("new tab",o),this.products=o}}else{let e=this.manageCartService.addToCart(t);this.totalItems=e.totalQty,this.valueChange.emit(this.totalItems),this.totalPrice=e.totalPrice,this.restApiService.saveCart({cart:e,products:e.generateArray()});let i=this.countItemsService.getQtyItems(this.products,e.generateArray(),t);console.log("new tab",i),this.products=i}}buyItemResto(t){console.log(t);let e=t._id;if(this.cartValue=this.restApiService.getCart2(),console.log("la valeur du cart",this.cartValue),this.Itemprice-this.Reduction<=100)this.presentAlert();else if(this.Itemprice>0&&this.Itemprice-this.Reduction>100);else if(console.log(t),this.cartValue&&this.cartValue.cart){let e={};e.product=t,e.cart=this.cartValue.cart;let i=this.manageCartService.addToCart(e);this.totalItems=i.totalQty,this.totalPrice=i.totalPrice,this.valueChange.emit(this.totalItems),this.restApiService.saveCart({cart:i,products:i.generateArray()});let o=this.countItemsService.getQtyItems(this.productResto,i.generateArray(),t);console.log("new tab",o),this.productResto=o}else{let i=this.manageCartService.addToCart(t);console.log(i),console.log("id ici 2",e),this.totalItems=i.totalQty,this.valueChange.emit(this.totalItems),this.totalPrice=i.totalPrice,this.restApiService.saveCart({cart:i,products:i.generateArray()});let o=this.countItemsService.getQtyItems(this.productResto,i.generateArray(),t);console.log("new tab",o),this.productResto=o}}segmentChanged(t){console.log("Segment changed",t.target.value);let e=t.target.value;"product"===e?(this.btnAllProducts=!1,this.btnPack=!1,this.btnProducts=!0,this.btnResto=!1,console.log(this.products)):"productResto"===e?(this.btnResto=!0,this.btnProducts=!1,this.btnAllProducts=!1,this.btnPack=!1):"pack"===e?(this.btnResto=!1,this.btnProducts=!1,this.btnAllProducts=!1,this.btnPack=!0):(this.btnResto=!1,this.btnProducts=!1,this.btnAllProducts=!0,this.btnPack=!1)}buyPack(t){if(this.cartValue=this.restApiService.getCart2(),console.log(t),this.cartValue){let e={};e.product=t,e.cart=this.cartValue.cart;let i=this.manageCartService.addToCart(e);console.log(i),this.totalItems=i.totalQty,this.valueChange.emit(this.totalItems),this.restApiService.saveCart({cart:i,products:i.generateArray()})}else{let e=this.manageCartService.addToCart(t);console.log(e),this.totalItems=e.totalQty,this.valueChange.emit(this.totalItems),this.restApiService.saveCart({cart:e,products:e.generateArray()})}}getCart(){console.log("here"),this.cartValue=this.restApiService.getCart()}displayCart(){this.navCtrl.navigateForward("cart")}openCart(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:$.V});return t.onDidDismiss().then(t=>void 0===t.data?(this.totalItems=0,this.valueChange.emit(this.totalItems),this.totalPrice=0,this.restApiService.saveCart({}),this.products.forEach(t=>{t.qty&&(t.qty=0)}),this.packs.forEach(t=>{t.qty&&(t.qty=0)}),void this.productResto.forEach(t=>{t.qty&&(t.qty=0)})):(this.restApiService.saveCart(t.data),t.data.cart&&(this.totalItems=t.data.cart.totalQty,this.valueChange.emit(this.totalItems),this.totalPrice=t.data.cart.totalPrice),"update"===t.data?(this.totalItems=0,this.totalPrice=0,this.valueChange.emit(this.totalItems),this.restApiService.saveCart({}),this.products.forEach(t=>{t.qty=0}),this.packs.forEach(t=>{t.qty=0}),void this.productResto.forEach(t=>{t.qty=0})):t.data.products.length?(this.packs.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabPacks(e,i))})}),this.products.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabProducts(e,i))})}),void this.productResto.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabProResto(e,i))})})):void("update"===t.data||t.data?(this.totalItems=0,this.totalPrice=0,this.valueChange.emit(this.totalItems),this.restApiService.saveCart({}),this.products.forEach(t=>{t.qty&&(t.qty=0)}),this.packs.forEach(t=>{t.qty&&(t.qty=0)}),this.productResto.forEach(t=>{t.qty&&(t.qty=0)})):(this.totalItems=t.data.cart.totalQty,this.valueChange.emit(this.totalItems),this.totalPrice=t.data.cart.totalPrice,this.restApiService.saveCart(t.data))))),yield t.present()})}priceChange(t){console.log(t),this.Itemprice=t.sellingPrice}displayPrice(t){console.log(t),this.Reduction=t}presentAlert(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"Alert",subHeader:"Subtitle",message:"le prix entr\xe9 n.est pas bon.",buttons:["OK"]});yield t.present()})}initializeItems(){this.products2=this.products}handleInputItems(t){this.presentLoading();const e=t.target.value;e&&""!=e.trim()?(this.isItemAvailable=!0,this.restApiService.getProductByName(e).subscribe(t=>{this.dismissLoading(),this.products2=t.product})):(this.isItemAvailable=!1,this.products2=[])}handleInputPack(t){this.presentLoading();const e=t.target.value;e&&""!=e.trim()?(this.isItemAvailable2=!0,this.restApiService.getPackitemByName(e).subscribe(t=>{this.dismissLoading(),this.pack2=t.pack})):(this.isItemAvailable2=!1,this.pack2=[])}presentLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!0,yield this.loadingController.create({duration:3e3}).then(t=>{t.present().then(()=>{console.log("presented"),this.isLoading||t.dismiss().then()})})})}dismissLoading(){return(0,c.mG)(this,void 0,void 0,function*(){return this.isLoading=!1,yield this.loadingController.dismiss().then()})}search(t){this.isItemAvailable=!1,this.isItemAvailable2=!1,console.log(t)}showPresentAlert(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"ALERT",message:"NOT ENOUGTH IN STOCK!\n        please contact wharehouse",cssClass:"AlertStock",buttons:["OK"]});yield t.present()})}cashDateAlert(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"ALERT",message:"PLEASE OPEN CASH DATE!",cssClass:"AlertStock",buttons:["OK"]});yield t.present()})}updateTabPacks(t,e){let i=t,o=this.packs.findIndex(t=>t._id===e);this.packs.splice(o,1,i)}updateTabProducts(t,e){let i=t,o=this.products.findIndex(t=>t._id===e);this.products.splice(o,1,i)}updateTabProResto(t,e){let i=t,o=this.productResto.findIndex(t=>t._id===e);this.productResto.splice(o,1,i)}clearCache(t){console.log("ok"),this.imageLoader.clearCache()}onImageLoad(t){console.log(t),console.log(t._src)}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(A.e),f.Y36(U.B),f.Y36(E.w),f.Y36(r.SH),f.Y36(r.IN),f.Y36(r.Br),f.Y36(s.F0),f.Y36(r.HT),f.Y36(R.sk),f.Y36(Z.w),f.Y36(O.S),f.Y36(r.yF),f.Y36(J.Z),f.Y36(L.eN),f.Y36(v.l),f.Y36(Y.e2),f.Y36(w.$))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-displayitems"]],viewQuery:function(t,e){if(1&t&&f.Gf(F,3),2&t){let t;f.iGM(t=f.CRH())&&(e.slides=t.first)}},outputs:{valueChange:"valueChange"},decls:38,vars:11,consts:[["mode","ios"],[1,"toolbarCart"],["slot","start"],["autoHide","false"],["slot","end"],[3,"disabled","click"],["color","dark","slot","end","name","cart"],["size","small"],["slot","end","name","contact"],["slot","fixed",3,"ionRefresh"],["color","tertiary",3,"ionChange"],["value","product","checked","",1,"segBar"],["value","productResto",1,"segResto"],[1,"listitems"],["style","width: 100%; max-height: 200px; overflow-y: scroll",4,"ngIf"],[3,"hidden"],["size","4","size-md","3","size-lg","2",4,"ngFor","ngForOf"],[2,"width","100%","max-height","200px","overflow-y","scroll"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[3,"src"],[2,"text-transform","uppercase","font-weight","bold"],[2,"text-transform","uppercase","font-size","10px"],["color","danger","slot","end","small","",1,"round",3,"click"],["size","4","size-md","3","size-lg","2"],["class","badge","slot","end","color","warning",4,"ngIf"],[1,"img-container"],[1,"img-container",2,"width","100px","height","100px",3,"src"],["size","12",1,"colp"],[1,"ion-text-nowrap",2,"text-transform","uppercase","font-size","10px"],["size","12",1,"colp",2,"text-transform","uppercase","font-size","8px"],[1,"ion-text-nowrap"],["slot","end","color","warning",1,"badge"],[2,"width","100px","height","65px",3,"src"],["size","12","class","colp",4,"ngIf"]],template:function(t,e){1&t&&(f.TgZ(0,"div"),f.TgZ(1,"ion-header",0),f.TgZ(2,"ion-toolbar",1),f._UZ(3,"ion-title"),f.TgZ(4,"ion-buttons",2),f._UZ(5,"ion-menu-button",3),f.qZA(),f.TgZ(6,"ion-buttons",4),f.TgZ(7,"ion-button",5),f.NdJ("click",function(){return e.openCart()}),f.TgZ(8,"ion-badge",4),f._uU(9),f.qZA(),f._UZ(10,"ion-icon",6),f.qZA(),f.TgZ(11,"ion-button",7),f._uU(12),f._UZ(13,"ion-icon",8),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.TgZ(14,"ion-refresher",9),f.NdJ("ionRefresh",function(t){return e.clearCache(t)}),f._UZ(15,"ion-refresher-content"),f.qZA(),f.TgZ(16,"ion-segment",10),f.NdJ("ionChange",function(t){return e.segmentChanged(t)}),f.TgZ(17,"ion-segment-button",11),f.TgZ(18,"ion-label"),f._uU(19,"BAR"),f.qZA(),f.qZA(),f.TgZ(20,"ion-segment-button",12),f.TgZ(21,"ion-label"),f._uU(22,"RESTO"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(23,"div"),f.TgZ(24,"div",13),f.YNc(25,Q,2,1,"ion-list",14),f.qZA(),f.TgZ(26,"div"),f.TgZ(27,"ion-grid",15),f.TgZ(28,"ion-row"),f.YNc(29,j,16,5,"ion-col",16),f.qZA(),f.qZA(),f.qZA(),f.TgZ(30,"div"),f.TgZ(31,"ion-grid",15),f.TgZ(32,"ion-row"),f.YNc(33,H,13,5,"ion-col",16),f.qZA(),f.qZA(),f.qZA(),f.TgZ(34,"div"),f.TgZ(35,"ion-grid",15),f.TgZ(36,"ion-row"),f.YNc(37,W,15,4,"ion-col",16),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()),2&t&&(f.xp6(7),f.Q6J("disabled",!e.totalItems),f.xp6(2),f.Oqu(e.totalItems),f.xp6(3),f.AsE(" ",e.userName," ",e.erico," "),f.xp6(13),f.Q6J("ngIf",e.isItemAvailable2),f.xp6(2),f.Q6J("hidden",!e.btnProducts),f.xp6(2),f.Q6J("ngForOf",e.products),f.xp6(2),f.Q6J("hidden",!e.btnPack),f.xp6(2),f.Q6J("ngForOf",e.packs),f.xp6(2),f.Q6J("hidden",!e.btnResto),f.xp6(2),f.Q6J("ngForOf",e.productResto))},directives:[r.Gu,r.sr,r.wd,r.Sm,r.fG,r.YG,r.yp,r.gu,r.nJ,r.Wo,r.cJ,r.QI,r.GO,r.Q$,o.O5,r.jY,r.Nd,o.sg,r.q_,r.Ie,r.BJ,r.wI,r.PM,r.FN],pipes:[M.X$],styles:[".toolbarCart[_ngcontent-%COMP%]{--background:#fff}.img-container[_ngcontent-%COMP%]{display:block;margin-left:auto;margin-right:auto}"]}),t})();const K=["itemlist"];function tt(t,e){1&t&&f._UZ(0,"ion-icon",12)}function et(t,e){1&t&&f._UZ(0,"ion-icon",13)}function it(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",22),f.TgZ(2,"small",23),f._uU(3),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",t.item.name," glac\xe9")}}function ot(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",24),f._uU(2),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(2),f.hij(" ",t.item.modeG," ")}}const nt=function(t){return[t,"FCFA","symbol","3.0-0","fr"]};function st(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",17),f.TgZ(2,"small",25),f._uU(3),f.ALo(4,"currency"),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",f.G7q(4,1,f.VKq(7,nt,t.item.sellingPrice*t.item.modeG)),"")}}function rt(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",22),f.TgZ(2,"small",23),f._uU(3),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",t.item.name," non glac\xe9")}}function ct(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",24),f._uU(2),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(2),f.hij(" ",t.item.modeNG," ")}}function at(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",17),f.TgZ(2,"small",25),f._uU(3),f.ALo(4,"currency"),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",f.G7q(4,1,f.VKq(7,nt,t.item.sellingPrice*t.item.modeNG)),"")}}function lt(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",22),f.TgZ(2,"small",23),f._uU(3),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",t.item.name,"")}}function dt(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",26),f.TgZ(2,"small"),f._uU(3),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",t.qty," ")}}const ht=function(){return[0,"FCFA","symbol","3.0-0","fr"]};function gt(t,e){if(1&t&&(f.TgZ(0,"ion-col",21),f.TgZ(1,"div",27),f.TgZ(2,"small"),f._uU(3),f.ALo(4,"currency"),f.qZA(),f.qZA(),f.qZA()),2&t){const t=f.oxw().$implicit;f.xp6(3),f.hij(" ",t.price?t.price:f.G7q(4,1,f.DdM(7,ht)),"")}}function ut(t,e){if(1&t&&(f.TgZ(0,"ion-row",19),f.YNc(1,it,4,1,"ion-col",20),f.YNc(2,ot,3,1,"ion-col",20),f.YNc(3,st,5,9,"ion-col",20),f.YNc(4,rt,4,1,"ion-col",20),f.YNc(5,ct,3,1,"ion-col",20),f.YNc(6,at,5,9,"ion-col",20),f.YNc(7,lt,4,1,"ion-col",20),f.YNc(8,dt,4,1,"ion-col",20),f.YNc(9,gt,5,8,"ion-col",20),f.qZA()),2&t){const t=e.$implicit;f.xp6(1),f.Q6J("ngIf",t.item.modeG),f.xp6(1),f.Q6J("ngIf",t.item.modeG),f.xp6(1),f.Q6J("ngIf",t.item.modeG),f.xp6(1),f.Q6J("ngIf",t.item.modeNG),f.xp6(1),f.Q6J("ngIf",t.item.modeNG),f.xp6(1),f.Q6J("ngIf",t.item.modeNG),f.xp6(1),f.Q6J("ngIf",!t.item.modeNG&&!t.item.modeG),f.xp6(1),f.Q6J("ngIf",!t.item.modeNG&&!t.item.modeG),f.xp6(1),f.Q6J("ngIf",!t.item.modeNG&&!t.item.modeG)}}function pt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-col",14),f.NdJ("click",function(){f.CHM(t);const e=f.oxw().$implicit;return f.oxw(2).Send(e)}),f.YNc(1,ut,10,9,"ion-row",15),f.TgZ(2,"ion-row"),f.TgZ(3,"ion-col",16),f.TgZ(4,"div",17),f.TgZ(5,"small"),f._uU(6," TOTAL:"),f.qZA(),f.TgZ(7,"small",18),f._uU(8),f.ALo(9,"currency"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(10,"ion-col",16),f.TgZ(11,"div",17),f.TgZ(12,"div"),f._uU(13,"re\xe7us:"),f.qZA(),f.TgZ(14,"small",18),f._uU(15),f.ALo(16,"currency"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(17,"ion-col",16),f.TgZ(18,"div",17),f.TgZ(19,"div"),f._uU(20,"reste:"),f.qZA(),f.TgZ(21,"small",18),f._uU(22),f.ALo(23,"currency"),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw().$implicit,e=f.oxw(2);f.xp6(1),f.Q6J("ngForOf",t.products),f.xp6(7),f.hij(" ",f.gM2(9,4,e.sum,"FCFA","symbol","3.0-0"),""),f.xp6(7),f.hij(" ",f.gM2(16,9,e.montantR,"FCFA","symbol","3.0-0"),""),f.xp6(7),f.hij(" ",f.gM2(23,14,e.reste,"FCFA","symbol","3.0-0"),"")}}const mt=function(t,e,i,o){return{animated:t,heartBeat:e,signalColor:i,slow:o}};function ft(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-row",3,4),f.TgZ(2,"ion-col",5),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit,o=e.index;return f.oxw(2).Display(i,o)}),f.YNc(3,tt,1,0,"ion-icon",6),f.YNc(4,et,1,0,"ion-icon",7),f.qZA(),f.TgZ(5,"ion-col",8),f.TgZ(6,"div",9),f.TgZ(7,"small"),f.TgZ(8,"a"),f._uU(9,"N0:"),f.qZA(),f._uU(10),f.qZA(),f.qZA(),f.qZA(),f.TgZ(11,"ion-col",10),f.TgZ(12,"div",9),f.TgZ(13,"small"),f.TgZ(14,"a"),f._uU(15,"table:"),f.qZA(),f._uU(16),f.qZA(),f.qZA(),f.qZA(),f.TgZ(17,"ion-col",10),f.TgZ(18,"div",9),f.TgZ(19,"small"),f._uU(20),f.ALo(21,"currency"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(22,"ion-col",8),f.TgZ(23,"div",9),f.TgZ(24,"small"),f._uU(25),f.qZA(),f.qZA(),f.qZA(),f.YNc(26,pt,24,19,"ion-col",11),f.qZA()}if(2&t){const t=e.$implicit;f.Q6J("ngClass",f.l5B(14,mt,t.signal,t.signal,t.signal,t.signal)),f.xp6(3),f.Q6J("ngIf",!t.show),f.xp6(1),f.Q6J("ngIf",t.show),f.xp6(6),f.Oqu(t.numFacture),f.xp6(6),f.Oqu(t.tableNumber),f.xp6(4),f.Oqu(f.G7q(21,8,f.VKq(19,nt,t.montantReduction?t.montantReduction:t.commande.cartdetails.totalPrice))),f.xp6(5),f.Oqu(t.userName),f.xp6(1),f.Q6J("ngIf",t.show)}}function vt(t,e){if(1&t&&(f.TgZ(0,"div",1),f.YNc(1,ft,27,21,"ion-row",2),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.Q6J("ngForOf",t.notifications)}}let Zt=(()=>{class t{constructor(t,e,i,o,n,s,r,c){this.modalController=t,this.urlService=e,this.printService=i,this.events=o,this.http=n,this.cache=s,this.resApi=r,this.platform=c,this.valueChange=new f.vpe,this.montantR=0,this.reste=0,this.tabResto=[],this.appOnline=!1,this.pdfObj=null,this.longueurLigne=0,this.timeTL=30,this.totalArticleBTL=0,this.totalArticleCA=0,this.totalArticle=0,this.totalCassier=0,this.totalBtl=0,this.totalImpaye=0,this.adminId=localStorage.getItem("adminId"),this.takeUrl(),this.events.getNewOrder().subscribe(t=>{if(console.log("data here==>",t),t&&t.Posconfirm);else{let e=JSON.parse(localStorage.getItem("timeToLeave")),i=!1;if("yes"===localStorage.getItem("printerAutorisation")&&(i=!0),e&&(this.timeTL=e),t&&t.localId){if(this.timeTL&&i){let e=JSON.parse(localStorage.getItem("timeToLeave"));setTimeout(()=>{this.notifications.findIndex(e=>e.localId===t.localId)>=0&&this.Send(t)},1e3*e)}this.localServer(t)}}}),this.events.getConfirmOrder().subscribe(t=>{if(t.localId){let e=this.notifications.findIndex(e=>e.localId===t.localId);if(e>=0){let t=this.notifications[e];t.confirm=!0,this.notifications[e].confirm=!0,this.notifications.splice(e,1,t)}}}),this.events.getInvoiceCancelUpdate().subscribe(t=>{if(t.localId){let e=this.notifications.findIndex(e=>e.localId===t.localId);e>=0&&this.notifications.splice(e,1,t)}}),this.events.getAddOrder().subscribe(t=>{t&&setTimeout(()=>{let e=this.notifications.findIndex(e=>e.localId===t.localId);e>=0&&this.notifications.splice(e,1,t)},400)}),this.events.getInvoiceCancel().subscribe(t=>{setTimeout(()=>{t.localId&&this.notifications.findIndex(e=>e.localId==t.localId)>=0&&(this.notifications=this.notifications.filter(e=>e.localId!==t.localId))},2e3)})}ngOnInit(){}takeUrl(){this.urlService.getUrl().subscribe(t=>{this.url=t,this.webServerSocket(this.adminId)})}Send(t){let e;t.anime=!0,t.leftposition=!0,t.Posconfirm=!0,e=this.notifications.findIndex(t.localId?e=>e.localId===t.localId:e=>e._id===t._id),e>=0&&(this.items._results[e].nativeElement.classList.add("animated","bounceOutLeft","delay-0s"),this.events.publishOrder(t),this.events.posStoreOrders(t,"update").then(t=>{}),setTimeout(()=>{t.localId?(t.Posconfirm=!0,this.notifications=this.notifications.filter(e=>e.localId!==t.localId)):this.notifications=this.notifications.filter(e=>e._id!==t._id),this.valueChange.emit(t)},500))}Display(t,e){return(0,c.mG)(this,void 0,void 0,function*(){this.tabResto=[],t.commande&&t.commande.plat&&(this.grouped=this.groupBy(t.commande.plat,"plat")),this.items._results[e].nativeElement.classList.remove("animated","heartBeat","signalColor","infinite","delay-2s"),this.sum=0,this.montantR=0,this.reste=0,t.show?t.show=!1:(t.show=!0,this.sum=t.commande.cartdetails.totalPrice,this.montantR=t.commande.montantRecu,this.reste=this.montantR-this.sum),t.products.forEach(e=>{"manufacturedItems"==e.item.productType&&(e.item.userName=t.userName,this.tabResto.push(e))})})}webServerSocket(t){this.sockets=m()(this.url),this.sockets.on(`${t}newOrder`,t=>(0,c.mG)(this,void 0,void 0,function*(){if(this.appOnline){let e=[];this.grouped=[],"yes"===localStorage.getItem("printerAutorisation")?(setTimeout(()=>{},500),setTimeout(()=>{console.log("start all"),this.notifications.filter(e=>e.localId==t.localId||e._id==t._id).length?console.log("existe"):(t.signal=!0,this.notifications.push(t),setTimeout(()=>{this.PrintBill(t)},4e3),t.commande&&t.commande.plat&&(e=t.commande.plat,this.grouped=this.groupBy(e,"plat"),setTimeout(()=>{this.PrintBill2(this.grouped,t.userName,t.numFacture)},6e3)))},400),setTimeout(()=>{},3e4)):setTimeout(()=>{this.notifications.filter(e=>e.localId==t.localId).length?console.log("existe"):console.log("here =========+++-----")},400)}})),this.sockets.on(`${t}invoiceadd`,t=>{this.appOnline&&setTimeout(()=>{let e=this.notifications.findIndex(e=>e._id===t._id);e>=0&&this.notifications.splice(e,1,t)},500)}),this.sockets.on(`${this.adminId}confirmOrder`,t=>{this.appOnline&&(this.notifications=this.notifications.filter(e=>e._id!==t._id))})}PrintBill2(t,e,i){this.company=localStorage.getItem("company");let o="",n="",s=(`${this.company}`.toUpperCase(),e.toUpperCase()),r={},c=`                   CUISINE: \n      FACTURE: ${i}      ${s}\n===============================\n\n`;for(const a in this.grouped)this.grouped[a].forEach(t=>{if(parseInt(t.nbr))if(r[`plat${t.plat}`]){let e=t.produit.name.toUpperCase();if(e.length<40){let t=40-e.length;for(let i=0;i<t;i++)e=" "+e}n+=`plat ${t.plat}: ${t.nbr} ${e}\n`}else{let e=t.produit.name.toUpperCase();if(e.length<22){let t=22-e.length;for(let i=0;i<t;i++)e+=" "}n+=`${t.nbr} ${e} plat ${t.plat}\n`}});o=`${c}${n}`,"yes"===localStorage.getItem("printerAutorisation")&&setTimeout(()=>{this.printService.printText(o)},5e3),this.tabResto=[]}groupBy(t,e){return t.reduce(function(t,i){var o=i[e];return t[o]||(t[o]=[]),t[o].push(i),t},{})}PrintBill(t){Array(6).join(" ");let e=[],i=0,o="";o=localStorage.getItem("printerSize")?localStorage.getItem("printerSize"):"large",t.commandes.forEach((n,s)=>{if(e.push(`               COMMANDE ${s+1}:  ${n.cartdetails.totalPrice}  FCFA\n`),n.products.forEach(t=>{let n=t.item.name.toUpperCase();if(i+=t.price,n.length<22&&"large"==o){let t=22-n.length;for(let e=0;e<t;e++)n+=" "}else n.length>10?n=n.slice(0,9):n+=Array(10-n.length).join(" ");if(t.item.modeG){let i=t.item.sellingPrice.toString(),o=8-i.length;for(let t=0;t<o;t++)i+=" ";let s=`${n}   ${t.item.modeG}     ${i}   ${t.item.sellingPrice*t.item.modeG}\n`,r="";for(let t=0;t<s.length;t++)r+="-";let c=s+`${r}`;this.longueurLigne=c.length,e.push(c)}if(t.item.modeNG){let i=t.item.sellingPrice.toString(),o=8-i.length;for(let t=0;t<o;t++)i+=" ";let s=`${n}   ${t.item.modeNG}     ${i}   ${t.item.sellingPrice*t.item.modeNG}\n`,r="";for(let t=0;t<s.length;t++)r+="-";let c=s+`${r}`;this.longueurLigne=c.length,e.push(c)}if(t.item.BTL){let i=t.item.sellingPrice.toString(),o=8-i.length;for(let t=0;t<o;t++)i+=" ";let s=`${n}   ${t.item.BTL} BTL   ${i}   ${t.item.sellingPrice*t.item.BTL}\n`,r="";for(let t=0;t<s.length;t++)r+="-";let c=s+`${r}`;this.longueurLigne=c.length,e.push(c)}if(t.item.CA){let i=t.item.sellingPackPrice.toString(),o=8-i.length;for(let t=0;t<o;t++)i+=" ";let s=`${n}   ${t.item.CA} CA   ${i}  ${t.item.sellingPackPrice*t.item.CA}\n`,r="";for(let t=0;t<s.length;t++)r+="-";let c=s+`${r}`;this.longueurLigne=c.length,e.push(c)}if(!(t.item.modeNG||t.item.modeG||t.item.CA||t.item.BTL)){let i=t.item.sellingPrice.toString(),o=8-i.length;for(let t=0;t<o;t++)i+=" ";let s=`${n}   ${t.qty}     ${i}   ${t.item.sellingPrice*t.qty}\n`,r="";for(let t=0;t<s.length-1;t++)r+="-";let c=s+`${r}`;this.longueurLigne=c.length,e.push(c)}}),(this.totalArticleBTL||this.totalArticleCA)&&(e.push("TOTAL COLIS: \n"),e.push(`Arti:  ${this.totalArticle}  ca: ${this.totalArticleCA}  Btl: ${this.totalArticleBTL} \n`)),t.trancheList&&t.trancheList.length&&(e.push("               HISTORIQUE DE PAIEMENT:   \n"),t.trancheList.forEach(t=>{let i=new Date(t.created),o=String(i.getDate()).padStart(2,"0")+"/"+String(i.getMonth()+1).padStart(2,"0")+"/"+i.getFullYear(),n=t.employeName.toUpperCase();n.length>16&&(n=n.substring(0,8));let s=t.montant.toString(),r=16-s.length;for(let e=0;e<r;e++)s+=" ";let c=`${o}${Array(16-o.length).join(" ")}${s}${Array(16-n.length).join(" ")}${n}\n`,a="";for(let e=0;e<c.length-1;e++)a+="-";let l=c+`${a}`;this.longueurLigne=l.length,e.push(l)})),this.consigneTab&&this.consigneTab.length){console.log(this.consigneTab),e.push("               EMBALLAGES EN CONSIGNES:   \n"),e.push("ARTICLES                Qt\xe9      PU      TOTAL\n");let t=`Cassier                   ${this.totalCassier}    ----    ${this.totalConsigne}\n`,i=`bouteille                  ${this.totalBtl}    ---    ----\n`,o="";for(let e=0;e<t.length-1;e++)o+="-";let n=i+`${o}`;e.push(t+`${o}`),e.push(n),this.totalArticle&&e.push(`\nTOTAL CONSIGNE: ca: ${this.totalCassier}  Btl: ${this.totalBtl} \n`)}}),this.makePdf(e,i,t.userName,t.numFacture,t),localStorage.getItem("printerAutorisation")}localServer(t){let e="erico";e=JSON.parse(JSON.stringify(t)),e.commande=e.cart,e.products=e.cart.products,e.commandes=[e.cart];let i=[];this.grouped=[];let o=localStorage.getItem("printerAutorisation");o&&"yes"===o?(setTimeout(()=>{this.notifications.push(e)},400),setTimeout(()=>{let t=[];e.commande.products.forEach(e=>{"manufacturedItems"==e.item.productType||t.push(e)}),e.printelt=t,t.length&&this.PrintBill(e),e.commande&&e.commande.plat&&(i=e.commande.plat,this.grouped=this.groupBy(i,"plat"),this.PrintBill2(this.grouped,e.userName,e.numFacture))},1500)):setTimeout(()=>{this.notifications.push(e)},400)}makePdf(t,e,i,o,n){let s=JSON.parse(localStorage.getItem("credentialAccount")).users[0],r=`PROMOTEUR: ${s.firstName} ${s.lastName}   TEL: ${s.telephone}`,c=new Date,a=c.getFullYear(),l=c.getMonth()+1,d=c.getDate(),h=c.getHours(),g=c.getMinutes(),u=new Date(n.created),p=`DATE: ${u.getDate()}/${u.getMonth()+1}/${u.getFullYear()}\n`,m="\n";m=r+m,n.commande&&n.commande.customer&&(m+=`CLIENT: ${n.commande.customer.name}         TEL: ${n.commande.customer.phone}\n`);let f=m+`SERVICE: ${i.toUpperCase()}         FACTURE:  ${a}${l}${d}${o}\n`;f=f+p+`Imprim\xe9e le: ${d}/${l}/${a}  ${h}h:${g}min\n\n`;let v="";t.forEach(t=>{v+=`${t}\n`});let Z=f+`${v}`;if(this.platform.is("android")||this.platform.is("ios"))this.printService.scan2(Z,e,this.montantR,this.longueurLigne,this.totalImpaye,this.totalConsigne);else{let t="\n",i=JSON.parse(localStorage.getItem("setting"));i.entete_facture&&(t=`${i.entete_facture.toUpperCase()}\n`),this.resApi.printInvoice({texteEntete:t,texte:Z,sum:e,montantR:this.montantR,longueurLigne:this.longueurLigne,totalImpaye:this.totalImpaye,totalConsigne:this.totalConsigne}).subscribe(t=>{console.log(t)})}}takeImage(){return new Promise((t,e)=>{this.http.get("/assets/willy.png",{responseType:"blob"}).subscribe(e=>{const i=new FileReader;i.onloadend=()=>{t(i.result)},i.readAsDataURL(e)})})}takeImage2(t){return new Promise((e,i)=>{this.http.get(t,{responseType:"blob"}).subscribe(t=>{const i=new FileReader;i.onloadend=()=>{e(i.result)},i.readAsDataURL(t),console.log(t)})})}buildTableBody(t,e){var i=[];return i.push(e),t.forEach(function(t){var o=[];e.forEach(function(e){o.push({text:t[e.text].toString(),alignment:"center"})}),i.push(o)}),i}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(r.IN),f.Y36(x.i),f.Y36(q.v),f.Y36(I.t),f.Y36(L.eN),f.Y36(w.$),f.Y36(A.e),f.Y36(r.t4))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-displayorders"]],viewQuery:function(t,e){if(1&t&&f.Gf(K,1,f.SBq),2&t){let t;f.iGM(t=f.CRH())&&(e.items=t)}},inputs:{notifications:"notifications"},outputs:{valueChange:"valueChange"},decls:1,vars:1,consts:[["class","divtable",4,"ngIf"],[1,"divtable"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["itemlist",""],["size","2",1,"ion-align-self-start",3,"click"],["name","add",4,"ngIf"],["name","arrow-down",4,"ngIf"],["size","2",1,"ion-align-self-center"],[1,"ion-text-uppercase"],["size","3",1,"ion-align-self-center"],["size","12",3,"click",4,"ngIf"],["name","add"],["name","arrow-down"],["size","12",3,"click"],["class","header-row1",4,"ngFor","ngForOf"],["size-md","4"],[1,"ion-text-center","ion-text-wrap"],[1,"totalsmall"],[1,"header-row1"],["size","4","size-md","4",4,"ngIf"],["size","4","size-md","4"],[1,"ion-text-uppercase","ion-text-nowrap"],[1,"namesmall","gras"],[1,"ion-text-center","ion-text-uppercase","gras"],[1,"pricesmall"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap","gras"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap"]],template:function(t,e){1&t&&f.YNc(0,vt,2,1,"div",0),2&t&&f.Q6J("ngIf",e.notifications)},directives:[o.O5,o.sg,r.Nd,o.mk,r.wI,r.gu],pipes:[o.H9],styles:[".tableNumber[_ngcontent-%COMP%], .title[_ngcontent-%COMP%]{text-align:center;text-transform:uppercase}ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%], ion-col[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:12px}.header-row1[_ngcontent-%COMP%]{background-color:#f1f1f1}.header-row1[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-transform:uppercase;font-size:11px}.data-row1[_ngcontent-%COMP%]{border-bottom:1px solid #f1f1f1}.gras[_ngcontent-%COMP%]{font-weight:700}.divtable[_ngcontent-%COMP%]{width:100%;padding-bottom:20px}.signalColor[_ngcontent-%COMP%]{border-style:1px solid red}"]}),t})();function bt(t,e){1&t&&(f.TgZ(0,"p",10),f._UZ(1,"ion-icon",11),f.qZA())}function It(t,e){1&t&&(f.TgZ(0,"p",12),f._UZ(1,"ion-icon",13),f.qZA())}const Ct=function(t,e){return{animated:t,fadeInRight:e}};function At(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"tr",6),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw(2).Send(i)}),f.TgZ(1,"td"),f._uU(2),f.qZA(),f.TgZ(3,"td"),f._uU(4),f.qZA(),f.TgZ(5,"td"),f._uU(6),f.qZA(),f.TgZ(7,"td"),f._uU(8),f.ALo(9,"currency"),f.qZA(),f.TgZ(10,"td"),f._uU(11),f.ALo(12,"currency"),f.qZA(),f.TgZ(13,"td"),f._uU(14),f.qZA(),f.TgZ(15,"td",7),f._uU(16),f.ALo(17,"date"),f.qZA(),f.TgZ(18,"td"),f.YNc(19,bt,2,0,"p",8),f.YNc(20,It,2,0,"p",9),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.Q6J("ngClass",f.WLB(23,Ct,t.anime,t.anime)),f.xp6(2),f.hij(" ",t.numFacture," "),f.xp6(2),f.hij(" ",t.tableNumber," "),f.xp6(2),f.Oqu(t.commandes.length),f.xp6(2),f.hij(" ",f.gM2(9,10,t.montantReduction?t.montantReduction:t.commande.cartdetails.totalPrice,"FCFA","symbol","3.0-0")," "),f.xp6(3),f.hij(" ",f.gM2(12,15,t.recu?t.recu:0,"FCFA","symbol","3.0-0")," "),f.xp6(3),f.hij(" ",t.userName," "),f.xp6(2),f.hij(" ",f.xi3(17,20,t.created,"short")," "),f.xp6(3),f.Q6J("ngIf",!t.confirm&&t.Posconfirm),f.xp6(1),f.Q6J("ngIf",t.confirm&&t.Posconfirm)}}function Tt(t,e){if(1&t&&(f.TgZ(0,"div",1),f.TgZ(1,"table",2),f.TgZ(2,"tr",3),f.TgZ(3,"th"),f._uU(4,"N0"),f.qZA(),f.TgZ(5,"th"),f._uU(6,"TABLE"),f.qZA(),f.TgZ(7,"th"),f._uU(8,"com"),f.qZA(),f.TgZ(9,"th"),f._uU(10),f.ALo(11,"translate"),f.qZA(),f.TgZ(12,"th",4),f._uU(13),f.ALo(14,"translate"),f.qZA(),f.TgZ(15,"th"),f._uU(16),f.ALo(17,"translate"),f.qZA(),f.TgZ(18,"th"),f._uU(19,"DATE"),f.qZA(),f.TgZ(20,"th"),f._uU(21,"STATUT"),f.qZA(),f.qZA(),f.YNc(22,At,21,26,"tr",5),f.qZA(),f.qZA()),2&t){const t=f.oxw();f.xp6(10),f.hij("T.",f.lcZ(11,4,"MENU.price"),""),f.xp6(3),f.Oqu(f.lcZ(14,6,"MENU.percu")),f.xp6(3),f.Oqu(f.lcZ(17,8,"MENU.employe")),f.xp6(6),f.Q6J("ngForOf",t.orders)}}let xt=(()=>{class t{constructor(t,e,i,o,n,s){this.urlService=t,this.events=e,this.restApiService=i,this.router=o,this.cache=n,this.printService=s,this.sendOrder=new f.vpe,this.appOnline=!0,this.adminId=localStorage.getItem("adminId"),this.userName=JSON.parse(localStorage.getItem("user")).name,this.takeUrl()}ngOnInit(){setTimeout(()=>{this.orders.forEach(t=>{t.trancheList&&t.trancheList.length&&(t.recu=0,t.trancheList.forEach(e=>{t.recu=t.recu+e.montant}))})},1e3)}ngOnChanges(){}ionViewDidEnter(){console.log("hello did enter to component")}takeUrl(){this.urlService.getUrl().subscribe(t=>{this.url=t,this.webServerSocket(this.adminId)})}Send(t){this.sendOrder.emit(t)}webServerSocket(t){this.sockets=m()(this.url),this.sockets.on(`${t}buyOrder`,t=>{this.appOnline&&(this.orders=this.orders.filter(e=>e._id!==t._id))}),this.sockets.on(`${t}deleteOrder`,t=>{this.appOnline&&(this.orders=this.orders.filter(e=>e._id!==t))}),this.sockets.on(`${this.adminId}invoiceCancel`,t=>{this.appOnline&&(this.orders=this.orders.filter(e=>e._id!==t._id))}),this.sockets.on(`${this.adminId}confirmOrder`,t=>{this.appOnline&&setTimeout(()=>{this.orders.filter(e=>e._id==t._id).length?console.log("existe"):(t.anime=!0,this.orders.unshift(t))},1e3)}),this.sockets.on(`${t}serviceConfirmOrder`,t=>{this.appOnline&&setTimeout(()=>{let e=this.orders.findIndex(e=>e._id===t._id);e>=0&&this.orders.splice(e,1,t)},500)}),this.sockets.on(`${t}invoiceadd`,t=>{setTimeout(()=>{},500)}),this.sockets.on(`${t}newOrder`,t=>(0,c.mG)(this,void 0,void 0,function*(){console.log("facture",t);let e=[];t.commande&&t.commande.plat&&(e=t.commande.plat,this.grouped=this.groupBy(e,"plat"),setTimeout(()=>{this.PrintBill2(this.grouped,t.userName,t.numFacture)},6e3))}))}listenEvent(){this.events.getPublishOrder().subscribe(t=>{console.log("publish order"),t.localId&&setTimeout(()=>{this.orders.findIndex(e=>e.localId===t.localId)>=0||(t.anime=!0,t.Posconfirm=!0,t.userName==this.userName&&(t.sender="POS"),this.orders.unshift(t),this.events.posStoreOrders(t,"update").then(t=>{}))},1e3)}),this.events.getConfirmOrder().subscribe(t=>{if(console.log("confrim orderst"),t.localId){let e=this.orders.findIndex(e=>e.localId===t.localId);if(e>=0){let t=this.orders[e];t.Posconfirm=!0,t.confirm=!0,this.orders[e].Posconfirm=!0,this.orders[e].confirm=!0,this.orders.splice(e,1,t)}}}),this.events.getInvoiceCancelUpdate().subscribe(t=>{console.log("cancel update"),setTimeout(()=>{if(t.localId){let e=this.orders.findIndex(e=>e.localId===t.localId);if(e>=0&&t.commandes){let i=0;t.commandes.forEach(t=>{t.products.forEach(t=>{i+=t.price})}),t.totalPrice=i,this.orders.splice(e,1,t)}}},1e3)}),this.events.getInvoiceCancel().subscribe(t=>{console.log("cancel"),setTimeout(()=>{t.localId&&this.orders.findIndex(e=>e.localId==t.localId)>=0&&(this.orders=this.orders.filter(e=>e.localId!==t.localId))},1e3)}),this.events.getAddOrder().subscribe(t=>{console.log("add"),t&&setTimeout(()=>{let e=this.orders.findIndex(e=>e.localId===t);if(e>=0){let i;if(i=this.cache.getCachedRequest("userCommande"),i&&i.length){let o=i.findIndex(e=>e.localId===t);if(o>=0){let t=i[o],n=0;t.commandes.forEach(t=>{t.products.forEach(t=>{n+=t.price})}),t.totalPrice=n,this.orders.splice(e,1,t)}}}},800)})}add(t){console.log(t),this.restApiService.saveCart({cart:t.cart,products:t.products}),this.router.navigateByUrl("shop")}groupBy(t,e){return t.reduce(function(t,i){var o=i[e];return t[o]||(t[o]=[]),t[o].push(i),t},{})}PrintBill2(t,e,i){this.company=localStorage.getItem("company");let o="",n="",s=(`${this.company}`.toUpperCase(),e.toUpperCase()),r={},c=`                   CUISINE: \n      FACTURE: ${i}      ${s}\n===============================\n\n`;for(const l in this.grouped)this.grouped[l].forEach(t=>{if(parseInt(t.nbr))if(r[`plat${t.plat}`]){let e=t.produit.name.toUpperCase();if(e.length<40){let t=40-e.length;for(let i=0;i<t;i++)e=" "+e}n+=`plat ${t.plat}: ${t.nbr} ${e}\n`}else{let e=t.produit.name.toUpperCase();if(e.length<22){let t=22-e.length;for(let i=0;i<t;i++)e+=" "}n+=`${t.nbr} ${e} plat ${t.plat}\n`}});o=`${c}${n}`,this.printService.printText(o);let a=localStorage.getItem("printerAutorisation");a&&"yes"===a&&setTimeout(()=>{},5e3)}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(x.i),f.Y36(I.t),f.Y36(A.e),f.Y36(s.F0),f.Y36(w.$),f.Y36(q.v))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-displayinvoices"]],inputs:{orders:"orders"},outputs:{sendOrder:"sendOrder"},features:[f.TTD],decls:1,vars:1,consts:[["class","divtable",4,"ngIf"],[1,"divtable"],[1,"tableh2",2,"width","100%"],[1,"firstcolone",2,"text-transform","uppercase"],[2,"text-transform","uppercase"],[3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ngClass","click"],[1,"un"],["class","btnStatus",4,"ngIf"],["class","tableNumber2 btnStatus",4,"ngIf"],[1,"btnStatus"],["color","warning","name","checkmark-circle-outline"],[1,"tableNumber2","btnStatus"],["color","success","name","checkmark-circle-outline"]],template:function(t,e){1&t&&f.YNc(0,Tt,23,10,"div",0),2&t&&f.Q6J("ngIf",e.orders)},directives:[o.O5,o.sg,o.mk,r.gu],pipes:[M.X$,o.H9,o.uU],styles:[".invoices[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%], ion-item[_ngcontent-%COMP%]{--background:#0000}.invoices[_ngcontent-%COMP%]{background-color:#ff0}table[_ngcontent-%COMP%]{font-family:arial,sans-serif;border-collapse:collapse;width:100%;margin-bottom:5%}.divtable[_ngcontent-%COMP%]{width:100%;padding-bottom:20px}td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid #ddd;text-align:center;padding:4px;font-size:11px}tr[_ngcontent-%COMP%]{background-color:#fff;width:100%}tr[_ngcontent-%COMP%]:nth-child(2n){background-color:#ddd}.otherrows[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{height:5px;border:1px solid #0c0c0ce8;text-align:center;padding-left:8px;padding-right:8px;font-size:8px}.title[_ngcontent-%COMP%]{text-align:center;text-transform:uppercase}@media (min-width:800px){tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:14px}.btnStatus[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-align:center}.btnStatus[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}}"]}),t})();function Ot(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",12),f.NdJ("click",function(){return f.CHM(t),f.oxw(2).postCashOpen()}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&t&&(f.xp6(1),f.hij(" ",f.lcZ(2,1,"MENU.open_cash")," "))}function St(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",12),f.NdJ("click",function(){return f.CHM(t),f.oxw(2).presentAlertPrompt()}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&t&&(f.xp6(1),f.hij(" ",f.lcZ(2,1,"MENU.close_cash")," "))}function qt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-header"),f.TgZ(1,"ion-toolbar"),f.TgZ(2,"ion-buttons",3),f.TgZ(3,"ion-button",4),f.NdJ("click",function(){return f.CHM(t),f.oxw().presentModal()}),f._UZ(4,"ion-icon",5),f.TgZ(5,"ion-badge",6),f._uU(6),f.qZA(),f.qZA(),f.TgZ(7,"ion-button",7),f._uU(8),f.qZA(),f.YNc(9,Ot,3,3,"ion-button",8),f.YNc(10,St,3,3,"ion-button",8),f.qZA(),f.TgZ(11,"ion-buttons",9),f._UZ(12,"ion-menu-button",10),f.TgZ(13,"ion-button",11),f._uU(14),f.ALo(15,"translate"),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw();f.xp6(3),f.Q6J("disabled",!t.notification),f.xp6(3),f.hij("",t.notification.length," "),f.xp6(2),f.hij(" ",t.userName," "),f.xp6(1),f.Q6J("ngIf",!t.cashOpened),f.xp6(1),f.Q6J("ngIf",t.cashOpened),f.xp6(4),f.hij(" ",f.lcZ(15,6,"MENU.pos")," ")}}function _t(t,e){1&t&&(f.TgZ(0,"ion-row",18),f.TgZ(1,"ion-col",19),f.TgZ(2,"div",20),f.TgZ(3,"h1"),f._uU(4,"MAERI POS"),f.qZA(),f.qZA(),f.qZA(),f.qZA())}function Pt(t,e){if(1&t&&(f.TgZ(0,"ion-grid",16),f.YNc(1,_t,5,0,"ion-row",17),f.qZA()),2&t){const t=f.oxw(2);f.xp6(1),f.Q6J("ngIf",0==t.orders.length)}}function yt(t,e){1&t&&(f.TgZ(0,"ion-row",18),f.TgZ(1,"ion-col",19),f.TgZ(2,"div",24),f.TgZ(3,"h6"),f._uU(4,"date"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(5,"ion-col",19),f.TgZ(6,"div",24),f.TgZ(7,"h6"),f._uU(8,"montant"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(9,"ion-col",19),f.TgZ(10,"div",24),f.TgZ(11,"h6"),f._uU(12,"name"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(13,"ion-col",19),f.TgZ(14,"div",24),f.TgZ(15,"h6"),f._uU(16,"\xe9tat"),f.qZA(),f.qZA(),f.qZA(),f.qZA())}function kt(t,e){1&t&&f._UZ(0,"ion-icon",31)}function wt(t,e){1&t&&f._UZ(0,"ion-icon",32)}const Nt=function(t){return{"background-color":t}};function Mt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-row",25),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw(3).viewMobileManageOrder(i)}),f.TgZ(1,"ion-col",19),f.TgZ(2,"div",26),f.TgZ(3,"h5"),f._uU(4),f.ALo(5,"date"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(6,"ion-col",19),f.TgZ(7,"div",26),f.TgZ(8,"h5",27),f._uU(9),f.ALo(10,"currency"),f.qZA(),f.qZA(),f.qZA(),f.TgZ(11,"ion-col",19),f.TgZ(12,"div",28),f.TgZ(13,"h5"),f._uU(14),f.qZA(),f.qZA(),f.qZA(),f.TgZ(15,"ion-col",19),f.TgZ(16,"div",28),f.YNc(17,kt,1,0,"ion-icon",29),f.YNc(18,wt,1,0,"ion-icon",30),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.Q6J("ngStyle",f.VKq(12,Nt,e.index%2==0?"#f1f1f1":"white")),f.xp6(4),f.Oqu(f.xi3(5,6,t.created,"short")),f.xp6(5),f.hij(" ",f.xi3(10,9,t.commande.cartdetails.totalPrice,"FCFA")," "),f.xp6(5),f.Oqu(t.userName),f.xp6(3),f.Q6J("ngIf",!t.confirm&&t.Posconfirm),f.xp6(1),f.Q6J("ngIf",t.confirm&&t.Posconfirm)}}function $t(t,e){if(1&t&&(f.TgZ(0,"ion-grid",21),f.TgZ(1,"ion-row"),f.TgZ(2,"ion-col",19),f.TgZ(3,"div",22),f._uU(4," factures r\xe9centes "),f.qZA(),f.qZA(),f.qZA(),f.YNc(5,yt,17,0,"ion-row",17),f.YNc(6,Mt,19,14,"ion-row",23),f.qZA()),2&t){const t=f.oxw(2);f.xp6(5),f.Q6J("ngIf",t.orders.length),f.xp6(1),f.Q6J("ngForOf",t.orders)}}function Ut(t,e){if(1&t&&(f.TgZ(0,"ion-content",13),f.YNc(1,Pt,2,1,"ion-grid",14),f.YNc(2,$t,7,2,"ion-grid",15),f.qZA()),2&t){const t=f.oxw();f.xp6(1),f.Q6J("ngIf",0==t.orders.length),f.xp6(1),f.Q6J("ngIf",t.orders.length)}}function Et(t,e){1&t&&(f.TgZ(0,"p",57),f._UZ(1,"ion-icon",31),f.qZA())}function Rt(t,e){1&t&&(f.TgZ(0,"p",58),f._UZ(1,"ion-icon",32),f.qZA())}function Jt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-item",50),f.NdJ("click",function(){f.CHM(t);const i=e.$implicit;return f.oxw(5).displayDetails(i)}),f.TgZ(1,"a",51),f._UZ(2,"ion-icon",52),f.qZA(),f.TgZ(3,"ion-label"),f.TgZ(4,"p"),f._uU(5),f.TgZ(6,"a",53),f._uU(7),f.qZA(),f._UZ(8,"br"),f.TgZ(9,"a",54),f._uU(10),f.ALo(11,"date"),f.qZA(),f.qZA(),f.YNc(12,Et,2,0,"p",55),f.YNc(13,Rt,2,0,"p",56),f.qZA(),f.qZA()}if(2&t){const t=e.$implicit;f.xp6(5),f.hij(" ",t.commande.cartdetails.totalPrice,"FCFA "),f.xp6(2),f.hij("table: ",t.tableNumber,""),f.xp6(3),f.AsE(" ",t.userName," ",f.xi3(11,6,t.created,"medium"),""),f.xp6(2),f.Q6J("ngIf",!t.confirm&&t.Posconfirm),f.xp6(1),f.Q6J("ngIf",t.confirm&&t.Posconfirm)}}function Lt(t,e){if(1&t&&(f.TgZ(0,"div"),f.TgZ(1,"ion-list"),f.TgZ(2,"ion-list-header"),f.TgZ(3,"ion-label"),f._uU(4,"Invoices"),f.qZA(),f.qZA(),f.YNc(5,Jt,14,9,"ion-item",49),f.qZA(),f.qZA()),2&t){const t=f.oxw(4);f.xp6(5),f.Q6J("ngForOf",t.orders)}}function Yt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div"),f.TgZ(1,"app-displayorders",59),f.NdJ("valueChange",function(e){return f.CHM(t),f.oxw(4).displayCounter(e)}),f.qZA(),f.qZA()}if(2&t){const t=f.oxw(4);f.xp6(1),f.Q6J("notifications",t.desktopTab)}}function Ft(t,e){1&t&&(f.TgZ(0,"div"),f._uU(1,"output33"),f.qZA())}function Dt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div",39),f.TgZ(1,"div",40),f.TgZ(2,"app-displayitems",41),f.NdJ("valueChange",function(e){return f.CHM(t),f.oxw(3).displayCart(e)}),f.qZA(),f.qZA(),f.TgZ(3,"div",42),f.TgZ(4,"ion-header",35),f.TgZ(5,"ion-toolbar",43),f.TgZ(6,"ion-row"),f.TgZ(7,"ion-col",44),f.TgZ(8,"ion-button",45),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).viewMode="invoices"}),f._uU(9," Invoices "),f.qZA(),f.TgZ(10,"ion-button",45),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).viewMode="orders"}),f._uU(11," Orders "),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.qZA(),f.TgZ(12,"div",46),f.YNc(13,Lt,6,1,"div",47),f.YNc(14,Yt,2,1,"div",47),f.YNc(15,Ft,2,0,"div",48),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw(3);f.xp6(8),f.ekj("active","invoices"==t.viewMode),f.xp6(2),f.ekj("active","orders"==t.viewMode),f.xp6(2),f.Q6J("ngSwitch",t.viewMode),f.xp6(1),f.Q6J("ngSwitchCase","invoices"),f.xp6(1),f.Q6J("ngSwitchCase","orders")}}function Qt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div"),f.TgZ(1,"ion-header",35),f.TgZ(2,"ion-toolbar",36),f._UZ(3,"ion-row",18),f.TgZ(4,"ion-buttons",3),f.TgZ(5,"ion-button",37),f.NdJ("click",function(){f.CHM(t);const e=f.oxw(2);return e.shopAutorisation=!e.shopAutorisation}),f._uU(6," Services "),f.qZA(),f.qZA(),f.TgZ(7,"ion-buttons",9),f._UZ(8,"ion-menu-button",10),f.qZA(),f.qZA(),f.qZA(),f.YNc(9,Dt,16,7,"div",38),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(9),f.Q6J("ngIf",t.shopAutorisation)}}function Gt(t,e){1&t&&f._UZ(0,"ion-menu-button",70)}function jt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",71),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).router.navigateByUrl("shop")}),f._uU(1," Services"),f.qZA()}}function Bt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",72),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).router.navigateByUrl("procurment-product-item")}),f._UZ(1,"ion-icon",5),f.TgZ(2,"ion-badge",6),f._uU(3),f.qZA(),f.qZA()}if(2&t){const t=f.oxw(3);f.xp6(3),f.hij("",t.transaction.length," ")}}function zt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",63),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).postCashOpen()}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&t&&(f.xp6(1),f.hij(" ",f.lcZ(2,1,"MENU.open_cash")," "))}function Ht(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"ion-button",63),f.NdJ("click",function(){return f.CHM(t),f.oxw(3).presentAlertPrompt()}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&t&&(f.xp6(1),f.hij(" ",f.lcZ(2,1,"MENU.close_cash")," "))}function Vt(t,e){if(1&t){const t=f.EpF();f.TgZ(0,"div"),f.TgZ(1,"ion-header",35),f.TgZ(2,"ion-toolbar",36),f._UZ(3,"ion-row",18),f.TgZ(4,"ion-buttons",9),f.YNc(5,Gt,1,0,"ion-menu-button",60),f.YNc(6,jt,2,0,"ion-button",61),f.YNc(7,Bt,4,1,"ion-button",62),f.qZA(),f.TgZ(8,"ion-buttons",3),f.TgZ(9,"ion-button",63),f.NdJ("click",function(){return f.CHM(t),f.oxw(2).pickRetailer()}),f._UZ(10,"ion-icon",64),f._uU(11),f.ALo(12,"translate"),f.qZA(),f.TgZ(13,"ion-button",63),f.NdJ("click",function(){return f.CHM(t),f.oxw(2).router.navigateByUrl("consigne")}),f._UZ(14,"ion-icon",65),f._uU(15),f.ALo(16,"translate"),f.qZA(),f.YNc(17,zt,3,3,"ion-button",66),f.YNc(18,Ht,3,3,"ion-button",66),f.qZA(),f.qZA(),f.qZA(),f.TgZ(19,"div",39),f.TgZ(20,"div",67),f.TgZ(21,"app-displayinvoices",68),f.NdJ("sendOrder",function(e){return f.CHM(t),f.oxw(2).displayDetails(e)}),f.qZA(),f.qZA(),f.TgZ(22,"div",69),f.TgZ(23,"app-displayorders",59),f.NdJ("valueChange",function(e){return f.CHM(t),f.oxw(2).displayCounter(e)}),f.qZA(),f.qZA(),f.qZA(),f.qZA()}if(2&t){const t=f.oxw(2);f.xp6(5),f.Q6J("ngIf",t.cashOpened),f.xp6(1),f.Q6J("ngIf",t.cashOpened),f.xp6(1),f.Q6J("ngIf",t.transaction.length),f.xp6(4),f.hij(" ",f.lcZ(12,9,"MENU.retailer")," "),f.xp6(4),f.hij(" ",f.lcZ(16,11,"MENU.consigne")," "),f.xp6(2),f.Q6J("ngIf",!t.cashOpened),f.xp6(1),f.Q6J("ngIf",t.cashOpened),f.xp6(3),f.Q6J("orders",t.orders),f.xp6(2),f.Q6J("notifications",t.desktopTab)}}function Wt(t,e){if(1&t&&(f.TgZ(0,"div",33),f.TgZ(1,"div",34),f.YNc(2,Qt,10,1,"div",0),f.YNc(3,Vt,24,13,"div",0),f.qZA(),f.qZA()),2&t){const t=f.oxw();f.xp6(2),f.Q6J("ngIf",t.shopAutorisation),f.xp6(1),f.Q6J("ngIf",!t.shopAutorisation)}}let Xt=(()=>{class t{constructor(t,e,i,o,n,s,r,c,a,l,g,u,p,m,f,v,Z,b,I,C,A,T,x,O,S,q){this.adminService=t,this.modalController=e,this.alertController=i,this.loadingController=o,this.router=n,this.translateConfigService=s,this.offlineManager=r,this.events=c,this.screensizeService=a,this.restApiService=l,this.geofenceService=g,this.urlService=u,this.toastController=p,this.netWorkservice=m,this.httpN=f,this.printer=v,this.platform=Z,this.menu=b,this.notifi=I,this.getStoreName=C,this.actionSheet=A,this.authService=T,this.saveRandom=x,this.cacheService=O,this.manageSocket=S,this.translate=q,this.orders=[],this.tabRoles=[],this.admin=!1,this.manager=!1,this.notification=[],this.lat=0,this.lng=0,this.viewMode="invoices",this.productResto=[],this.shopAutorisation=!1,this.totalItems=0,this.desktopTab=[],this.transaction=[],this.storeName="MAERI",this.serverStatus=new d.X(!1),this.senderId=JSON.parse(localStorage.getItem("user"))._id,this.destroy$=new h.xQ,this.randomId="",this.loadInvoice=!1,this.sub=!0,this.EmployesList=[],this.menu.enable(!0,"first")}ionViewDidEnter(){this.platform.is("android")||this.platform.is("cordova")?(this.scanPrinter(),this.netWorkservice.loaderServer||this.netWorkservice.loadLocalServer()):this.platform.is("desktop")||this.platform.is("mobileweb")?this.printer.webPrinter("texte"):this.platform.is("desktop")||this.platform.is("mobileweb")||this.platform.is("electron"),this.netWorkservice.state||this.netWorkservice.initializeNetworkEvents(),this.screenCheck(),this.getSetting(),this.takeUrl(),this.takeCashOpen(),this.languageChanged(),this.tabRoles=JSON.parse(localStorage.getItem("roles")),JSON.parse(localStorage.getItem("user")).name&&(this.userName=JSON.parse(localStorage.getItem("user")).name),this.tabRoles.includes(1)&&(this.admin=!0),(this.tabRoles.includes(1)||this.tabRoles.includes(4)||this.tabRoles.includes(2))&&(this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId))}ionViewWillEnter(){this.listenEvent();let t=JSON.parse(localStorage.getItem("user")).storeId;t&&this.getStoreName.takeNameById(t).then(t=>this.storeName=t),this.getTransaction()}ngOnInit(){}listenEvent(){this.events.getNewOrder().pipe((0,g.R)(this.destroy$)).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){t?setTimeout(()=>{let t;this.cacheService.getCachedRequest("userCommande").then(e=>{e&&e.length?(setTimeout(()=>{},1500),this.orders=[],t=e,this.useStorageData(t)):this.getOrders()}).catch(t=>{console.log("erorrr"),this.getOrders()})},1e3):setTimeout(()=>{this.getOrders()},1e3)}),t=>{console.log(" erreur ici===>",t),this.getOrders()}),this.events.getInvoiceSale().pipe((0,g.R)(this.destroy$)).subscribe(t=>{}),this.events.getPublishOrder().pipe((0,g.R)(this.destroy$)).subscribe(t=>{t.localId&&setTimeout(()=>{this.orders.findIndex(e=>e.localId===t.localId)>=0||(t.anime=!0,t.anime=!0,t.Posconfirm=!0,t.userName==this.userName&&(t.sender="POS"),this.events.posStoreOrders(t,"update").then(t=>{}))},1e3)}),this.events.getConfirmOrder().pipe((0,g.R)(this.destroy$)).subscribe(t=>{if(t.localId){let e=this.orders.findIndex(e=>e.localId===t.localId);if(e>=0){let t=this.orders[e];t.Posconfirm=!0,t.confirm=!0,this.orders[e].Posconfirm=!0,this.orders[e].confirm=!0,this.orders.splice(e,1,t)}}}),this.events.getInvoiceCancel().pipe((0,g.R)(this.destroy$)).subscribe(t=>{setTimeout(()=>{this.orders.findIndex(e=>e.localId==t.localId)>=0&&(this.orders=this.orders.filter(e=>e.localId!==t.localId))},3e3)}),this.events.getInvoiceCancelUpdate().pipe((0,g.R)(this.destroy$)).subscribe(t=>{setTimeout(()=>{if(t.localId){let e=this.orders.findIndex(e=>e.localId===t.localId);e>=0&&t.commandes&&this.orders.splice(e,1,t)}},3e3)}),this.events.getAddOrder().pipe((0,g.R)(this.destroy$)).subscribe(t=>{t&&setTimeout(()=>(0,c.mG)(this,void 0,void 0,function*(){let e=this.orders.findIndex(e=>e.localId===t);if(e>=0){let i;if(i=this.cacheService.getCachedRequest("userCommande"),i&&i.length){let o=i.findIndex(e=>e.localId===t);if(o>=0){let t=i[o],n=0;t.commandes.forEach(t=>{t.products.forEach(t=>{n+=t.price})}),t.totalPrice=n,this.orders.splice(e,1,t)}}}}),2e3)})}ionViewWillLeave(){this.destroy$.next(),this.destroy$.complete(),this.sockets.disconnect()}ngOnDestroy(){}scanPrinter(){this.printer.scan("hello")}scanIpAddress(t){this.netWorkservice.getInfoHotspot(t)}takeUrl(){this.urlService.getUrl().pipe((0,g.R)(this.destroy$)).subscribe(t=>{this.url=t})}getLocalData(){let t=[];this.offlineManager.getStorageData().pipe((0,g.R)(this.destroy$)).subscribe(e=>{e&&!e.length&&e.commande?this.orders.unshift(e):e&&e.length&&e.forEach(e=>{e.data._id=e.id,t.push(e.data)})})}checkIfOrder(t){this.orders.filter(e=>e._id==t._id).length||this.orders.unshift(t)}takeCashOpen(){let t=JSON.parse(localStorage.getItem("user")).storeId;JSON.parse(localStorage.getItem("openCashDateObj"))&&(this.cashOpened=!0),this.adminService.getOpenCashFromPointOfSale(t).pipe((0,g.R)(this.destroy$)).subscribe(t=>{t.docs.length>0?(this.cashOpened=!0,this.openCashDate=t.docs[0].openDate,this.casgData=t.docs[0],this.openCashDateId=t.docs[0]._id,localStorage.setItem("openCashDateObj",JSON.stringify(t.docs[0])),localStorage.setItem("openCashDateId",t.docs[0]._id),JSON.parse(localStorage.getItem("openCashDateObj")),setTimeout(()=>{},2e3)):(this.cashOpened=!1,this.presentToast("PLEASE OPEN CASH!"))})}languageChanged(){let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}webServerSocket(t){this.sockets=m()(this.url);let e=JSON.parse(localStorage.getItem("user")).storeId;this.sockets.on(`${t}${e}newOrder`,t=>{console.log("new order",t),console.log("storeId==>",e),this.events.posStoreOrders(t,"store").then(()=>{if(this.orders&&this.orders.length){let e=this.orders.findIndex(e=>e.localId==t.localId);e>=0?this.orders.splice(e,1,t):this.orders.unshift(t)}})}),this.sockets.on(`${t}newInvoiceChange`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;t.localId===this.randomId?console.log("rienn==="):this.getOrders(e)}),this.sockets.on(`${t}invoiceadd`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;t.localId===this.randomId?console.log("rienn==="):(this.platform.is("android")||this.platform.is("ios"),this.getOrders(e))}),this.sockets.on(`${t}${e}buyOrder`,t=>{}),this.sockets.on(`${t}${e}deleteOrder`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;this.platform.is("android")||this.platform.is("ios")||(t.localId===this.randomId?console.log("rienn==="):this.getOrders(e))}),this.sockets.on(`${t}${e}invoiceCancel`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;this.platform.is("android")||this.platform.is("ios")||this.getOrders(e)}),this.sockets.on(`${t}serviceConfirmOrder`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;this.platform.is("android")||this.platform.is("ios")||this.getOrders(e)}),this.sockets.on("newBill",t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;t.localId===this.randomId?console.log("rienn==="):this.platform.is("android")||this.platform.is("ios")||this.getOrders(e)}),this.sockets.on(`${t}${e}confirmOrder`,t=>{let e=JSON.parse(localStorage.getItem("openCashDateObj"))._id;this.platform.is("android")||this.platform.is("ios")||this.getOrders(e)}),this.sockets.on("serverconnect",t=>{}),this.sockets.on(`${this.adminId}${e}cashClose`,t=>{this.cashOpened=!1,this.presentToast("CASH IS CLOSE !"),localStorage.removeItem("openCashDateId"),localStorage.removeItem("openCashDateObj"),this.cacheService.cacheRequest("invoicePaie",[]),this.router.navigateByUrl("Login")}),this.sockets.on(`${this.adminId}${e}cashOpen`,t=>{this.takeCashOpen()}),this.sockets.on(`${this.adminId}newSetting`,t=>{this.getSetting()}),this.sockets.on(`${this.adminId}employeAdd`,t=>{this.takeEmployees()}),this.sockets.on(`${t}transactionNewItem`,t=>{this.notifi.presentToast("you have new notification","danger"),this.transaction.unshift(t.data)})}getOrders(t){return(0,c.mG)(this,void 0,void 0,function*(){let t=JSON.parse(localStorage.getItem("user")).storeId,e=JSON.parse(localStorage.getItem("user"))._id,i=this.saveRandom.getCashOpenId(),o=JSON.parse(localStorage.getItem("openCashDateObj"))._id;console.log("prendre les factures ici====>"),this.adminService.getInvoiceNotPaieAdmin2(o).pipe((0,g.R)(this.destroy$)).subscribe(o=>(0,c.mG)(this,void 0,void 0,function*(){if(this.loadInvoice&&(this.notifi.dismissLoading(),this.loadInvoice=!1),o&&o.docs&&i){this.tables=o.docs;let n=o.docs.filter(e=>{if(e.openCashDateId===i&&!1===e.sale&&e.storeId===t||!0===e.partially)return e}),s=JSON.parse(localStorage.getItem("user")).name;n&&n.length&&n.forEach(t=>{let i=0;if(t.commandes.forEach(t=>{t.products.forEach(t=>{i+=t.price})}),t.totalPrice=i,t.userName!=s&&t.senderId!=e||(t.Posconfirm=!0,t.confirm=!0),t&&1==t.Posconfirm){let e=this.orders.findIndex(e=>e.localId==t.localId);e>=0?t.invoiceCancel?this.orders.splice(e,1):this.orders.splice(e,1,t):t.invoiceCancel||this.orders.push(t)}}),this.orders=this.orders.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),this.orders.forEach(t=>{console.log(t),t.trancheList&&t.trancheList.length&&(t.recu=0,t.trancheList.forEach(e=>{t.recu=t.recu+e.montant}))}),this.notification=n.filter(e=>{if(0==e.confirm&&0==e.Posconfirm&&e.storeId===t&&!1===e.invoiceCancel)return e}),this.desktopTab=this.notification;let r=yield this.cacheService.getCachedRequest("invoicePaie");this.cacheService.getCachedRequest("userCommande").then(t=>{t&&t.length?(n.forEach(e=>{let i=t.findIndex(t=>t.localId==e.localId);r&&r.length&&r.findIndex(t=>t.localId==e.localId)>=0||(i>=0?t.splice(i,1,e):t.push(e))}),t=t.filter(t=>!1===t.invoiceCancel),this.cacheService.cacheRequest("userCommande",t)):(n=n.filter(t=>!1===t.invoiceCancel),this.cacheService.cacheRequest("userCommande",n))})}}),t=>{})})}print(t){}buyPack(t){this.adminService.buyOrder(t._id).pipe((0,g.R)(this.destroy$)).subscribe(e=>{this.orders=this.orders.filter(e=>e._id!==t._id)},t=>{})}viewMobileManageOrder(t){return(0,c.mG)(this,void 0,void 0,function*(){let e={};this.translate.get("MENU.displayInvoice").subscribe(t=>{e.displayInvoice=t}),this.translate.get("MENU.cancel").subscribe(t=>{e.cancel=t}),t.Posconfirm=!0;const i=yield this.actionSheet.create({buttons:[{text:e.displayInvoice+"?",role:"destructive",icon:"eye",handler:()=>{console.log("Delete clicked"),this.displayDetails(t)}},{text:e.cancel,icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield i.present(),yield i.onDidDismiss()})}displayDetails(t){return(0,c.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:a.k,componentProps:{order:t,order2:t,Pos:!1},backdropDismiss:!1});return e.onDidDismiss().then(e=>(0,c.mG)(this,void 0,void 0,function*(){if("cancel invoice"===e.data&&setTimeout(()=>(0,c.mG)(this,void 0,void 0,function*(){let e;e=yield this.cacheService.getCachedRequest("userCommande"),e&&e.length?(this.orders=e.filter(e=>e.localId!==t.localId),this.orders=this.orders.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1)):this.orders=[]}),1e3),"no_update"!==e.data&&("ok ok"===e.data.status&&(this.randomId=t.localId,this.restoreData(t)),"partially paie"===e.data)){let e,i=this.orders.findIndex(e=>e.localId===t.localId);if(i>=0&&this.orders.splice(i,1,t),e=yield this.cacheService.getCachedRequest("userCommande"),e&&e.length){e.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e});let i=e.findIndex(e=>e.localId===t.localId);i>=0&&(e.splice(i,1,t),this.cacheService.cacheRequest("userCommande",e))}}})),yield e.present()})}restoreData(t){let e=JSON.parse(localStorage.getItem("user")).storeId;setTimeout(()=>(0,c.mG)(this,void 0,void 0,function*(){let i;i=yield this.cacheService.getCachedRequest("userCommande"),i&&i.length?(i.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e}),this.orders=i.filter(i=>i.localId!==t.localId&&i.storeId===e&&0!=i.Posconfirm),this.orders=this.orders.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1)):this.orders=[]}),1500)}confirmOrders(t){this.adminService.buyConfirmOder(t.target.value).subscribe(e=>{this.orders.unshift(e.resultat),this.notification=this.notification.filter(e=>e._id!==t.target.value)},t=>{console.log(t)})}presentModal(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.modalController.create({component:l.n,componentProps:{data:this.notification}});return t.onDidDismiss().then(t=>{t.data.order&&this.displayCounter(t.data.order)}),yield t.present()})}displayCounter(t){t.Posconfirm=!0,t.userName==this.userName&&(t.sender="POS",t.confirm=!0),this.orders.unshift(t);let e=[];e=JSON.parse(localStorage.getItem("userCommande")),e&&e.length&&(e.forEach(e=>{e.localId===t.localId&&(e.Posconfirm=!0)}),this.cacheService.cacheRequest("userCommande",e)),this.adminService.buyConfirmOder(t.localId,t).subscribe(t=>{},t=>{console.log(t)})}getSetting(){setTimeout(()=>{this.adminService.getCompanySetting().pipe((0,g.R)(this.destroy$)).subscribe(t=>{let e=t.company[0];e.logo&&(this.printer.download(e.logo),this.platform.is("electron"))&&e.logo.split("/").pop().split("?").shift(),e.use_wifi&&this.platform.is("android")&&this.scanIpAddress(t),e.employePercentPrice&&this.takeEmployees(),t.company.length&&(this.lat=e.latitude,this.lng=e.longitude,this.ip=e.ip,e.name?localStorage.setItem("company",e.name):localStorage.setItem("company","Maeri"),this.saveRandom.setSetting(e),localStorage.setItem("setting",JSON.stringify(e)),this.events.publishSetting(e),this.platform.is("android"))})},2e3)}screenCheck(){setTimeout(()=>{this.screensizeService.isDesktopView().pipe((0,g.R)(this.destroy$)).subscribe(t=>{this.isDesktop=t})},10)}displayService(){this.shopAutorisation=!this.shopAutorisation}displayCart(t){this.totalItems=t}takeTransaction(){setTimeout(()=>{this.adminService.getTransactionNotconfirm().pipe((0,g.R)(this.destroy$)).subscribe(t=>{this.transaction=t.docs}),this.restApiService.getProvision().pipe((0,g.R)(this.destroy$)).subscribe(t=>{})},5e3)}presentAlertConfirm(){return(0,c.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:"vous avez re\xe7u un nouveau stock de produit!.",duration:6e3})).present()})}postCashOpen(){return(0,c.mG)(this,void 0,void 0,function*(){let t=JSON.parse(localStorage.getItem("user")).storeId;const e=yield this.alertController.create({header:"CASH OPEN",inputs:[{name:"cashFund",type:"number"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"alertCancel",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",cssClass:"alertButton",handler:e=>{e&&(this.notifi.presentLoading(),e.storeId=t,this.adminService.postCashOpen(e).pipe((0,g.R)(this.destroy$)).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){this.takeCashOpen(),this.cashOpened=!1,localStorage.setItem("openCashDate",t.message.openDate),localStorage.setItem("numFacture",null),this.notifi.dismissLoading(),this.presentToast("CASH IS OPEN!")})))}}]});yield e.present()})}closeCash(t){this.adminService.closeCashOpenPos(this.casgData).pipe((0,g.R)(this.destroy$)).subscribe(t=>{this.cashOpened=!1,localStorage.getItem("openCashDateObj"),this.cacheService.cacheRequest("invoicePaie",[]),setTimeout(()=>{localStorage.removeItem("openCashDate")},2e3),this.router.navigateByUrl("Login")},t=>{this.notifi.presentToast("impossible de fermer la caisse car impossible de joindre le serveur distant","danger")})}presentToast(t){return(0,c.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:`${t}`,duration:2e3,position:"top",animated:!0})).present()})}presentAlertPrompt(){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({cssClass:"closeCash",message:`open: ${this.casgData.cashFund}`,inputs:[{name:"closing_cash",type:"number",placeholder:"closing cash"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:t=>{parseInt(t.cashFund)&&(t.cashFund=parseInt(t.cashFund)),t.closing_cash=parseInt(t.closing_cash)?parseInt(t.closing_cash):0,this.casgData.closing_cash=parseInt(t.closing_cash),this.closeCash(t)}}]});yield t.present()})}useStorageData(t,e){return(0,c.mG)(this,void 0,void 0,function*(){let e=JSON.parse(localStorage.getItem("user")).storeId;this.tables=t;let i=[],o=[],n=JSON.parse(localStorage.getItem("user")).name;t&&t.length&&t.forEach(t=>{t.storeId===e&&(t.userName==n&&(t.Posconfirm=!0),o.push(t))}),o=o.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),o&&o.length?(o.forEach(t=>{this.orders.findIndex(t=>{})>=0||this.orders.unshift(t)}),this.orders.forEach(t=>{console.log(t),t.trancheList&&t.trancheList.length&&(t.recu=0,t.trancheList.forEach(e=>{t.recu=t.recu+e.montant}))})):(o=o.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),o.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e})),this.orders=o,this.orders.forEach(t=>{console.log(t),t.trancheList&&t.trancheList.length&&(t.recu=0,t.trancheList.forEach(e=>{t.recu=t.recu+e.montant}))}),i=t.filter(t=>0==t.confirm&&0==t.Posconfirm),i&&i.length&&(this.notification=i),this.desktopTab=this.notification})}pickRetailer(){return(0,c.mG)(this,void 0,void 0,function*(){this.authService.getEmployees().pipe((0,g.R)(this.destroy$)).subscribe(t=>(0,c.mG)(this,void 0,void 0,function*(){let e=t.employes;if(e=e.filter(t=>t.isRetailer),e.length>0){const t=yield this.modalController.create({component:u.L,backdropDismiss:!1,componentProps:{retailerList:e}});return t.onWillDismiss().then(t=>(0,c.mG)(this,void 0,void 0,function*(){if(console.log(t),t.data.retailer){let e=t.data.retailer,i=e.productsToSale;i&&i.length?(this.saveRandom.confirmIfIsRetailer(),this.saveRandom.setRetailer(e),localStorage.setItem("backTo",JSON.stringify({url:"point-of-sale"})),this.router.navigateByUrl("/shop")):this.notifi.presentError("this employe not have products please provide some before","danger")}})),yield t.present()}this.notifi.presentError("please provide your retailer before","danger")}))})}displayCustomers(){this.router.navigateByUrl("/store-customer")}getLocalInvoice(){return(0,c.mG)(this,void 0,void 0,function*(){let t,e=JSON.parse(localStorage.getItem("user")).storeId,i=JSON.parse(localStorage.getItem("user"))._id;this.cacheService.getCachedRequest("userCommande").then(o=>{if(t=o,t&&t.length&&Array.isArray(t)){this.tables=t;let o=t.filter(t=>{if(!1===t.sale&&t.storeId===e&&!1===t.invoiceCancel)return t}),n=JSON.parse(localStorage.getItem("user")).name;o.length&&o.forEach(t=>{let e=0;t.commandes.forEach(t=>{t.products.forEach(t=>{e+=t.price})}),t.totalPrice=e,t.userName!=n&&t.senderId!=i||(t.Posconfirm=!0,t.confirm=!0)}),this.orders=[],this.orders=this.orders.concat(o),this.orders=this.orders.sort((t,e)=>new Date(t.created).getTime()-new Date(e.created).getTime()>0?-1:1),this.notification=this.orders.filter(t=>{if(0==t.confirm&&0==t.Posconfirm&&t.storeId===e)return t}),this.orders=this.orders.filter(t=>{if(1==t.Posconfirm)return t}),this.desktopTab=this.notification}}).catch(t=>{console.log("erreur dect\xe9 ici pos",t),this.loadInvoice=!0,this.notifi.presentLoading()})})}takeEmployees(){this.authService.getEmployees().subscribe(t=>{this.EmployesList=t.employes,this.EmployesList=this.EmployesList.sort((t,e)=>t.name>e.name?1:-1),this.saveRandom.setEmployeList(this.EmployesList)})}showNotification(){}getTransaction(){let t=2;t=this.tabRoles.includes(2)?2:0,this.adminService.getStoreMballusTransaction(this.saveRandom.getStoreId(),t).pipe((0,g.R)(this.destroy$)).subscribe(t=>{console.log("trasaction",t.docs),this.transaction=t.docs,this.transaction.length&&this.notifi.presentToast("you have new notification","danger")})}}return t.\u0275fac=function(e){return new(e||t)(f.Y36(v.l),f.Y36(r.IN),f.Y36(r.Br),f.Y36(r.HT),f.Y36(s.F0),f.Y36(Z.w),f.Y36(b.J),f.Y36(I.t),f.Y36(C.j),f.Y36(A.e),f.Y36(T),f.Y36(x.i),f.Y36(r.yF),f.Y36(O.S),f.Y36(S.t),f.Y36(q.v),f.Y36(r.t4),f.Y36(r._q),f.Y36(_.g),f.Y36(P.$),f.Y36(r.BX),f.Y36(y.u),f.Y36(k.i),f.Y36(w.$),f.Y36(N.W),f.Y36(M.sK))},t.\u0275cmp=f.Xpm({type:t,selectors:[["app-point-of-sale"]],decls:3,vars:3,consts:[[4,"ngIf"],["class","ion-no-padding",4,"ngIf"],["class","desktop",4,"ngIf"],["slot","end"],["id","notification-button",1,"btn-toolbar",3,"disabled","click"],["name","notifications-outline"],["id","notifications-badge","color","danger"],["size","small",1,"btn-toolbar"],["class","btn-mobile btn-toolbar","fill","outline",3,"click",4,"ngIf"],["slot","start"],["autoHide","false"],["id","pos-button","size","small",1,"btn-toolbar"],["fill","outline",1,"btn-mobile","btn-toolbar",3,"click"],[1,"ion-no-padding"],["class","customgrid",4,"ngIf"],["class","ion-no-padding","style","margin-top: 5px",4,"ngIf"],[1,"customgrid"],["class","ion-align-items-center",4,"ngIf"],[1,"ion-align-items-center"],[1,"ion-align-self-center"],[1,"ion-text-center","ion-text-uppercase",2,"font-weight","bold","font-size","13px"],[1,"ion-no-padding",2,"margin-top","5px"],[1,"ion-text-center","ion-text-uppercase",2,"font-weight","bold"],["class","row-orders",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"ion-text-center"],[1,"row-orders",3,"ngStyle","click"],[1,"ion-text-center","ion-text-uppercase"],[2,"font-weight","bold"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap"],["color","danger","name","checkmark-circle-outline",4,"ngIf"],["color","success","name","checkmark-circle-outline",4,"ngIf"],["color","danger","name","checkmark-circle-outline"],["color","success","name","checkmark-circle-outline"],[1,"desktop"],[1,"content"],["mode","ios"],["color","primary"],["fill","clear",1,"link",3,"click"],["class","flex-container",4,"ngIf"],[1,"flex-container"],[1,"div1"],[3,"valueChange"],[1,"div2"],[1,"toolbarInt"],["size","10",1,"col"],["fill","clear",3,"click"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["lines","full",3,"click",4,"ngFor","ngForOf"],["lines","full",3,"click"],[1,"iconStart"],["color","success","name","cash",1,"iconDollars"],[1,"a1"],[1,"a2"],["class","btnStatus",4,"ngIf"],["class","tableNumber2 btnStatus",4,"ngIf"],[1,"btnStatus"],[1,"tableNumber2","btnStatus"],[3,"notifications","valueChange"],["color","danger","autoHide","false",4,"ngIf"],["fill","outline","class","link",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["color","light","fill","outline",3,"click"],["slot","end","name","people-outline"],["name","document-text-outline"],["color","light","fill","outline",3,"click",4,"ngIf"],[1,"div3"],[3,"orders","sendOrder"],[1,"div4"],["color","danger","autoHide","false"],["fill","outline",1,"link",3,"click"],[3,"click"]],template:function(t,e){1&t&&(f.YNc(0,qt,16,8,"ion-header",0),f.YNc(1,Ut,3,2,"ion-content",1),f.YNc(2,Wt,4,2,"div",2)),2&t&&(f.Q6J("ngIf",!e.isDesktop),f.xp6(1),f.Q6J("ngIf",!e.isDesktop),f.xp6(1),f.Q6J("ngIf",e.isDesktop))},directives:[o.O5,r.Gu,r.sr,r.Sm,r.YG,r.gu,r.yp,r.fG,r.W2,r.jY,r.Nd,r.wI,o.sg,o.PC,X,o.RF,o.n9,o.ED,r.q_,r.yh,r.Q$,r.Ie,Zt,xt],pipes:[M.X$,o.uU,o.H9],styles:["p[_ngcontent-%COMP%]{margin:0;padding:0}.orders[_ngcontent-%COMP%]{background-color:#f1f1f1;width:100%}.iconprint[_ngcontent-%COMP%]{margin-left:15px}.tableNumber[_ngcontent-%COMP%]{font-size:9px;position:absolute;left:48%;bottom:52%;color:#1d72f3}.btnStatus[_ngcontent-%COMP%]{position:absolute;left:90%;bottom:30px}a[_ngcontent-%COMP%]{margin-right:5px;text-transform:uppercase}.badge[_ngcontent-%COMP%]{left:50%}.badge[_ngcontent-%COMP%], .iconN[_ngcontent-%COMP%]{position:relative}.iconN[_ngcontent-%COMP%]{right:16%;bottom:5%}.header-rowpos[_ngcontent-%COMP%]{font-weight:700;border-bottom:2px solid #000;background-color:#000;color:#fff;padding-top:7px;padding-bottom:7px}.header-rowpos[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{text-transform:uppercase;font-size:11px}.iconDollars[_ngcontent-%COMP%]{position:relative;bottom:10px;left:10px}.iconStart[_ngcontent-%COMP%]{margin-right:10%}.a1[_ngcontent-%COMP%]{font-size:10px;margin-left:10px}.a2[_ngcontent-%COMP%]{font-size:8px;color:#4e4ef8}.desktop[_ngcontent-%COMP%]   ion-router-outlet[_ngcontent-%COMP%]{margin-bottom:56px;height:100%}.desktop[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{max-height:30px}.desktop[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:#374168}.desktop[_ngcontent-%COMP%]   .toolbarInt[_ngcontent-%COMP%]{--background:#fff;margin:0;position:relative;bottom:10px}.desktop[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{--color:var(--ion-color-light)}.desktop[_ngcontent-%COMP%]   .active-link[_ngcontent-%COMP%]{--color:var(--ion-color-primary)}.desktop[_ngcontent-%COMP%]   .flex-container[_ngcontent-%COMP%]{display:flex}.desktop[_ngcontent-%COMP%]   .flex-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:10px;padding:20px;font-size:30px}.desktop[_ngcontent-%COMP%]   .div1[_ngcontent-%COMP%]{width:70%}.desktop[_ngcontent-%COMP%]   .div1[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]   .div2[_ngcontent-%COMP%]{max-height:700px;overflow:scroll}.desktop[_ngcontent-%COMP%]   .div2[_ngcontent-%COMP%]{width:30%}.desktop[_ngcontent-%COMP%]   .div3[_ngcontent-%COMP%]{width:70%}.desktop[_ngcontent-%COMP%]   .div3[_ngcontent-%COMP%], .desktop[_ngcontent-%COMP%]   .div4[_ngcontent-%COMP%]{height:1000px;overflow:scroll;padding-bottom:20px}.desktop[_ngcontent-%COMP%]   .div4[_ngcontent-%COMP%]{width:50%}.desktop[_ngcontent-%COMP%]   .navbar[_ngcontent-%COMP%]{background:#e61f05}.footer[_ngcontent-%COMP%]{width:100%;color:#fff;font-weight:700;height:200px;line-height:56px;text-align:center;position:fixed;bottom:0}[_ngcontent-%COMP%]::-webkit-scrollbar{height:4px;width:4px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#888}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#555}@media only screen and (min-width:500px){.col[_ngcontent-%COMP%]{display:flex}.col[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{font-size:9px;--margin-top:0px;--margin-bottom:0px}}@media (max-width:327px){ion-title[_ngcontent-%COMP%]{font-size:8px}}@media (max-width:567px){ion-header[_ngcontent-%COMP%]{height:10%}ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:linear-gradient(162deg,#28292c33 20%,#28292c33),url(icon.7c8beb863bffb85b8c09.png) no-repeat center /100%;height:100%}ion-content[_ngcontent-%COMP%]{--padding-top:0px}#pos-button[_ngcontent-%COMP%], div[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-size:9px}div[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{font-weight:700}div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%], div[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{text-transform:uppercase}div[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:12px}.btn-mobile[_ngcontent-%COMP%]{width:85px;font-size:9px}.btn-toolbar[_ngcontent-%COMP%]{color:var(--ion-color-light);font-weight:700}.customgrid[_ngcontent-%COMP%], .customgrid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:first-child{height:100%}ion-grid[_ngcontent-%COMP%]{border-collapse:collapse;border-style:hidden}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:nth-child(2){background-color:#2dd36f;margin-top:20px}ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:nth-child(2), ion-grid[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]:nth-child(n+3){font-weight:700;padding-top:10px;padding-bottom:5px;height:6%}ion-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border-bottom:0;border-right:0}ion-grid[_ngcontent-%COMP%]   .row-orders[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{--ion-grid-column-padding:0px}}"]}),t})();var Kt=i(9547);const te=[{path:"",component:Xt}];let ee=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=f.oAB({type:t}),t.\u0275inj=f.cJS({imports:[[o.ez,n.u5,r.Pc,s.Bz.forChild(te),M.aw.forChild(),Kt.G,Y.On]]}),t})()},4418:(t,e,i)=>{"use strict";i.d(e,{W:()=>a});var o=i(1344),n=i.n(o),s=i(8512),r=i(1572),c=i(2968);let a=(()=>{class t{constructor(t){this.urlService=t,this.mysocket=new s.X(null),this.sock=!1,this.takeUrl()}takeUrl(){console.log("je demmare ici url"),this.urlService.getUrl().subscribe(t=>{this.url=t,this.adminId=localStorage.getItem("adminId"),this.sockets=n()(this.url),this.mysocket.next(this.sockets)})}getSocket(){return this.mysocket}disconnectSocket(){this.sockets.disconnect()}getMySocket(){return this.sockets}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(c.i))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);