(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[7290],{7290:(t,e,i)=>{"use strict";i.r(e),i.d(e,{RavitaillementPageModule:()=>D});var o=i(1511),s=i(6073),r=i(8777),n=i(8158),a=i(4762),c=i(1344),l=i.n(c),u=i(1572),d=i(4144),h=i(731),m=i(866),g=i(1064),p=i(5946),S=i(2968),f=i(9719),b=i(1044),I=i(1611),y=i(8710),q=i(4069),v=i(4375),Z=i(2874),A=i(754),T=i(1326);function x(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-button",2),u.NdJ("click",function(){return u.CHM(t),u.oxw().goToRefueling()}),u._uU(1),u.ALo(2,"translate"),u.qZA()}2&t&&(u.xp6(1),u.hij(" ",u.lcZ(2,1,"MENU.refueling")," "))}function N(t,e){1&t&&u._UZ(0,"ion-back-button",11)}function k(t,e){1&t&&u._UZ(0,"ion-back-button",12)}function _(t,e){1&t&&u._UZ(0,"ion-back-button",13)}function C(t,e){if(1&t&&(u.TgZ(0,"ion-segment-button",16),u._uU(1),u.qZA()),2&t){const t=e.$implicit;u.s9C("value",t),u.xp6(1),u.hij(" ",t," ")}}function R(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-segment",14),u.NdJ("ionChange",function(e){return u.CHM(t),u.oxw().segmentChanged(e)})("ngModelChange",function(e){return u.CHM(t),u.oxw().pet=e}),u.YNc(1,C,2,2,"ion-segment-button",15),u.qZA()}if(2&t){const t=u.oxw();u.s9C("value",t.pet),u.Q6J("ngModel",t.pet),u.xp6(1),u.Q6J("ngForOf",t.storeTypeTab)}}function P(t,e){if(1&t&&(u.TgZ(0,"small",29),u._uU(1),u.qZA()),2&t){const t=u.oxw().$implicit;u.xp6(1),u.hij("waiting ...",t.quantityToConfirm,"")}}const w=function(t){return{"stock-alert":t}};function L(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-item",22),u.TgZ(1,"ion-avatar",5),u._UZ(2,"img",23),u.qZA(),u.TgZ(3,"ion-button",24),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit,o=u.oxw().index;return u.oxw(2).updateStore(i,o)}),u._uU(4),u.ALo(5,"translate"),u.qZA(),u.TgZ(6,"ion-button",25),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit;return u.oxw(3).presentActionSheet(i)}),u._uU(7,"Reset"),u.qZA(),u.TgZ(8,"ion-label"),u.TgZ(9,"h3"),u._uU(10),u.qZA(),u.YNc(11,P,2,1,"small",26),u.TgZ(12,"small",27),u._uU(13),u.ALo(14,"translate"),u.qZA(),u.TgZ(15,"small",28),u._uU(16),u.ALo(17,"translate"),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit;u.Q6J("ngClass",u.VKq(17,w,t.quantityItems<=t.quantityToAlert)),u.xp6(2),u.s9C("src",t.url,u.LSH),u.xp6(2),u.Oqu(u.lcZ(5,11,"MENU.update_store")),u.xp6(6),u.Oqu(t.name),u.xp6(1),u.Q6J("ngIf",t.quantityToConfirm),u.xp6(2),u.lnq(" ",u.lcZ(14,13,"MENU.in_stock"),": ",t.cassier?t.cassier:0," cassier ",t.btls?t.btls:0," btl"),u.xp6(3),u.lnq(" ",u.lcZ(17,15,"MENU.in_store"),": ",t.cassierStore?t.cassierStore:0," cassier ",t.btlsStore?t.btlsStore:0," btl ")}}function U(t,e){if(1&t&&(u.TgZ(0,"ion-slide"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u.TgZ(4,"div",19),u.TgZ(5,"h4"),u._uU(6),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"div",20),u.TgZ(8,"ion-list"),u.YNc(9,L,18,19,"ion-item",21),u.qZA(),u.qZA(),u.qZA(),u.qZA()),2&t){const t=e.$implicit;u.xp6(6),u.hij("store ",t.storeName,""),u.xp6(3),u.Q6J("ngForOf",t)}}function O(t,e){if(1&t&&(u.TgZ(0,"ion-slides",17),u.YNc(1,U,10,2,"ion-slide",18),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngForOf",t.multiStoreProductitem)}}function $(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-item",30),u.TgZ(1,"ion-button",25),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit;return u.oxw(3).updateStoreResto(i)}),u._uU(2),u.ALo(3,"translate"),u.qZA(),u.TgZ(4,"ion-label"),u.TgZ(5,"p",27),u._uU(6),u.ALo(7,"translate"),u.qZA(),u.TgZ(8,"p",28),u._uU(9),u.ALo(10,"translate"),u.qZA(),u.qZA(),u.TgZ(11,"ion-label"),u.TgZ(12,"small"),u._uU(13),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit;u.xp6(2),u.Oqu(u.lcZ(3,6,"MENU.update_store")),u.xp6(4),u.AsE(" ",u.lcZ(7,8,"MENU.in_stock"),": ",t.quantityItems," "),u.xp6(3),u.AsE(" ",u.lcZ(10,10,"MENU.in_store"),": ",t.quantityStore," "),u.xp6(4),u.Oqu(t.name)}}function J(t,e){if(1&t&&(u.TgZ(0,"ion-slide"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u.TgZ(4,"div",19),u.TgZ(5,"h4"),u._uU(6),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"ion-list",30),u.YNc(8,$,14,12,"ion-item",31),u.qZA(),u.qZA(),u.qZA()),2&t){const t=e.$implicit;u.xp6(6),u.hij("store ",t.storeName,""),u.xp6(2),u.Q6J("ngForOf",t)}}function M(t,e){if(1&t&&(u.TgZ(0,"ion-slides",17),u.YNc(1,J,9,2,"ion-slide",18),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngForOf",t.multiStoreResourceitem)}}function F(t,e){if(1&t&&(u.TgZ(0,"p",27),u._uU(1),u.qZA()),2&t){const t=u.oxw().$implicit;u.xp6(1),u.hij(" pleine: ",t.bottle_full?t.bottle_full:0," ")}}function Y(t,e){if(1&t&&(u.TgZ(0,"p",27),u._uU(1),u.qZA()),2&t){const t=u.oxw().$implicit;u.xp6(1),u.hij(" vide: ",t.bottle_empty?t.bottle_empty:0," ")}}function E(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-item",22),u.TgZ(1,"ion-button",25),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit,o=e.index,s=u.oxw().index;return u.oxw(2).updateShopList(i,s,o)}),u._uU(2),u.ALo(3,"translate"),u.qZA(),u.TgZ(4,"ion-label"),u.TgZ(5,"p",27),u._uU(6),u.ALo(7,"translate"),u.qZA(),u.TgZ(8,"p",28),u._uU(9),u.ALo(10,"translate"),u.qZA(),u.YNc(11,F,2,1,"p",32),u.YNc(12,Y,2,1,"p",32),u.qZA(),u.TgZ(13,"ion-label"),u.TgZ(14,"small"),u._uU(15),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit,i=u.oxw(3);u.Q6J("ngClass",u.VKq(15,w,t.quantityStore<=t.quantityToAlert)),u.xp6(2),u.Oqu(u.lcZ(3,9,"MENU.update_store")),u.xp6(4),u.AsE(" ",u.lcZ(7,11,"MENU.in_stock"),": ",t.quantityItems," "),u.xp6(3),u.AsE(" ",u.lcZ(10,13,"MENU.in_store"),": ",t.quantityStore," "),u.xp6(2),u.Q6J("ngIf",i.saveRandom.getSetting().sale_Gaz),u.xp6(1),u.Q6J("ngIf",i.saveRandom.getSetting().sale_Gaz),u.xp6(3),u.Oqu(t.name)}}function G(t,e){if(1&t&&(u.TgZ(0,"ion-slide"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u.TgZ(4,"div",19),u.TgZ(5,"h4"),u._uU(6),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"ion-list",30),u.YNc(8,E,16,17,"ion-item",21),u.qZA(),u.qZA(),u.qZA()),2&t){const t=e.$implicit;u.xp6(6),u.hij("store ",t.storeName,""),u.xp6(2),u.Q6J("ngForOf",t)}}function z(t,e){if(1&t&&(u.TgZ(0,"ion-slides",17),u.YNc(1,G,9,2,"ion-slide",18),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngForOf",t.multiStoreList)}}function Q(t,e){if(1&t){const t=u.EpF();u.TgZ(0,"ion-item",22),u.TgZ(1,"ion-avatar",5),u._UZ(2,"img",23),u.qZA(),u.TgZ(3,"ion-button",25),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit;return u.oxw(3).presentActionSheet3(i)}),u._uU(4,"Reset"),u.qZA(),u.TgZ(5,"ion-button",24),u.NdJ("click",function(){u.CHM(t);const i=e.$implicit,o=e.index,s=u.oxw().index;return u.oxw(2).updateServicesList(i,s,o)}),u._uU(6),u.ALo(7,"translate"),u.qZA(),u.TgZ(8,"ion-label"),u.TgZ(9,"h3"),u._uU(10),u.qZA(),u.TgZ(11,"small",27),u._uU(12),u.ALo(13,"translate"),u.qZA(),u.TgZ(14,"small",28),u._uU(15),u.ALo(16,"translate"),u.qZA(),u.qZA(),u.qZA()}if(2&t){const t=e.$implicit;u.Q6J("ngClass",u.VKq(14,w,t.quantityStore<=t.quantityToAlert)),u.xp6(2),u.s9C("src",t.url,u.LSH),u.xp6(4),u.Oqu(u.lcZ(7,8,"MENU.update_store")),u.xp6(4),u.Oqu(t.name),u.xp6(2),u.AsE(" ",u.lcZ(13,10,"MENU.in_stock"),": ",t.quantityItems,""),u.xp6(3),u.AsE(" ",u.lcZ(16,12,"MENU.in_store"),": ",t.quantityStore," ")}}function B(t,e){if(1&t&&(u.TgZ(0,"ion-slide"),u.TgZ(1,"ion-grid"),u.TgZ(2,"ion-row"),u.TgZ(3,"ion-col"),u.TgZ(4,"div",19),u.TgZ(5,"h4"),u._uU(6),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"ion-list"),u.YNc(8,Q,17,16,"ion-item",21),u.qZA(),u.qZA(),u.qZA()),2&t){const t=e.$implicit;u.xp6(6),u.hij("store ",t.storeName,""),u.xp6(2),u.Q6J("ngForOf",t)}}function H(t,e){if(1&t&&(u.TgZ(0,"ion-slides",17),u.YNc(1,B,9,2,"ion-slide",18),u.qZA()),2&t){const t=u.oxw();u.xp6(1),u.Q6J("ngForOf",t.multiStoreService)}}const j=[{path:"",component:(()=>{class t{constructor(t,e,i,o,s,r,n,a,c,l,u,d,h,m,g,p,S,f,b,I,y,q){this.restApiService=t,this.modalController=e,this.alertController=i,this.actionSheetController=o,this.toastController=s,this.router=r,this.translateConfigService=n,this.warehouseService=a,this.warehouService=c,this.translate=l,this.adminService=u,this.urlService=d,this.getStoreName=h,this.rangeByStoreService=m,this.resourceService=g,this.shoplistService=p,this.servicelistService=S,this.saveRandom=f,this.notifi=b,this.ficheService=I,this.electronService=y,this.plt=q,this.tabRoles=[],this.num=2,this.btnProducts=!0,this.btnResto=!1,this.btnResource=!1,this.lat=0,this.lng=0,this.viewMode="invoices",this.shopAutorisation=!1,this.totalItems=0,this.desktopTab=[],this.transaction=[],this.manageStockWithService=!1,this.vendorRole=!1,this.multiStore=!1,this.multiStoreProductitem=[],this.warehousman=!1,this.resourceItem=[],this.storeTypeTab=[],this.afficheResource=!1,this.storeProductArray=[],this.useRefueling=!1,this.firstTime=!1,this.isOpen=!0,this.confirm=!1,this.productsServices=[],JSON.parse(localStorage.getItem("user"))[0]&&JSON.parse(localStorage.getItem("user"))[0].venderRole&&(this.vendorRole=JSON.parse(localStorage.getItem("user"))[0].venderRole),"true"===localStorage.getItem("manageStockWithService")&&(this.manageStockWithService=!0),JSON.parse(localStorage.getItem("user")).name&&(this.userName=JSON.parse(localStorage.getItem("user")).name),this.tabRoles=JSON.parse(localStorage.getItem("roles")),(this.tabRoles.includes(1)||this.tabRoles.includes(3)||this.tabRoles.includes(2)||this.tabRoles.includes(6))&&(setTimeout(()=>{}),setTimeout(()=>{this.takeProductResto()},2e3)),this.tabRoles.includes(3)&&(this.warehousman=!0),this.languageChanged()}ionViewWillEnter(){this.setting=this.saveRandom.getSetting(),this.takeUrl(),this.getSetting();let t=JSON.parse(localStorage.getItem("adminUser")).storeType;this.storeTypeTab=this.setting.check_service_quantity?t:t.filter(t=>"services"!==t),this.pet=this.storeTypeTab[0],this.pet=this.storeTypeTab[0]}ngOnInit(){}takeUrl(){this.urlService.getUrl().subscribe(t=>{console.log("url ici===",t),this.url=t,this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId,t)})}languageChanged(){console.log("lang shop page");let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}takeProductItems(){this.restApiService.getProductItem().subscribe(t=>{if(this.segmentChangedEnter(),t=t.filter(t=>null!==t.productId),JSON.parse(localStorage.getItem("setting")),this.tabRoles.includes(3)||this.tabRoles.includes(2)){let e=JSON.parse(localStorage.getItem("user")).storeId;const i=t.filter(t=>t.storeId==e&&0==t.resourceList.length);this.productsItem=i}else this.productsItem=t.filter(t=>0==t.resourceList.length&&null!==t.productId);this.productsItem.forEach(t=>(0,a.mG)(this,void 0,void 0,function*(){if(t.quantityToConfirm>0){let e=(t.quantityStore+t.quantityToConfirm)/t.packSize;t.cassier=parseInt((t.quantityItems/t.packSize).toString()),t.btls=t.quantityItems%t.packSize,t.cassierStore=parseInt(e.toString()),Number.isInteger(t.btls)||(t.btls=t.btls.toFixed(2)),t.btlsStore=1}else{let e=t.quantityStore/t.packSize;t.cassier=parseInt((t.quantityItems/t.packSize).toString()),t.btls=t.quantityItems%t.packSize,t.cassierStore=parseInt(e.toString()),t.btlsStore=t.quantityStore%t.packSize,Number.isInteger(t.btls)||(t.btls=t.btls.toFixed(2)),Number.isInteger(t.btlsStore)||(t.btlsStore=parseFloat(t.btlsStore).toFixed(2))}}));let e=this.productsItem.reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{});this.multiStoreProductitem=[],console.log(e);for(const i in e)this.multiStoreProductitem.push(e[i]);this.multiStoreProductitem.forEach(t=>(0,a.mG)(this,void 0,void 0,function*(){let e=yield this.getStoreName.takeName(t);t.storeName=e}))})}webServerSocket(t,e){console.log("start",this.url),this.sockets=l()(e),this.sockets.on("connect",function(){console.log("je suis connect\xe9 socket",e)});let i=this.saveRandom.getStoreId();console.log("storeId",i),this.sockets.on(`${t}productItem`,t=>{if(console.log("socket io",t),t.quantityToConfirm>0){let e=t.quantityStore+t.quantityToConfirm,i=e/t.packSize;t.cassier=parseInt((t.quantityItems/t.packSize).toString()),t.btls=t.quantityItems%t.packSize,t.cassierStore=parseInt(i.toString()),t.btlsStore=e%t.packSize,Number.isInteger(t.btls)||(t.btls=t.btls.toFixed(2)),Number.isInteger(t.btlsStore)||(t.btlsStore=t.btlsStore.toFixed(2))}else if(t.quantityItems||t.quantityStore){let e=t.quantityStore/t.packSize;t.cassier=parseInt((t.quantityItems/t.packSize).toString()),t.btls=t.quantityItems%t.packSize,t.cassierStore=parseInt(e.toString()),t.btlsStore=t.quantityStore%t.packSize,Number.isInteger(t.btls)||(t.btls=t.btls.toFixed(2)),Number.isInteger(t.btlsStore)||(t.btlsStore=t.btlsStore.toFixed(2))}if(t&&t._id&&this.storeProductArray.length){let e=this.storeProductArray.findIndex(e=>e._id===t._id);if(e>=0&&this.storeProductArray[e]&&this.storeProductArray[e].url){let i=this.storeProductArray[e].url;this.storeProductArray.splice(e,1,t),this.storeProductArray[e].url=i}}this.multiStoreProductitem.splice(this.numIndex,1,this.storeProductArray)}),this.sockets.on(`${t}newProductItem`,t=>{console.log("product item check"),this.productsItem.unshift(t)}),this.sockets.on(`${t}productItemToWarehouse`,t=>(0,a.mG)(this,void 0,void 0,function*(){if(console.log("pack item change ",t),t&&t._id){let e=t.quantityStore+t.quantityToConfirm,i=e/t.packSize;if(t.cassier=parseInt((t.quantityItems/t.packSize).toString()),t.btls=t.quantityItems%t.packSize,t.cassierStore=parseInt(i.toString()),t.btlsStore=e%t.packSize,Number.isInteger(t.btls)||(t.btls=t.btls.toFixed(2)),Number.isInteger(t.btlsStore)||(t.btlsStore=t.btlsStore.toFixed(2)),t&&t._id&&this.storeProductArray.length){let e=this.storeProductArray.findIndex(e=>e._id===t._id);if(e&&this.storeProductArray[e]&&this.storeProductArray[e].url){let i=this.storeProductArray[e].url;this.storeProductArray.splice(e,1,t),this.storeProductArray[e].url=i}}this.multiStoreProductitem.splice(this.numIndex,1,this.storeProductArray)}})),this.sockets.on(`${t}productItemToShop`,t=>(0,a.mG)(this,void 0,void 0,function*(){})),this.sockets.on(`${t}productItemDelete`,t=>(0,a.mG)(this,void 0,void 0,function*(){console.log("items delete",t)})),this.sockets.on(`${t}manufacturedItem`,t=>(0,a.mG)(this,void 0,void 0,function*(){if(console.log("manufactured item",t),t&&t._id){let e=this.productRestoRandom.findIndex(e=>e._id===t._id),i=this.productRestoRandom[e].url;this.productRestoRandom.splice(e,1,t),this.productRestoRandom[e].url=i,this.multiStoreProductResto=yield this.rangeByStoreService.rangeProductByStore(this.productRestoRandom)}})),this.sockets.on(`${t}resourceItem`,t=>(0,a.mG)(this,void 0,void 0,function*(){if(console.log("resource item",t),t&&t._id){let e=this.resourceItem.findIndex(e=>e._id===t._id);this.resourceItem.splice(e,1,t),this.multiStoreResourceitem=yield this.rangeByStoreService.rangeProductByStore(this.resourceItem)}})),this.sockets.on(`${t}transactionNewItem`,t=>(0,a.mG)(this,void 0,void 0,function*(){console.log("transaction item",t)})),this.sockets.on(`${t}${i}billardItemRestore`,t=>(0,a.mG)(this,void 0,void 0,function*(){this.URL&&(t.url=this.URL),this.multiStoreService[this.supIndex].splice(this.minIndex,1,t)})),this.sockets.on(`${t}shopList`,t=>(0,a.mG)(this,void 0,void 0,function*(){this.multiStoreList[this.supIndex].splice(this.minIndex,1,t)})),this.sockets.on(`${t}${i}billardItem`,t=>(0,a.mG)(this,void 0,void 0,function*(){if(t.quantityToAlert&&t.quantityStore<=t.quantityToAlert){let e=`le produit ${t.name} doit etre ravitaill\xe9 la quantit\xe9 en vente est: ${t.quantityStore}`;this.plt.is("electron")&&this.sendNotification(e),this.notifi.presentToast(e,"danger")}this.multiStoreService.forEach((e,i)=>{let o=e.findIndex(e=>e._id==t._id);o>=0&&(this.URL=e[o].url,t.url=this.URL,e.splice(o,1,t),this.multiStoreService.splice(i,1,e))})}))}updateStore(t,e){return(0,a.mG)(this,void 0,void 0,function*(){let i={};this.numIndex=e,this.storeProductArray=this.multiStoreProductitem[e],this.translate.get("add").subscribe(t=>{i.title=t}),this.translate.get("cancel").subscribe(t=>{i.cancel=t}),this.translate.get("placeholder").subscribe(t=>{i.placeholder=t});const o=yield this.alertController.create({header:`Available ${t.quantityItems}`,inputs:[{name:"quantity",type:"number",placeholder:"quantity"}],buttons:[{text:i.cancel,role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:i.title,handler:e=>{console.log(e);let i=e;t.quantityItems-parseInt(e.quantity)<0||parseInt(e.quantity)<=0?this.presentAlert():(parseInt(e.quantity),this.warehouseService.updateProductItemStore({id:t._id,quantity:parseInt(e.quantity),prod:t}).subscribe(t=>{console.log(t),parseInt(i.quantity)},t=>{console.log(t)}))}}]});yield o.present()})}callShowMessage(t,e){}confirmProd(t){console.log(t);let e={idprod:t._id,_id:t._id,quantityItems:parseInt(t.quantityToConfirm),sender:this.userName},i={idprod:t.itemStoreId,_id:t.itemStoreId,quantityItems:parseInt(t.quantityToConfirm),sender:this.userName};this.confirmTransaction(e),this.confirmTransaction(i)}updateStoreResto(t){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield this.alertController.create({header:`Avaible ${t.quantityItems}`,inputs:[{name:"quantity",type:"number",placeholder:"Enter quantity"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{if(isNaN(parseFloat(e.quantity)))console.log("not a number");else if(t.quantityItems-parseFloat(e.quantity)<0)this.presentAlert();else if(parseInt(e.quantity)<=0)this.presentAlert();else if(t.resourceType){let i={id:t._id,quantity:parseFloat(e.quantity),sender:this.userName,productType:t.productType};this.updateStoreResource(i)}else this.warehouseService.updateManufacturedItemStore({id:t._id,quantity:parseInt(e.quantity),sender:this.userName,productType:t.productType}).subscribe(t=>{console.log(t),localStorage.getItem("manageStockWithService"),this.presentAlertConfirm()},t=>{console.log(t)})}}]});yield e.present()})}updateServicesList(t,e,i){return(0,a.mG)(this,void 0,void 0,function*(){this.supIndex=e,this.minIndex=i,this.URL=t.url;const o=yield this.alertController.create({header:`Avaible ${t.quantityItems} ${t.name}`,inputs:[{name:"quantity",type:"number",placeholder:"Enter quantity"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{if(isNaN(parseFloat(e.quantity)))console.log("not a number");else if(t.quantityItems-parseFloat(e.quantity)<0)this.presentAlert();else if(parseInt(e.quantity)<=0)this.presentAlert();else{let i={id:t._id,quantity:parseFloat(e.quantity),sender:this.userName,senderId:JSON.parse(localStorage.getItem("user"))._id,productType:t.productType};this.updateServiceListStore(i)}}}]});yield o.present()})}updateShopList(t,e,i){return(0,a.mG)(this,void 0,void 0,function*(){this.supIndex=e,this.minIndex=i;const o=yield this.alertController.create({header:`Avaible ${t.quantityItems}`,inputs:[{name:"quantity",type:"number",placeholder:"Enter quantity"}],buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary",handler:()=>{console.log("Confirm Cancel")}},{text:"Ok",handler:e=>{if(isNaN(parseInt(e.quantity)))console.log("not a number");else if(t.quantityItems-parseInt(e.quantity)<0)this.presentAlert();else if(parseInt(e.quantity)<=0)this.presentAlert();else{let i={id:t._id,quantity:parseInt(e.quantity),sender:this.userName,productType:t.productType};this.updateShopListStore(i)}}}]});yield o.present()})}presentAlert(){return(0,a.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"ALERT",message:"NOT ENOUGTH IN STOCK.",cssClass:"AlertStock",buttons:["OK"]});yield t.present()})}takeProductResto(){this.restApiService.getManufacturedProductItemResto2().subscribe(t=>(0,a.mG)(this,void 0,void 0,function*(){let e;if(console.log(t),this.tabRoles.includes(3)||this.tabRoles.includes(2)){let i=JSON.parse(localStorage.getItem("user")).storeId;console.log(i),e=t.filter(t=>t.storeId==i),this.productRestoRandom=e}else e=t,this.productRestoRandom=e;this.multiStoreProductResto=yield this.rangeByStoreService.rangeProductByStore(e)}))}segmentChanged(t){this.afficheResource=!1,console.log("Segment changed",t.target.value),"resto"===t.target.value&&this.displayResource()}segmentChangedEnter(){}getSetting(){let t=this.saveRandom.getSetting();t.multi_store&&(this.multiStore=!0),t.use_gamme?(this.useRefueling=!0,this.takeFichePointage(),this.getResources(),this.takeProductServiceList()):(this.takeProductItems(),this.getResources(),this.takeProductServiceList(),this.takeProductListShop())}takePackItems(){this.restApiService.getPackItem().subscribe(t=>{t.items.forEach(t=>{t.totalItems=t.quantity*t.itemsInPack}),console.log(t),this.productsItem=t.items})}presentAlertConfirm(){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:"update successfuly!.",duration:2e3,position:"top",animated:!0,cssClass:"my-custom-classIn"})).present()})}presentActionSheet(t){return(0,a.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.actionSheetController.create({buttons:[{text:"View Details",icon:"heart",handler:()=>{}},{text:"Reset one",icon:"close",handler:()=>{console.log("Cancel clicked"),console.log(t),this.restApiService.resetProductItem({id:t._id}).subscribe(t=>{console.log(t)})}},{text:"Reset all",icon:"close",handler:()=>{console.log("Cancel clicked"),console.log(t),this.productsItem.forEach(t=>{setTimeout(()=>{this.restApiService.resetProductItem({id:t._id}).subscribe(t=>{console.log(t)})},1e3)})}}]});yield e.present()})}presentActionSheet2(t){return(0,a.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.actionSheetController.create({buttons:[{text:"View Details",icon:"heart",handler:()=>{}},{text:"Reset",icon:"close",handler:()=>{console.log("Cancel clicked"),console.log(t),this.restApiService.resetManufacturedItem({id:t._id}).subscribe(t=>{console.log(t)})}}]});yield e.present()})}presentActionSheet3(t){return(0,a.mG)(this,void 0,void 0,function*(){console.log(t);const e=yield this.actionSheetController.create({buttons:[{text:"ANNULER",icon:"heart",handler:()=>{}},{text:"RESET",icon:"close",handler:()=>{t.quantityStore=0,t.quantityItems=0,this.notifi.presentLoading(),this.restApiService.updateBillardGame(t).subscribe(t=>{console.log(t),this.notifi.dismissLoading()})}}]});yield e.present()})}confirmTransactionResto(t,e){console.log(e);let i={id:e.productId,quantity:t.quantityItems,receiver:this.userName};this.adminService.confirmTransaction(t._id,this.userName).subscribe(e=>{t.confirm=!0,t.receiver=this.userName,this.warehouService.updateManufacturedItemStoreConfirm({id:i.id,quantity:t.quantityItems,receiver:this.userName}).subscribe(t=>{console.log(t)})})}confirmTransaction(t){console.log(t),"manufacturedItems"==t.productType?this.adminService.confirmTransaction(t._id,this.userName).subscribe(e=>{t.confirm=!0,t.receiver=this.userName,this.warehouService.updateManufacturedItemStoreConfirm({id:t._id,quantity:t.quantityItems,receiver:this.userName}).subscribe(t=>{console.log(t)})}):(this.userName=JSON.parse(localStorage.getItem("user")).name,this.warehouService.updateProductItemStore({id:t.idprod,quantity:t.quantityItems,receiver:this.userName}).subscribe(e=>{t.confirm=!0,this.adminService.confirmTransaction(t._id,this.userName).subscribe(e=>{this.restApiService.clearProvision(),this.warehouService.confirmProductItemStore({id:t.idprod,receiver:this.userName}).subscribe(t=>{})})}))}presentToast(t){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({message:`${t}`,duration:2e3,position:"top",animated:!0})).present()})}getResources(){this.resourceService.getStoreResourcesItem().subscribe(t=>{console.log(t),this.resourceItem=t.items.filter(t=>0==t.desabled),this.resourceItem.forEach(t=>{t.quantityStore=Number.isInteger(t.quantityStore)?parseFloat(t.quantityStore):parseFloat(t.quantityStore).toFixed(2)}),this.rangeByStoreService.rangeProductByStore(this.resourceItem).then(t=>{console.log(t),this.multiStoreResourceitem=t})})}displayResource(){let t="";"bar"==this.pet&&(console.log("bar ici"),t="product-list"),"services"==this.pet&&(console.log("services ici"),t="billard"),"resto"==this.pet&&(t="product-manufactured");let e=this.resourceItem.filter(e=>{if(e.page)return e.page==t});this.rangeByStoreService.rangeProductByStore(e).then(t=>{this.multiStoreResourceitem=t}),this.afficheResource=!0}takeProductServiceList(){JSON.parse(localStorage.getItem("user")),this.restApiService.getBillardList().subscribe(t=>(0,a.mG)(this,void 0,void 0,function*(){let e=t.product.sort((t,e)=>t.name.toLocaleLowerCase()>e.name.toLocaleLowerCase()?1:t.name.toLocaleLowerCase()<e.name.toLocaleLowerCase()?-1:0);this.saveRandom.getSuperManager(),e=t.product,t.product.length&&t.product.forEach(t=>{t.filename&&(t.url=this.url+"billard/"+t._id+"?db="+localStorage.getItem("adminId"))}),this.productServiceTab=yield this.rangeByStoreService.rangeProductByStore(e),console.log(this.productServiceTab),this.multiStoreService=this.productServiceTab}))}takeProductListShop(){let t=JSON.parse(localStorage.getItem("user")).storeId;this.restApiService.getShopList().subscribe(e=>(0,a.mG)(this,void 0,void 0,function*(){let i=e.product.sort((t,e)=>t.name>e.name?1:-1);this.saveRandom.getSuperManager()||this.saveRandom.getSetting().manage_expenses||(i=e.product.filter(e=>e.storeId===t)),this.productListTab=yield this.rangeByStoreService.rangeProductByStore(i),this.multiStoreList=this.productListTab}))}updateStoreResource(t){this.resourceService.updateResourceStore(t).subscribe(t=>{this.getResources()})}updateServiceListStore(t){this.servicelistService.updateServiceStore(t).subscribe(e=>{this.fiche&&this.updateFiche(t.id,t.quantity)})}updateShopListStore(t){this.shoplistService.updateResourceStore(t).subscribe(t=>{})}goToRefueling(){this.router.navigateByUrl("procurment-product-item")}takeFichePointage(){console.log("je prend la fiche"),this.ficheService.getPointageList().subscribe(t=>{let e=this.saveRandom.getStoreId();t.length&&(t=t.filter(t=>t.storeId==e)),t.length&&(this.fiche=t[0],this.productsServices=t[0].list)},t=>{this.notifi.dismissLoading(),console.log(t)})}updateFiche(t,e){let i=this.fiche.list,o=i.findIndex(e=>e._id==t);if(o>=0){let t={date:Date.now(),qty:e};i[o].pointageList||(i[o].pointageList=[]),i[o].pointageList.push(t),i[o].pointage=0,i[o].pointageList.forEach(t=>{i[o].pointage=i[o].pointage?i[o].pointage+t.qty:t.qty}),this.fiche.list=i,this.ficheService.updateFichePointage(this.fiche).subscribe(t=>{console.log(t)},t=>{console.log(t)})}}sendNotification(t){this.electronService.showNotification(t)}}return t.\u0275fac=function(e){return new(e||t)(u.Y36(d.e),u.Y36(n.IN),u.Y36(n.Br),u.Y36(n.BX),u.Y36(n.yF),u.Y36(r.F0),u.Y36(h.w),u.Y36(m.l),u.Y36(m.l),u.Y36(g.sK),u.Y36(p.l),u.Y36(S.i),u.Y36(f.$),u.Y36(b.n),u.Y36(I.z),u.Y36(y.L),u.Y36(q.y),u.Y36(v.i),u.Y36(Z.g),u.Y36(A.i),u.Y36(T.d),u.Y36(n.t4))},t.\u0275cmp=u.Xpm({type:t,selectors:[["app-ravitaillement"]],decls:22,vars:13,consts:[["slot","end"],["size","small",3,"click",4,"ngIf"],["size","small",3,"click"],["size","small"],["slot","end","name","contact"],["slot","start"],["defaultHref","/start",4,"ngIf"],["defaultHref","/vendor-start",4,"ngIf"],["defaultHref","/warehouse",4,"ngIf"],["scrollable","",3,"value","ngModel","ionChange","ngModelChange",4,"ngIf"],["pager","true",4,"ngIf"],["defaultHref","/start"],["defaultHref","/vendor-start"],["defaultHref","/warehouse"],["scrollable","",3,"value","ngModel","ionChange","ngModelChange"],["class","btnseg",3,"value",4,"ngFor","ngForOf"],[1,"btnseg",3,"value"],["pager","true"],[4,"ngFor","ngForOf"],[1,"ion-text-center","ion-text-uppercase"],[1,"nodejs"],["lines","full",3,"ngClass",4,"ngFor","ngForOf"],["lines","full",3,"ngClass"],[3,"src"],["fill","outline","size","small","slot","end",1,"btnWarehouse",3,"click"],["fill","outline","slot","end",3,"click"],["class","confirm",4,"ngIf"],[1,"instock"],[1,"instore"],[1,"confirm"],["lines","full"],["lines","full",4,"ngFor","ngForOf"],["class","instock",4,"ngIf"]],template:function(t,e){1&t&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u.TgZ(2,"ion-title"),u._uU(3),u.ALo(4,"translate"),u.qZA(),u.TgZ(5,"ion-buttons",0),u.YNc(6,x,3,3,"ion-button",1),u.TgZ(7,"ion-button",2),u.NdJ("click",function(){return e.displayResource()}),u._uU(8," resources "),u.qZA(),u.TgZ(9,"ion-button",3),u._uU(10),u._UZ(11,"ion-icon",4),u.qZA(),u.qZA(),u.TgZ(12,"ion-buttons",5),u.YNc(13,N,1,0,"ion-back-button",6),u.YNc(14,k,1,0,"ion-back-button",7),u.YNc(15,_,1,0,"ion-back-button",8),u.qZA(),u.qZA(),u.qZA(),u.TgZ(16,"ion-content"),u.YNc(17,R,2,3,"ion-segment",9),u.YNc(18,O,2,1,"ion-slides",10),u.YNc(19,M,2,1,"ion-slides",10),u.YNc(20,z,2,1,"ion-slides",10),u.YNc(21,H,2,1,"ion-slides",10),u.qZA()),2&t&&(u.xp6(3),u.Oqu(u.lcZ(4,11,"MENU.stock")),u.xp6(3),u.Q6J("ngIf",e.setting&&e.setting.multi_store),u.xp6(4),u.hij(" ",e.userName," "),u.xp6(3),u.Q6J("ngIf",!e.vendorRole&&!e.warehousman),u.xp6(1),u.Q6J("ngIf",e.vendorRole&&!e.warehousman),u.xp6(1),u.Q6J("ngIf",e.warehousman),u.xp6(2),u.Q6J("ngIf",e.storeTypeTab&&e.storeTypeTab.length>1),u.xp6(1),u.Q6J("ngIf","bar"===e.pet&&!e.afficheResource),u.xp6(1),u.Q6J("ngIf",e.afficheResource),u.xp6(1),u.Q6J("ngIf","shop"===e.pet&&!e.afficheResource),u.xp6(1),u.Q6J("ngIf","services"===e.pet&&!e.afficheResource))},directives:[n.Gu,n.sr,n.wd,n.Sm,o.O5,n.YG,n.gu,n.W2,n.oU,n.cs,n.cJ,n.QI,s.JJ,s.On,o.sg,n.GO,n.Hr,n.A$,n.jY,n.Nd,n.wI,n.q_,n.Ie,o.mk,n.BJ,n.Q$],pipes:[g.X$],styles:[".instock[_ngcontent-%COMP%], .instore[_ngcontent-%COMP%]{font-size:60%;font-weight:700;display:block}.instore[_ngcontent-%COMP%]{color:#1c74f7}.btnWarehouse[_ngcontent-%COMP%]{font-size:65%}.stock-alert[_ngcontent-%COMP%]{--ion-background-color:#f14b4b;--color:#fff;opacity:.8}.stock-alert[_ngcontent-%COMP%]   .instock[_ngcontent-%COMP%], .stock-alert[_ngcontent-%COMP%]   .instore[_ngcontent-%COMP%]{color:#fff}.stock-alert[_ngcontent-%COMP%]   .btnWarehouse[_ngcontent-%COMP%]{--border-color:#000;--color:#000}.confirm[_ngcontent-%COMP%]{padding:0;color:red;font-size:10px}.divG[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]}),t})()}];let D=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=u.oAB({type:t}),t.\u0275inj=u.cJS({imports:[[o.ez,s.u5,n.Pc,r.Bz.forChild(j),g.aw.forChild()]]}),t})()},1044:(t,e,i)=>{"use strict";i.d(e,{n:()=>n});var o=i(4762),s=i(1572),r=i(9719);let n=(()=>{class t{constructor(t){this.getStoreName=t}rangeProductByStore(t){return new Promise((e,i)=>{let s=t.reduce((t,e)=>(t[e.storeId]=[...t[e.storeId]||[],e],t),{}),r=[];for(const t in s)r.push(s[t]);r.forEach(t=>(0,o.mG)(this,void 0,void 0,function*(){let e=yield this.getStoreName.takeName(t);t.storeName=e})),e(r)})}}return t.\u0275fac=function(e){return new(e||t)(s.LFG(r.$))},t.\u0275prov=s.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},866:(t,e,i)=>{"use strict";i.d(e,{l:()=>c});var o=i(529),s=i(1036),r=i(1572),n=i(9063),a=i(2968);let c=(()=>{class t{constructor(t,e){this.http=t,this.urlService=e,this.url="http://192.168.100.10:3000/",this.takeUrl()}takeUrl(){o.N.production?this.urlService.getUrl().subscribe(t=>{this.url=t,console.log("url",this.url)}):this.url=o.V}updateProductItemStore(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}updateProductItemStore1(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.put(`${this.url}productsitem/${this.id}/products/store?db=${this.id}`,t)}confirmProductItemStore(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e="";if(localStorage.getItem("openCashDateId")?e=localStorage.getItem("openCashDateId"):JSON.parse(localStorage.getItem("openCashDateObj"))&&(e=JSON.parse(localStorage.getItem("openCashDateObj"))._id),e)return this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm?db=${this.id}&openCashDate=${e}`,t)}updateManufacturedItemStore(t){this.id=localStorage.getItem("adminId");let e=localStorage.getItem("openCashDateId");return this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store?db=${this.id}&openCashDate=${e}`,t).pipe()}updateManufacturedItemStoreConfirm(t){this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail");let e=localStorage.getItem("openCashDateId");return this.http.patch(`${this.url}products_resto_item/${this.id}/manufacturedItems/store/confirm?db=${this.id}&openCashDate=${e}`,t).pipe()}updateIce(t){return this.id=localStorage.getItem("adminId"),this.database=localStorage.getItem("adminemail"),this.http.patch(`${this.url}productsitem/${this.id}/products/store/confirm/glacer?db=${this.id}`,t)}setProductItem(t){console.log(t),this.product=t}getProductItem(){return(0,s.isNullOrUndefined)(this.product)?0:this.product}}return t.\u0275fac=function(e){return new(e||t)(r.LFG(n.eN),r.LFG(a.i))},t.\u0275prov=r.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);