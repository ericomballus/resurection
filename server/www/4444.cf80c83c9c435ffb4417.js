(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[4444],{4444:(e,t,o)=>{"use strict";o.r(t),o.d(t,{EmployeeRetailerListPageModule:()=>R});var i=o(1511),s=o(6073),n=o(8158),l=o(8777),r=o(4762),a=o(3511),c=o(97),m=o(1190),d=o(896),h=o(1572),p=o(4144),u=o(5946),y=o(2181),g=o(4892),f=o(9719),v=o(4375),Z=o(2874);function E(e,t){1&e&&(h.TgZ(0,"ion-list-header"),h._uU(1," ALL EMPLOYEES "),h.qZA())}function b(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"ion-item"),h.TgZ(1,"ion-avatar",4),h._UZ(2,"img",10),h.qZA(),h.TgZ(3,"ion-label"),h.TgZ(4,"h3"),h._uU(5),h.qZA(),h.TgZ(6,"h3"),h._uU(7),h.qZA(),h.qZA(),h.TgZ(8,"ion-button",11),h.NdJ("click",function(){h.CHM(e);const o=t.$implicit;return h.oxw(2).manageRetailer(o)}),h._uU(9," manage retailer "),h.qZA(),h.qZA()}if(2&e){const e=t.$implicit;h.xp6(5),h.Oqu(e.name),h.xp6(2),h.hij("Telephone: ",e.telephone,"")}}function S(e,t){if(1&e&&(h.TgZ(0,"ion-slide"),h.TgZ(1,"ion-grid"),h.TgZ(2,"ion-row"),h.TgZ(3,"ion-col"),h.TgZ(4,"div",8),h.TgZ(5,"h4"),h._uU(6),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-list"),h.TgZ(8,"ion-list"),h.YNc(9,E,2,0,"ion-list-header",9),h.YNc(10,b,10,2,"ion-item",7),h.qZA(),h.qZA(),h.qZA(),h.qZA()),2&e){const e=t.$implicit,o=h.oxw();h.xp6(6),h.hij(" store ",e.storeName?e.storeName:"no name"," "),h.xp6(3),h.Q6J("ngIf",o.admin),h.xp6(1),h.Q6J("ngForOf",e)}}const A=[{path:"",component:(()=>{class e{constructor(e,t,o,i,s,n,l,r,a,c,m){this.restApiService=e,this.navCtrl=t,this.modalController=o,this.adminService=i,this.authService=s,this.socket=n,this.getStoreName=l,this.router=r,this.saveRandom=a,this.notifi=c,this.actionSheet=m,this.tabRoles=[],this.admin=!1,this.multiStoreEmploye=[],this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.tabRoles.includes(1)||this.tabRoles.includes(2),this.takeEmployees()}ngOnInit(){this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId)}webServerSocket(e){this.socket.connect(),this.socket.fromEvent(`${e}employeAdd`).subscribe(e=>{this.ListEmploye.unshift(e),this.takeEmployees()}),this.socket.fromEvent(`${e}employeDelete`).subscribe(e=>{this.ListEmploye=this.ListEmploye.filter(t=>t._id!==e),this.takeEmployees()}),this.socket.fromEvent(`${e}employeRoleAdd`).subscribe(e=>{this.takeEmployees(),(()=>(0,r.mG)(this,void 0,void 0,function*(){return Promise.all(this.ListEmploye.filter(t=>t._id!==e._id))}))().then(t=>{t.unshift(e),this.ListEmploye=t})}),this.socket.fromEvent(`${e}employeRoleDelete`).subscribe(e=>{this.takeEmployees(),(()=>(0,r.mG)(this,void 0,void 0,function*(){return Promise.all(this.ListEmploye.filter(t=>t._id!==e._id))}))().then(t=>{t.unshift(e),this.ListEmploye=t})})}employeeAdd(){return(0,r.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:a.e,componentProps:{flag:"employeeAddFlag"}});return e.onDidDismiss().then(e=>{"add"==e.data&&this.takeEmployees()}),yield e.present()})}employeeShow(){return(0,r.mG)(this,void 0,void 0,function*(){const e=yield this.modalController.create({component:a.e,componentProps:{product:"employeeShowFlag"}});return e.onDidDismiss().then(e=>{console.log(e)}),yield e.present()})}deleteEmploye(e){console.log(e),this.authService.deleteEmploye(e._id).subscribe(e=>{this.takeEmployees()})}takeEmployees(){this.authService.getEmployees().subscribe(e=>{this.ListEmploye=e.employes.filter(e=>e.isRetailer);let t=this.ListEmploye.reduce((e,t)=>(e[t.storeId]=[...e[t.storeId]||[],t],e),{});this.multiStoreEmploye=[],console.log(t);for(const o in t)this.multiStoreEmploye.push(t[o]);console.log("group here",this.multiStoreEmploye),this.multiStoreEmploye.forEach(e=>(0,r.mG)(this,void 0,void 0,function*(){let t=yield this.getStoreName.takeName(e);e.storeName=t}))})}updateEmploye(e){return(0,r.mG)(this,void 0,void 0,function*(){this.saveRandom.setRetailer(e);const t=yield this.modalController.create({component:c.Y,componentProps:{employe:{flag:"update",data:e}}});return t.onDidDismiss().then(e=>{console.log(e),this.takeEmployees()}),yield t.present()})}saleToRetailer(e){return(0,r.mG)(this,void 0,void 0,function*(){let t=e.productsToSale;t&&t.length?(this.saveRandom.confirmIfIsRetailer(),this.saveRandom.setRetailer(e),localStorage.setItem("backTo",JSON.stringify({url:"employee-retailer-list"})),this.router.navigateByUrl("/shop")):this.notifi.presentError("this employe not have products please provide some before","danger")})}viewEmploye(e){return(0,r.mG)(this,void 0,void 0,function*(){this.saveRandom.setRetailer(e);const t=yield this.modalController.create({component:m.L,componentProps:{}});return t.onDidDismiss().then(e=>{console.log(e)}),yield t.present()})}addYourRetailer(){this.router.navigateByUrl("/add-employee-retailer")}manageRetailer(e){return(0,r.mG)(this,void 0,void 0,function*(){const t=yield this.actionSheet.create({header:`${e.name}`,buttons:[{text:`Sale to ${e.name}`,icon:"cart",handler:()=>{this.saleToRetailer(e)}},{text:`Display ${e.name}`,icon:"eye",handler:()=>{this.updateEmploye(e)}},{text:"add product",icon:"bag",handler:()=>{this.viewEmploye(e)}},{text:`Invoices of ${e.name}`,icon:"cash",handler:()=>{this.getRetailerInvoice(e)}},{text:"Delete",role:"destructive",icon:"trash",handler:()=>{this.deleteEmploye(e)}},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield t.present();const{role:o}=yield t.onDidDismiss();console.log("onDidDismiss resolved with role",o)})}getRetailerInvoice(e){return(0,r.mG)(this,void 0,void 0,function*(){this.saveRandom.setRetailer(e);const t=yield this.modalController.create({component:d.j,componentProps:{}});return t.onDidDismiss().then(e=>{console.log(e)}),yield t.present()})}}return e.\u0275fac=function(t){return new(t||e)(h.Y36(p.e),h.Y36(n.SH),h.Y36(n.IN),h.Y36(u.l),h.Y36(y.u),h.Y36(g.sk),h.Y36(f.$),h.Y36(l.F0),h.Y36(v.i),h.Y36(Z.g),h.Y36(n.BX))},e.\u0275cmp=h.Xpm({type:e,selectors:[["app-employee-retailer-list"]],decls:10,vars:1,consts:[["color","primary"],["slot","end"],[3,"click"],["slot","icon-only","name","add"],["slot","start"],["defaultHref","/start"],["pager","true"],[4,"ngFor","ngForOf"],[1,"ion-text-center","ion-text-uppercase"],[4,"ngIf"],["src","../../assets/user.png"],["color","success","fill","clear",3,"click"]],template:function(e,t){1&e&&(h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar",0),h.TgZ(2,"ion-buttons",1),h.TgZ(3,"ion-button",2),h.NdJ("click",function(){return t.addYourRetailer()}),h._UZ(4,"ion-icon",3),h.qZA(),h.qZA(),h.TgZ(5,"ion-buttons",4),h._UZ(6,"ion-back-button",5),h.qZA(),h.qZA(),h.qZA(),h.TgZ(7,"ion-content"),h.TgZ(8,"ion-slides",6),h.YNc(9,S,11,3,"ion-slide",7),h.qZA(),h.qZA()),2&e&&(h.xp6(9),h.Q6J("ngForOf",t.multiStoreEmploye))},directives:[n.Gu,n.sr,n.Sm,n.YG,n.gu,n.oU,n.cs,n.W2,n.Hr,i.sg,n.A$,n.jY,n.Nd,n.wI,n.q_,i.O5,n.yh,n.Ie,n.BJ,n.Q$],styles:[""]}),e})()}];let k=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=h.oAB({type:e}),e.\u0275inj=h.cJS({imports:[[l.Bz.forChild(A)],l.Bz]}),e})(),R=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=h.oAB({type:e}),e.\u0275inj=h.cJS({imports:[[i.ez,s.u5,n.Pc,k]]}),e})()}}]);