(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[5962],{5962:(i,e,t)=>{"use strict";t.r(e),t.d(e,{ScHomePageModule:()=>z});var s=t(1511),o=t(6073),n=t(8158),r=t(8777),c=t(4762),l=t(1344),d=t.n(l),a=t(5416),h=t(5959),m=t(994),u=t(1572),g=t(5946),p=t(2874),f=t(4375),Z=t(2185),v=t(4144),T=t(2968),b=t(2181),q=t(6351);function S(i,e){1&i&&(u.TgZ(0,"div",6),u._UZ(1,"app-fakedata"),u.qZA())}const A=function(i){return{"background-color":i}};function y(i,e){if(1&i){const i=u.EpF();u.TgZ(0,"ion-row",13),u.NdJ("click",function(){u.CHM(i);const t=e.$implicit,s=e.index;return u.oxw(2).display(t,s)}),u.TgZ(1,"ion-col",11),u.TgZ(2,"div",14),u._uU(3),u.ALo(4,"date"),u.qZA(),u.qZA(),u.TgZ(5,"ion-col",11),u.TgZ(6,"div",14),u._uU(7),u.qZA(),u.qZA(),u.TgZ(8,"ion-col",11),u.TgZ(9,"div",14),u._uU(10),u.qZA(),u.qZA(),u.TgZ(11,"ion-col",15),u._UZ(12,"div",14),u.qZA(),u.TgZ(13,"ion-col",15),u._UZ(14,"div",14),u.qZA(),u.TgZ(15,"ion-col",15),u._UZ(16,"div",14),u.qZA(),u.qZA()}if(2&i){const i=e.$implicit;u.Q6J("ngStyle",u.VKq(10,A,e.index%2==0?"#f1f1f1":"white")),u.xp6(3),u.hij(" ",u.xi3(4,7,i.created,"short")," "),u.xp6(4),u.hij(" ",i.store.name," "),u.xp6(3),u.hij(" ",i.quantity," "),u.xp6(1),u.Q6J("ngStyle",u.VKq(12,A,i.scConfirm?"var(--ion-color-success)":"white")),u.xp6(2),u.Q6J("ngStyle",u.VKq(14,A,i.scConfirm&&!i.swConfirm?"var(--ion-color-warning)":i.scConfirm&&i.swConfirm?"var(--ion-color-success)":"white")),u.xp6(2),u.Q6J("ngStyle",u.VKq(16,A,i.scConfirm&&i.swConfirm&&!i.managerConfirm?"var(--ion-color-warning)":i.scConfirm&&i.swConfirm&&i.managerConfirm?"var(--ion-color-success)":"white"))}}function x(i,e){if(1&i&&(u.TgZ(0,"ion-grid"),u.TgZ(1,"ion-row",7),u.TgZ(2,"ion-col",8),u.TgZ(3,"div",9),u.TgZ(4,"p"),u._uU(5,"commandes agences"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(6,"ion-row",10),u.TgZ(7,"ion-col",11),u.TgZ(8,"div",6),u._uU(9,"Date"),u.qZA(),u.qZA(),u.TgZ(10,"ion-col",11),u.TgZ(11,"div",6),u._uU(12,"Agence"),u.qZA(),u.qZA(),u.TgZ(13,"ion-col",11),u.TgZ(14,"div",6),u._uU(15,"Quantit\xe9"),u.qZA(),u.qZA(),u.TgZ(16,"ion-col",11),u.TgZ(17,"div",6),u._uU(18,"status"),u.qZA(),u.qZA(),u.qZA(),u.YNc(19,y,17,18,"ion-row",12),u.qZA()),2&i){const i=u.oxw();u.xp6(19),u.Q6J("ngForOf",i.agencesCommandes)}}function C(i,e){1&i&&(u.TgZ(0,"div",6),u._UZ(1,"app-fakedata"),u.qZA())}function _(i,e){if(1&i){const i=u.EpF();u.TgZ(0,"ion-button",23),u.NdJ("click",function(){u.CHM(i);const e=u.oxw(),t=e.$implicit,s=e.index;return u.oxw(2).deleteBill(t,s)}),u._uU(1,"suppr"),u.qZA()}}const w=function(i){return[i," ","symbol","3.0-0","fr"]};function I(i,e){if(1&i){const i=u.EpF();u.TgZ(0,"ion-row",19),u.TgZ(1,"ion-col",20),u.NdJ("click",function(){u.CHM(i);const t=e.$implicit,s=e.index;return u.oxw(2).displayBill(t,s)}),u.TgZ(2,"div",14),u._uU(3),u.ALo(4,"date"),u.qZA(),u.qZA(),u.TgZ(5,"ion-col",20),u.NdJ("click",function(){u.CHM(i);const t=e.$implicit,s=e.index;return u.oxw(2).displayBill(t,s)}),u.TgZ(6,"div",14),u._uU(7),u.qZA(),u.qZA(),u.TgZ(8,"ion-col",20),u.NdJ("click",function(){u.CHM(i);const t=e.$implicit,s=e.index;return u.oxw(2).displayBill(t,s)}),u.TgZ(9,"div",14),u._uU(10),u.qZA(),u.qZA(),u.TgZ(11,"ion-col",21),u.NdJ("click",function(){u.CHM(i);const t=e.$implicit,s=e.index;return u.oxw(2).displayBill(t,s)}),u.TgZ(12,"div",14),u._uU(13),u.ALo(14,"currency"),u.qZA(),u.qZA(),u.TgZ(15,"ion-col",17),u.TgZ(16,"div",14),u.YNc(17,_,2,0,"ion-button",22),u.qZA(),u.qZA(),u.TgZ(18,"ion-col",15),u._UZ(19,"div",14),u.qZA(),u.TgZ(20,"ion-col",15),u._UZ(21,"div",14),u.qZA(),u.qZA()}if(2&i){const i=e.$implicit;u.Q6J("ngStyle",u.VKq(17,A,e.index%2==0?"#f1f1f1":"white")),u.xp6(3),u.hij(" ",u.xi3(4,8,i.created,"short")," "),u.xp6(4),u.hij(" ",i.customer?i.customer.name:"No Name"," "),u.xp6(3),u.hij(" ",i.userName?i.userName:"No Name"," "),u.xp6(3),u.hij(" ",u.G7q(14,11,u.VKq(19,w,i.montantReduction?i.montantReduction+i.taxeRetrait+i.phytosanitaire+i.transport+i.transport_colis:i.commande.cartdetails.totalPrice+i.taxeRetrait+i.phytosanitaire+i.transport+i.transport_colis))," "),u.xp6(4),u.Q6J("ngIf",!i.caisseConfirm),u.xp6(1),u.Q6J("ngStyle",u.VKq(21,A,i.scConfirm?"var(--ion-color-success)":"white")),u.xp6(2),u.Q6J("ngStyle",u.VKq(23,A,i.scConfirm&&!i.swConfirm?"var(--ion-color-warning)":i.scConfirm&&i.swConfirm?"var(--ion-color-success)":"white"))}}function k(i,e){if(1&i&&(u.TgZ(0,"ion-grid"),u.TgZ(1,"ion-row",7),u.TgZ(2,"ion-col",8),u.TgZ(3,"div",9),u.TgZ(4,"p"),u._uU(5,"Commandes clients"),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(6,"ion-row",10),u.TgZ(7,"ion-col",16),u.TgZ(8,"div",6),u._uU(9,"Date"),u.qZA(),u.qZA(),u.TgZ(10,"ion-col",16),u.TgZ(11,"div",6),u._uU(12,"Client"),u.qZA(),u.qZA(),u.TgZ(13,"ion-col",16),u.TgZ(14,"div",6),u._uU(15,"Emp"),u.qZA(),u.qZA(),u.TgZ(16,"ion-col",11),u.TgZ(17,"div",6),u._uU(18,"Montant"),u.qZA(),u.qZA(),u.TgZ(19,"ion-col",17),u._UZ(20,"div",6),u.qZA(),u.TgZ(21,"ion-col",16),u.TgZ(22,"div",6),u._uU(23,"status"),u.qZA(),u.qZA(),u.qZA(),u.YNc(24,I,22,25,"ion-row",18),u.qZA()),2&i){const i=u.oxw();u.xp6(24),u.Q6J("ngForOf",i.billTab)}}const L=[{path:"",component:(()=>{class i{constructor(i,e,t,s,o,n,r,c,l,d){this.menu=i,this.adminService=e,this.notifi=t,this.random=s,this.swService=o,this.restApiService=n,this.router=r,this.urlService=c,this.authService=l,this.modalController=d,this.articles=[],this.agencesCommandes=[],this.productServiceTab=[],this.billTab=[],this.destroy$=new h.xQ,this.EmployesList=[],this.customerList=[]}ngOnInit(){this.getSetting(),this.takeEmployees()}ionViewDidEnter(){this.menu.enable(!0,"first"),this.getPurchase(),this.getCustomerBill(),this.takeUrl()}refreshAll(){this.notifi.presentLoading(),setTimeout(()=>{this.notifi.dismissLoading()},3e3),this.getCustomerBill(),this.getPurchase()}ionViewWillLeave(){this.sockets.connected=!1,this.sockets.disconnected=!0,this.adminId=null,this.url=null}takeUrl(){this.urlService.getUrl().pipe((0,a.R)(this.destroy$)).subscribe(i=>{console.log("url ici===",i),this.url=i,this.adminId=localStorage.getItem("adminId"),this.webServerSocket()})}getPurchase(){let i=this.random.getStoreId(),e=JSON.parse(localStorage.getItem("roles"));this.adminService.getPurchase().pipe((0,a.R)(this.destroy$)).subscribe(t=>{this.allPurchase=e.includes(2)?t.docs.filter(e=>e.storeId==i):t.docs.filter(i=>"scConfirm"in i&&"swConfirm"in i),this.stores=this.random.getStoreList();for(let i of this.allPurchase){let e=this.stores.find(e=>e.id==i.storeId);i.store=e}this.agencesCommandes=this.allPurchase,this.takeProductServiceList()})}display(i,e){this.notifi.presentLoading();let t=[];console.log(this.productServiceTab),i.articles[0].products.forEach(i=>{let e=this.productServiceTab.find(e=>e.idList.includes(i.item._id));e&&t.push({avaible:e,request:i,accept:0,reject:0})}),setTimeout(()=>{this.notifi.dismissLoading(),console.log("match ==>",t),this.random.setAgenceCommande(t),this.random.setData(i),this.router.navigateByUrl("sc-commande")},1e3)}takeProductServiceList(){this.restApiService.getBillardList().pipe((0,a.R)(this.destroy$)).subscribe(i=>(0,c.mG)(this,void 0,void 0,function*(){let e=i.product.sort((i,e)=>i.name.toLocaleLowerCase()>e.name.toLocaleLowerCase()?1:i.name.toLocaleLowerCase()<e.name.toLocaleLowerCase()?-1:0);this.productServiceTab=e,this.agencesCommandes.forEach(i=>{i.swConfirm||i.scConfirm||i.articles[0].products.forEach(i=>{let e=this.productServiceTab.find((e,t)=>e.idList.includes(i.item._id));if(e){e.reserve?(e.reserve=e.reserve+i.qty,e.dispo=e.quantityItems-e.reserve):(e.reserve=i.qty,e.dispo=e.quantityItems-e.reserve);let t=this.productServiceTab.findIndex(i=>i._id==e._id);t>=0&&this.productServiceTab.splice(t,1,e)}})}),setTimeout(()=>{console.log(this.productServiceTab)},5e3)}))}webServerSocket(){let i=this.random.getStoreId();this.sockets=d()(this.url),this.sockets.on("connect",function(){console.log("je suis connect\xe9 socket",this.url)}),this.sockets.on(`${this.adminId}warehouseChange`,i=>{console.log(i);let e=this.agencesCommandes.findIndex(e=>e._id==i._id);if(e>=0){this.stores=this.random.getStoreList();let t=this.stores.find(e=>e.id==i.storeId);i.store=t,this.agencesCommandes.splice(e,1,i),this.rebuild()}}),this.sockets.on(`${this.adminId}managerConfirm`,i=>{let e=this.agencesCommandes.findIndex(e=>e._id==i._id);if(e>=0){this.stores=this.random.getStoreList();let t=this.stores.find(e=>e.id==i.storeId);i.store=t,this.agencesCommandes.splice(e,1,i),this.notifi.presentToast(`${t.name}: livraison de produit confirm\xe9`,"primary"),this.rebuild()}}),this.sockets.on(`${this.adminId}${i}billardItem`,i=>{let e=this.productServiceTab.findIndex(e=>e._id==i._id);e>=0&&(console.log("index===>",e),this.productServiceTab.splice(e,1,i),this.rebuild())}),this.sockets.on(`${this.adminId}${i}newOrder`,i=>{if(this.billTab.findIndex(e=>e._id==i._id)>=0);else{let e=this.customerList.find(e=>e._id==i.customerId);e&&(i.customer=e),this.billTab.push(i)}}),this.sockets.on(`${this.adminId}swConfirm`,i=>{console.log("new here ===>",i);let e=this.billTab.findIndex(e=>e._id==i._id);e>=0&&(this.billTab.splice(e,1,i),this.rebuild())}),this.sockets.on(`${this.adminId}swConfirm`,i=>{this.billTab.findIndex(e=>e._id==i._id)}),this.sockets.on(`${this.adminId}Purchase`,i=>{this.stores=this.random.getStoreList();let e=this.stores.find(e=>e.id==i.storeId);e&&(i.store=e,this.agencesCommandes.unshift(i),this.rebuild())}),this.sockets.on(`${this.adminId}PurchaseUpdate`,i=>{console.log("warehouse confirm=====>",i);let e=this.agencesCommandes.findIndex(e=>e._id==i._id);if(e>=0){this.stores=this.random.getStoreList();let t=this.stores.find(e=>e.id==i.storeId);i.store=t,this.agencesCommandes.splice(e,1,i),this.rebuild()}}),this.sockets.on(`${this.adminId}${i}billardItem`,i=>{console.log("warehouse c=====>",i);let e=this.productServiceTab.findIndex(e=>e._id==i._id);e>=0&&(this.productServiceTab.splice(e,1,i),this.rebuild())}),this.sockets.on(`${this.adminId}billUpdate`,i=>{let e=this.billTab.findIndex(e=>e._id==i._id);e>=0&&(this.billTab.splice(e,1,i),this.rebuild())}),this.sockets.on(`${this.adminId}${i}invoiceCancel`,i=>{setTimeout(()=>{this.billTab=this.billTab.filter(e=>e._id!==i._id)},1500)}),this.sockets.on(`${this.adminId}${i}buyOrder`,i=>{let e=this.billTab.findIndex(e=>e._id==i._id);if(e>=0){let t=this.customerList.find(e=>e._id==i.customerId);t&&(i.customer=t),this.billTab.splice(e,1,i)}})}rebuild(){this.productServiceTab.forEach(i=>{i.reserve=0,i.dispo=0}),this.agencesCommandes.forEach(i=>{i.swConfirm||i.scConfirm||i.articles[0].products.forEach(i=>{let e=this.productServiceTab.find((e,t)=>e.idList.includes(i.item._id));if(e){e.reserve?(e.reserve=e.reserve+i.qty,e.dispo=e.quantityItems-e.reserve):(e.reserve=i.qty,e.dispo=e.quantityItems-e.reserve);let t=this.productServiceTab.findIndex(i=>i._id==e._id);t>=0&&this.productServiceTab.splice(t,1,e)}})})}goToShop(){this.router.navigateByUrl("sc-shop")}takeEmployees(){this.authService.getEmployees().pipe((0,a.R)(this.destroy$)).subscribe(i=>{console.log("voici les emplo===>",i),this.EmployesList=i.employes,this.EmployesList=this.EmployesList.sort((i,e)=>i.name>e.name?1:-1),this.random.setEmployeList(this.EmployesList)})}getSetting(){this.adminService.getCompanySetting().pipe((0,a.R)(this.destroy$)).subscribe(i=>{if(i.company.length){let e=i.company[0];this.random.setSetting(e),localStorage.setItem("setting",JSON.stringify(i.company)),localStorage.setItem("useResource",JSON.stringify(e.use_resource)),localStorage.setItem("manageStockWithService",JSON.stringify(e.manageStockWithService)),localStorage.setItem("poslive",JSON.stringify(e.use_pos_live))}},i=>{console.log(i)})}getCustomerBill(){this.adminService.getInvoiceNotPaieAdmin2(1).pipe((0,a.R)(this.destroy$)).subscribe(i=>(0,c.mG)(this,void 0,void 0,function*(){console.log("voici les invoices===>",i),this.getMyCustomer(),this.billTab=i.filter(i=>0==i.caisseConfirm)}),i=>{})}displayBill(i,e){return(0,c.mG)(this,void 0,void 0,function*(){console.log("===>",i);const e=yield this.modalController.create({component:m.k,componentProps:{order:i,order2:i,Bill:!0},cssClass:"custom-modal"});return e.onDidDismiss().then(i=>{}),yield e.present()})}deleteBill(i,e){1==i.caisseConfirm?this.notifi.presentToast("impossible de supprimer cette facture","danger"):(console.log(i),this.notifi.presentAlertConfirm("supprimer la  factuer ?","OUI","NON").then(()=>{i.sc=!0;let t=null;i.customer&&(t=i.customer),this.notifi.presentLoading(),i.commandes.forEach(s=>{this.adminService.cancelOrder2(i.localId,s.products,t,!0).pipe((0,a.R)(this.destroy$)).subscribe(i=>{console.log("delte herere  ===>",i),this.billTab.splice(e,1),this.notifi.dismissLoading()},i=>{console.log(i)})})}).catch(()=>{}))}getMyCustomer(){this.adminService.getUserCustumer().pipe((0,a.R)(this.destroy$)).subscribe(i=>{this.customerList=i.custumers;for(const e of this.billTab){let i=this.customerList.find(i=>i._id==e.customerId);i&&(e.customer=i)}})}}return i.\u0275fac=function(e){return new(e||i)(u.Y36(n._q),u.Y36(g.l),u.Y36(p.g),u.Y36(f.i),u.Y36(Z.f),u.Y36(v.e),u.Y36(r.F0),u.Y36(T.i),u.Y36(b.u),u.Y36(n.IN))},i.\u0275cmp=u.Xpm({type:i,selectors:[["app-sc-home"]],decls:15,vars:4,consts:[["slot","end"],["fill","outline",3,"click"],[2,"display","flex","justify-content","space-between"],[2,"flex-grow","1","padding-right","15px","padding-left","15px","border-right","2px solid black"],["class","ion-text-center",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center"],[2,"font-size","14px","font-weight","bold"],["size","12"],[1,"ion-text-center","ion-text-uppercase"],[1,"header-component"],["size-sm","3","size-md","3","size-lg","3"],["class","data-row data-update","style","font-size: 11px",3,"ngStyle","click",4,"ngFor","ngForOf"],[1,"data-row","data-update",2,"font-size","11px",3,"ngStyle","click"],[1,"ion-text-center","ion-text-uppercase","smallSize"],["size-sm","1","size-md","1","size-lg","1",3,"ngStyle"],["size-sm","2","size-md","2","size-lg","2"],["size-sm","1","size-md","1","size-lg","1"],["class","data-row data-update","style","font-size: 11px",3,"ngStyle",4,"ngFor","ngForOf"],[1,"data-row","data-update",2,"font-size","11px",3,"ngStyle"],["size-sm","2","size-md","2","size-lg","2",3,"click"],["size-sm","3","size-md","3","size-lg","3",3,"click"],["style","font-size: 10px","size","small",3,"click",4,"ngIf"],["size","small",2,"font-size","10px",3,"click"]],template:function(i,e){1&i&&(u.TgZ(0,"ion-header"),u.TgZ(1,"ion-toolbar"),u.TgZ(2,"ion-buttons",0),u.TgZ(3,"ion-button",1),u.NdJ("click",function(){return e.refreshAll()}),u._uU(4," Refresh "),u.qZA(),u.TgZ(5,"ion-button",1),u.NdJ("click",function(){return e.goToShop()}),u._uU(6," commande "),u.qZA(),u.qZA(),u.qZA(),u.qZA(),u.TgZ(7,"ion-content"),u.TgZ(8,"div",2),u.TgZ(9,"div",3),u.YNc(10,S,2,0,"div",4),u.YNc(11,x,20,1,"ion-grid",5),u.qZA(),u.TgZ(12,"div",3),u.YNc(13,C,2,0,"div",4),u.YNc(14,k,25,1,"ion-grid",5),u.qZA(),u.qZA(),u.qZA()),2&i&&(u.xp6(10),u.Q6J("ngIf",0==e.agencesCommandes.length),u.xp6(1),u.Q6J("ngIf",e.agencesCommandes.length),u.xp6(2),u.Q6J("ngIf",0==e.billTab.length),u.xp6(1),u.Q6J("ngIf",e.billTab.length))},directives:[n.Gu,n.sr,n.Sm,n.YG,n.W2,s.O5,q.Q,n.jY,n.Nd,n.wI,s.sg,s.PC],pipes:[s.uU,s.H9],styles:[""]}),i})()}];let U=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=u.oAB({type:i}),i.\u0275inj=u.cJS({imports:[[r.Bz.forChild(L)],r.Bz]}),i})();var $=t(9547);let z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=u.oAB({type:i}),i.\u0275inj=u.cJS({imports:[[s.ez,o.u5,n.Pc,U,$.G]]}),i})()}}]);