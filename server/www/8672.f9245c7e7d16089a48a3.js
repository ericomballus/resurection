(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[8672],{8672:(t,e,i)=>{"use strict";i.r(e),i.d(e,{ScShopPageModule:()=>rt});var s=i(1511),o=i(6073),a=i(8158),r=i(8777),n=i(4762),c=i(9942),l=i(5416),h=i(8512),d=i(5959),u=i(728),g=i(4446),m=i(1572),p=i(4144),f=i(3437),v=i(5604),S=i(731),b=i(5541),T=i(7149),y=i(5946),A=i(3515),Z=i(2968),q=i(6529),I=i(5508),C=i(7886),L=i(2874),P=i(1611),x=i(1044),k=i(4418),G=i(3764),_=i(1094),O=i(4375),R=i(8732),N=i(8684),w=i(1714),E=i(1064),J=i(6048);function U(t,e){if(1&t&&(m.TgZ(0,"ion-button",16),m.TgZ(1,"ion-badge",17),m._uU(2),m.qZA(),m.qZA()),2&t){const t=m.oxw();m.xp6(2),m.hij(" ",t.grammage," g")}}function Y(t,e){if(1&t&&(m.TgZ(0,"ion-segment-button",20),m._uU(1),m.qZA()),2&t){const t=e.$implicit;m.s9C("value",t),m.xp6(1),m.hij(" ",t," ")}}function M(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"ion-segment",18),m.NdJ("ionChange",function(e){return m.CHM(t),m.oxw().segmentChanged(e)})("ngModelChange",function(e){return m.CHM(t),m.oxw().pet=e}),m.YNc(1,Y,2,2,"ion-segment-button",19),m.qZA()}if(2&t){const t=m.oxw();m.s9C("value",t.pet),m.Q6J("ngModel",t.pet),m.xp6(1),m.Q6J("ngForOf",t.storeTypeTab)}}const z=function(t){return{"background-color":t}};function B(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"ion-row",25),m.TgZ(1,"ion-col",22),m.TgZ(2,"div",26),m._uU(3),m.qZA(),m.qZA(),m.TgZ(4,"ion-col",22),m.TgZ(5,"div",27),m._uU(6),m.qZA(),m.qZA(),m.TgZ(7,"ion-col",22),m.TgZ(8,"div",27),m._uU(9),m.qZA(),m.qZA(),m.TgZ(10,"ion-col",22),m.TgZ(11,"div",27),m.TgZ(12,"ion-input",28),m.NdJ("ionChange",function(i){m.CHM(t);const s=e.$implicit;return m.oxw(2).getValueR(i,s)}),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&t){const t=e.$implicit;m.Q6J("ngStyle",m.VKq(4,z,e.index%2==0?"#f1f1f1":"white")),m.xp6(3),m.hij(" ",t.name," "),m.xp6(3),m.hij(" ",t.quantityItems," "),m.xp6(3),m.hij(" ",t.toSale?t.toSale:0," ")}}function $(t,e){if(1&t&&(m.TgZ(0,"div"),m.TgZ(1,"ion-grid"),m.TgZ(2,"ion-row",21),m.TgZ(3,"ion-col",22),m.TgZ(4,"div",23),m._uU(5,"name"),m.qZA(),m.qZA(),m.TgZ(6,"ion-col",22),m.TgZ(7,"div",23),m._uU(8,"En stock"),m.qZA(),m.qZA(),m.TgZ(9,"ion-col",22),m._UZ(10,"div",23),m.qZA(),m.TgZ(11,"ion-col",22),m._UZ(12,"div",23),m.qZA(),m.qZA(),m.YNc(13,B,13,6,"ion-row",24),m.qZA(),m.qZA()),2&t){const t=m.oxw();m.xp6(13),m.Q6J("ngForOf",t.arrList2)}}function Q(t,e){1&t&&m._UZ(0,"ion-col",34)}function F(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"ion-row",25),m.TgZ(1,"ion-col",22),m.TgZ(2,"div",26),m._uU(3),m.qZA(),m.qZA(),m.TgZ(4,"ion-col",22),m.TgZ(5,"div",27),m._uU(6),m.qZA(),m.qZA(),m.TgZ(7,"ion-col",34),m.TgZ(8,"div",27),m._uU(9),m.qZA(),m.qZA(),m.TgZ(10,"ion-col",34),m.TgZ(11,"div",27),m.TgZ(12,"ion-input",28),m.NdJ("ionChange",function(i){m.CHM(t);const s=e.$implicit;return m.oxw(4).getValueR(i,s)}),m.qZA(),m.qZA(),m.qZA(),m.YNc(13,Q,1,0,"ion-col",35),m.qZA()}if(2&t){const t=e.$implicit;m.Q6J("ngStyle",m.VKq(5,z,e.index%2==0?"#f1f1f1":"white")),m.xp6(3),m.hij(" ",t.name," "),m.xp6(3),m.hij(" ",t.quantityItems," "),m.xp6(3),m.hij(" ",t.toSale?t.toSale:0," "),m.xp6(4),m.Q6J("ngIf",t&&t.toSale)}}function V(t,e){if(1&t&&(m.TgZ(0,"ion-grid"),m.TgZ(1,"ion-row",31),m.TgZ(2,"ion-col",32),m.TgZ(3,"div",33),m.TgZ(4,"p"),m._uU(5,"Ravitaillement"),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(6,"ion-row",21),m.TgZ(7,"ion-col",22),m.TgZ(8,"div",23),m._uU(9,"name"),m.qZA(),m.qZA(),m.TgZ(10,"ion-col",22),m.TgZ(11,"div",23),m._uU(12,"En stock"),m.qZA(),m.qZA(),m.TgZ(13,"ion-col",34),m._UZ(14,"div",23),m.qZA(),m.TgZ(15,"ion-col",34),m._UZ(16,"div",23),m.qZA(),m.TgZ(17,"ion-col",34),m._UZ(18,"div",23),m.qZA(),m.qZA(),m.YNc(19,F,14,7,"ion-row",24),m.qZA()),2&t){const t=m.oxw(3);m.xp6(19),m.Q6J("ngForOf",t.productListTab)}}function j(t,e){if(1&t&&(m.TgZ(0,"div",30),m.YNc(1,V,20,1,"ion-grid",15),m.qZA()),2&t){const t=m.oxw(2);m.xp6(1),m.Q6J("ngIf",t.productListTab.length)}}function D(t,e){if(1&t&&(m.TgZ(0,"div"),m.YNc(1,j,2,1,"div",29),m.qZA()),2&t){const t=m.oxw();m.xp6(1),m.Q6J("ngIf",!t.isItemAvailable3)}}function H(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"ion-badge",45),m.NdJ("click",function(){m.CHM(t);const e=m.oxw().$implicit;return m.oxw(2).removeIn(e)}),m._uU(1),m.qZA()}if(2&t){const t=m.oxw().$implicit;m.xp6(1),m.Oqu(t.nbr)}}function K(t,e){if(1&t&&m._UZ(0,"app-cache-image",46),2&t){const t=m.oxw(3);m.Q6J("src",t.urlPackage)("spinner",!1)("isLoad",t.isLoad)}}function W(t,e){if(1&t&&m._UZ(0,"app-cache-image",46),2&t){const t=m.oxw().$implicit,e=m.oxw(2);m.Q6J("src",t.url)("spinner",!1)("isLoad",e.isLoad)}}function X(t,e){if(1&t){const t=m.EpF();m.TgZ(0,"ion-col",37),m.TgZ(1,"div",38),m.TgZ(2,"ion-card",39),m.TgZ(3,"div",40),m.YNc(4,H,2,1,"ion-badge",41),m.qZA(),m.TgZ(5,"div",42),m.NdJ("click",function(){m.CHM(t);const i=e.$implicit;return m.oxw(2).buyGamme(i)}),m.YNc(6,K,1,3,"app-cache-image",43),m.YNc(7,W,1,3,"app-cache-image",43),m.qZA(),m.TgZ(8,"ion-card-content"),m.TgZ(9,"div",44),m.TgZ(10,"small"),m._uU(11),m.qZA(),m._uU(12,"\xa0 "),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA()}if(2&t){const t=e.$implicit;m.xp6(4),m.Q6J("ngIf",t.nbr),m.xp6(2),m.Q6J("ngIf",!t.url),m.xp6(1),m.Q6J("ngIf",t.url),m.xp6(4),m.Oqu(t.name)}}function tt(t,e){if(1&t&&(m.TgZ(0,"div"),m.TgZ(1,"ion-grid"),m.TgZ(2,"ion-row"),m.YNc(3,X,13,4,"ion-col",36),m.qZA(),m.qZA(),m.qZA()),2&t){const t=m.oxw();m.xp6(3),m.Q6J("ngForOf",t.gammeListTab)}}const et=function(t){return[t,"FCFA","symbol","3.0-0","fr"]};function it(t,e){if(1&t&&(m.TgZ(0,"ion-footer"),m.TgZ(1,"ion-row"),m._UZ(2,"ion-col"),m.TgZ(3,"ion-col",47),m.TgZ(4,"div",48),m.TgZ(5,"small"),m._uU(6),m.qZA(),m._uU(7," items = "),m.TgZ(8,"small"),m._uU(9),m.ALo(10,"currency"),m.qZA(),m.qZA(),m.qZA(),m._UZ(11,"ion-col"),m.qZA(),m.qZA()),2&t){const t=m.oxw();m.xp6(6),m.Oqu(t.totalItems),m.xp6(3),m.hij("",m.G7q(10,2,m.VKq(8,et,t.totalPrice))," ")}}const st=[{path:"",component:(()=>{class t{constructor(t,e,i,s,o,a,r,n,c,l,u,g,m,p,f,v,S,b,T,y,A,Z,q,I,C,L,P,x,k,G,_,O,R,N){this.restApiService=t,this.manageCartService=e,this.countItemsService=i,this.navCtrl=s,this.modalController=o,this.alertController=a,this.router=r,this.loadingController=n,this.translateConfigService=c,this.events=l,this.networkService=u,this.toastController=g,this.adminService=m,this.imageLoader=p,this.urlService=f,this.screensizeService=v,this.popoverController=S,this.offlineManager=b,this.menu=T,this.httpN=y,this.notification=A,this.resourceService=Z,this.rangeByStoreService=q,this.manageSocket=I,this.groupByService=C,this.platform=L,this.cacheService=P,this.saveRandom=x,this.convert=k,this.retailerPrice=G,this.gammeService=_,this.translate=O,this.notifi=R,this.location=N,this.products=[],this.productResto=[],this.randomP=[],this.randomShop=[],this.randomResto=[],this.randomList=[],this.packs=[],this.allProducts=[],this.totalItems=0,this.totalPrice=0,this.isItemAvailable=!1,this.isItemAvailable2=!1,this.isItemAvailable3=!1,this.btnProducts=!0,this.btnAllProducts=!1,this.btnResto=!1,this.btnPack=!1,this.isLoading=!1,this.tabRoles=[],this.jsonProducts=null,this.pos=!1,this.userProducts=[],this.userProducts2=[],this.allUserProducts=[],this.allUserProductsList=[],this.categories=[],this.productsCat=[],this.segment="boisson",this.tableCheckDisplay=[],this.productsGame=[],this.ortherProducts=[],this.objGen={},this.numPlat=1,this.numPlatRandom=0,this.plat=[],this.plalist=[1],this.flagAdd=!1,this.productStatus=new h.X(!1),this.displayList=!1,this.storeType=[],this.tabNotif=[],this.arr=[],this.arrList=[],this.arrList2=[],this.arrListRandom=[],this.storeTypeTab=[],this.productListTab=[],this.saleToPack=!1,this.checkPack=!1,this.saleToRetailer=!1,this.isRetailer=!1,this.tab=[],this.destroy$=new d.xQ,this.isLoad=!1,this.navSlide=!1,this.isDesktop=!1,this.showMe=!0,this.urlPackage="",this.transaction=[],this.clientType=null,this.randomObj={},this.grammage=0,this.zoneList=[],this.setting=this.saveRandom.getSetting(),this.zoneList=this.setting.zone,this.screenCheck(),this.menu.enable(!0,"first");let w=JSON.parse(localStorage.getItem("adminUser"));this.storeType=w.storeType,(w.displayType&&"card"==w.displayType||this.storeType.includes("bar")||this.storeType.includes("resto"))&&(this.displayList=!1),this.networkService.initializeNetworkEvents(),this.checkCart(),this.takeUrl(),JSON.parse(localStorage.getItem("user")).name&&(this.userName=JSON.parse(localStorage.getItem("user")).name),this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.tabRoles.includes(8)&&(this.pos=!0),this.languageChanged(),this.tabRoles.includes(5)}languageChanged(){let t=localStorage.getItem("language");t&&this.translateConfigService.setLanguage(t)}checkCart(){this.cartValue=this.restApiService.getCart2(),this.cartValue&&this.cartValue.cart&&(this.totalItems=this.cartValue.cart.totalQty,this.totalPrice=this.cartValue.cart.totalPrice)}takeUrl(){return(0,n.mG)(this,void 0,void 0,function*(){this.urlService.getUrlEvent().pipe((0,l.R)(this.destroy$)).subscribe(t=>(0,n.mG)(this,void 0,void 0,function*(){this.urlEvent=t,this.adminId=localStorage.getItem("adminId"),this.webServerSocket(this.adminId)}))})}ngOnInit(){let t=this.saveRandom.getVoucher();this.voucher=!!t}ionViewWillEnter(){this.tabRoles=JSON.parse(localStorage.getItem("roles")),this.saleToRetailer=this.saveRandom.checkIfIsRetailer(),localStorage.getItem("addFlag")&&(this.flagAdd=localStorage.getItem("addFlag")),this.getCustomerItems()}ionViewWillLeave(){localStorage.getItem("backTo")&&localStorage.removeItem("backTo"),this.saveRandom.isNotRetailer(),this.destroy$.next(),this.destroy$.complete(),this.cartValue=this.restApiService.getCart2(),this.cartValue&&this.cartValue.cart&&this.restApiService.saveCart({})}getCustomerItems(){if(JSON.parse(localStorage.getItem("setting"))){let t=JSON.parse(localStorage.getItem("setting"));Array.isArray(t),Array.isArray(t)?t[0].SaleInPack?(this.checkPack=!0,localStorage.setItem("saleAsPack","true")):this.checkPack=!1:t.SaleInPack?(this.checkPack=!0,localStorage.setItem("saleAsPack","true")):this.checkPack=!1}this.storeTypeTab=JSON.parse(localStorage.getItem("adminUser")).storeType,this.storeTypeTab.forEach((t,e)=>{"services"==t&&(this.storeTypeTab[e]="produits"),"Gammes"==t&&(this.storeTypeTab[e]="Gammes")}),this.pet=this.storeTypeTab[0],this.storeTypeTab.includes("bar"),(this.storeTypeTab.includes("services")||this.storeTypeTab.includes("produits"))&&this.takeGame(),this.storeTypeTab.includes("shop")&&setTimeout(()=>{},1500);let t=JSON.parse(localStorage.getItem("setting"));Array.isArray(t)?t[0].use_gamme&&(this.storeTypeTab.push("Gammes"),this.getAllGamme()):t.use_gamme&&(this.storeTypeTab.push("Gammes"),this.getAllGamme())}cancelAdd(){localStorage.removeItem("order"),localStorage.removeItem("addFlag"),this.flagAdd=!1}getOrdersFromLocalServer(){setInterval(()=>{let t=JSON.parse(localStorage.getItem("user"))._id,e=JSON.stringify({sender:t}),i=this.url+`invoice/ready/to/take?localId=${t}`;this.httpN.setDataSerializer("utf8"),this.httpN.patch(i,e,{}).then(t=>{alert(JSON.parse(JSON.stringify(t)));let e=JSON.parse(t.data);e&&e.length&&this.events.storeOrders(e,"saveAll",[]).then(t=>{})}).catch(t=>{})},2e4)}webServerSocket(t){return(0,n.mG)(this,void 0,void 0,function*(){this.manageSocket.getSocket().subscribe(e=>{e.on(`${t}newProductList`,t=>{});let i=JSON.parse(localStorage.getItem("user")).storeId;e.on("connect",function(){}),e.on(`${this.adminId}productItem`,t=>{}),e.on(`${t}newBill`,t=>{}),e.on(`${t}newSetting`,t=>{setTimeout(()=>{this.cacheService.getCachedRequest("MySettings").then(e=>{e&&(e.company[0]=t,this.cacheService.cacheRequest("MySettings",e))})},2e3)}),e.on(`${t}productItemGlace`,t=>(0,n.mG)(this,void 0,void 0,function*(){})),e.on(`${t}productItemToShop`,t=>(0,n.mG)(this,void 0,void 0,function*(){})),e.on(`${t}manufacturedItem`,t=>(0,n.mG)(this,void 0,void 0,function*(){})),e.on(`${this.adminId}productlist`,t=>{}),e.on(`${this.adminId}billardItem`,t=>{}),e.on(`${this.adminId}${i}billardItem`,t=>{let e=this.productListTab.findIndex(e=>e._id==t._id);e>=0&&(console.log("index===>",e),this.productListTab.splice(e,1,t))}),e.on(`${t}transactionNewItem`,t=>{this.notifi.presentToast("you have new notification","danger"),this.transaction.unshift(t.data)})})})}buyItemGame(t,e){return(0,n.mG)(this,void 0,void 0,function*(){if(t.quantityItems<=0)this.notifi.presentToast("le stock disponible est \xe9gale a 0","danger");else if(this.cartValue=this.restApiService.getCart2(),t.quantityItems>0)if(this.cartValue&&this.cartValue.cart){let i={};t.sc=!0,t.value=e,i.product=t,i.cart=this.cartValue.cart;let s=this.manageCartService.addToCart(i);this.totalItems=s.totalQty,this.totalPrice=s.totalPrice,this.restApiService.saveCart({cart:s,products:s.generateArray()}),parseInt(t.quantityItems)&&(t.quantityItems=t.quantityItems-t.toSale)}else{t.sc=!0,t.value=e;let i=this.manageCartService.addToCart(t);console.log(i),this.totalItems=i.totalQty,this.totalPrice=i.totalPrice,this.restApiService.saveCart({cart:i,products:i.generateArray()}),parseInt(t.quantityItems)&&(t.quantityItems=t.quantityItems-t.toSale)}else console.log("====",t),this.showPresentAlert()})}getCart(){this.cartValue=this.restApiService.getCart()}displayCart(){this.navCtrl.navigateForward("cart")}openCart(){return(0,n.mG)(this,void 0,void 0,function*(){this.notification.presentLoading(),this.saveRandom.setClientType(this.clientType),this.plat.length?localStorage.setItem("plat",JSON.stringify(this.plat)):localStorage.setItem("plat",JSON.stringify([])),this.generateArrayManagerMode();const t=yield this.modalController.create({component:c.V,backdropDismiss:!1});return t.onDidDismiss().then(t=>(0,n.mG)(this,void 0,void 0,function*(){return t.data&&t.data.order?(console.log("==========================retour",t.data),this.confirmAndPrint(t.data.order),this.restApiService.getCart(),this.restApiService.cleanCart(),localStorage.removeItem("order"),localStorage.removeItem("addFlag"),this.flagAdd=!1,this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.plalist=[],this.plalist=[1],this.numPlat=1,this.plat=[],this.numPlatRandom=0,JSON.parse(localStorage.getItem("setting")).use_gamme&&this.gammeListTab.forEach(t=>{t.nbr=0,t.quantityToSale=0}),this.userProducts2&&this.userProducts.length>0&&this.userProducts.forEach(t=>{t.modeG&&(t.modeG=0),t.modeNG&&(t.modeNG=0),t.qty&&(t.qty=0),t.cassierStore=parseInt(t.CA)?t.cassierStore+t.CA:t.cassierStore,t.btlsStore=parseInt(t.BTL)?t.btlsStore+t.BTL:t.btlsStore,t.CA&&(t.CA=0),t.BTL&&(t.BTL=0)}),this.allUserProductsList.forEach(t=>{t.modeG&&(t.modeG=0),t.modeNG&&(t.modeNG=0),t.qty&&(t.qty=0),parseInt(t.CA)||(t.cassierStore=t.cassierStore),parseInt(t.BTL)||(t.btlsStore=t.btlsStore),t.CA&&(t.CA=0),t.BTL&&(t.BTL=0)}),localStorage.getItem("backTo")&&setTimeout(()=>{let t=JSON.parse(localStorage.getItem("backTo"));this.router.navigateByUrl(t.url),localStorage.removeItem("backTo")},2e3),this.packs&&this.packs.length>0&&this.packs.forEach(t=>{t.qty=0}),this.productsGame&&this.productsGame.length>0&&this.productsGame.forEach(t=>{t.qty=0}),this.productResto&&this.productResto.length>0&&(this.productResto.forEach(t=>{t.nbr=0}),this.productResto2=yield this.groupByService.groupArticles(this.productResto)),this.productList&&this.productList.length>0&&this.productList.forEach(t=>{t.forEach(t=>{t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)})}),void(this.productListTab&&this.productListTab.length>0&&this.productListTab.forEach(t=>{t.toSale=0,t.forEach(t=>{t.toSale=0,t.qty&&(t.qty=0),t.nbr&&(t.nbr=0,t.quantityStore=parseInt(t.quantityStore))})}))):void 0===t.data?(JSON.parse(localStorage.getItem("setting")).use_gamme&&this.gammeListTab.forEach(t=>{t.nbr=0,t.quantityToSale=0}),localStorage.getItem("backTo")&&localStorage.removeItem("backTo"),this.randomP&&this.randomP.length&&(this.userProducts2=this.randomP),this.randomList&&this.randomList.length&&(this.productListTab=this.randomList),this.randomResto&&this.randomResto.length&&(this.productResto2=this.randomResto),this.randomShop&&this.randomShop.length&&(this.arrList=this.randomShop),this.events.refresh(),this.restApiService.cleanCart(),this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.plalist=[],this.plalist=[1],this.numPlat=1,this.plat=[],this.numPlatRandom=0,this.userProducts2&&this.userProducts2.length&&this.userProducts2.forEach(t=>{t.forEach(t=>{t.forEach(t=>{t.quantityStore=parseInt(t.modeNG)?t.modeNG+t.quantityStore:t.quantityStore,t.glace=parseInt(t.modeG)?t.modeG+t.glace:t.glace,t.cassierStore=parseInt(t.CA)?t.CA+t.cassierStore:t.cassierStore,t.btlsStore=parseInt(t.BTL)?t.BTL+t.btlsStore:t.btlsStore,t.qty=0,t.modeG=0,t.modeNG=0,t.BTL=0,t.CA=0})})}),this.productsGame.forEach(t=>{t.qty&&(t.qty=0)}),this.productResto.forEach(t=>{t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)}),this.productResto2=yield this.groupByService.groupArticles(this.productResto),this.productList.forEach(t=>{t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)}),void this.productListTab.forEach(t=>{t.toSale=0,t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)})):("true"===localStorage.getItem("manageStockWithService")&&JSON.parse(localStorage.getItem("d")),"update"===t.data?(this.restApiService.getCart(),this.restApiService.cleanCart(),localStorage.removeItem("order"),localStorage.removeItem("addFlag"),this.flagAdd=!1,this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.plalist=[],this.plalist=[1],this.numPlat=1,this.plat=[],this.numPlatRandom=0,JSON.parse(localStorage.getItem("setting")).use_gamme&&this.gammeListTab.forEach(t=>{t.nbr=0,t.quantityToSale=0}),this.userProducts2&&this.userProducts.length>0&&this.userProducts.forEach(t=>{t.modeG&&(t.modeG=0),t.modeNG&&(t.modeNG=0),t.qty&&(t.qty=0),t.cassierStore=parseInt(t.CA)?t.cassierStore+t.CA:t.cassierStore,t.btlsStore=parseInt(t.BTL)?t.btlsStore+t.BTL:t.btlsStore,t.CA&&(t.CA=0),t.BTL&&(t.BTL=0)}),this.allUserProductsList.forEach(t=>{t.modeG&&(t.modeG=0),t.modeNG&&(t.modeNG=0),t.qty&&(t.qty=0),parseInt(t.CA)||(t.cassierStore=t.cassierStore),parseInt(t.BTL)||(t.btlsStore=t.btlsStore),t.CA&&(t.CA=0),t.BTL&&(t.BTL=0)}),localStorage.getItem("backTo")&&setTimeout(()=>{let t=JSON.parse(localStorage.getItem("backTo"));this.router.navigateByUrl(t.url),localStorage.removeItem("backTo")},2e3),this.packs&&this.packs.length>0&&this.packs.forEach(t=>{t.qty=0}),this.productsGame&&this.productsGame.length>0&&this.productsGame.forEach(t=>{t.qty=0}),this.productResto&&this.productResto.length>0&&(this.productResto.forEach(t=>{t.nbr=0}),this.productResto2=yield this.groupByService.groupArticles(this.productResto)),this.productList&&this.productList.length>0&&this.productList.forEach(t=>{t.forEach(t=>{t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)})}),this.productListTab&&this.productListTab.length>0&&this.productListTab.forEach(t=>{t.toSale=0,t.forEach(t=>{t.toSale=0,t.qty&&(t.qty=0),t.nbr&&(t.nbr=0)})}),void setTimeout(()=>{this.location.back()},2e3)):t.data.products&&t.data.products.length?(this.packs.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabPacks(e,i))})}),this.products.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabProducts(e,i))})}),void this.productResto.forEach(e=>{let i=e._id;t.data.products.forEach(t=>{t.item._id==i&&(e.qty=t.qty,this.updateTabProResto(e,i))})})):void("update-cancel"===t.data?(this.restApiService.getCart(),this.restApiService.cleanCart(),localStorage.removeItem("order"),localStorage.removeItem("addFlag"),this.flagAdd=!1,this.totalItems=0,this.totalPrice=0,this.restApiService.saveCart({}),this.productsGame&&this.productsGame.length>0&&this.productsGame.forEach(t=>{t.qty=0}),this.productResto&&this.productResto.length>0&&(this.productResto.forEach(t=>{t.quantityStore=t.nbr+t.quantityStore,t.nbr=0}),this.productResto2=yield this.groupByService.groupArticles(this.productResto)),this.productList&&this.productList.length>0&&this.productList.forEach(t=>{t.forEach(t=>{t.qty&&(t.qty=0),t.nbr&&(t.quantityStore=t.nbr+t.quantityStore,t.nbr=0)})}),this.productListTab&&this.productListTab.length>0&&this.productListTab.forEach(t=>{t.toSale=0,t.forEach(t=>{console.log(t),t.qty&&(t.quantityStore=t.qty+t.quantityStore,t.qty=0),t.nbr&&(t.quantityStore=t.nbr+t.quantityStore,t.nbr=0)})})):(this.totalItems=t.data.cart.totalQty,this.totalPrice=t.data.cart.totalPrice,this.restApiService.saveCart(t.data))))})),yield t.present().then(t=>{this.notification.dismissLoading()})})}presentAlert(){return(0,n.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"Alert",subHeader:"Subtitle",message:"le prix entr\xe9 n.est pas bon.",buttons:["OK"]});yield t.present()})}showPresentAlert(t){return(0,n.mG)(this,void 0,void 0,function*(){if(t){let e="";t.forEach(t=>{e+=` - ${t.name}\n          \n          , \n        `});const i=yield this.alertController.create({header:"NOT ENOUGTH:",message:e.toUpperCase(),buttons:["OK"]});yield i.present()}else{const t=yield this.alertController.create({header:"ALERT",message:"NOT ENOUGTH IN STOCK!\n        please contact wharehouse",cssClass:"AlertStock",buttons:["OK"]});yield t.present()}})}cashDateAlert(){return(0,n.mG)(this,void 0,void 0,function*(){const t=yield this.alertController.create({header:"ALERT",message:"PLEASE OPEN CASH DATE!",cssClass:"AlertStock",buttons:["OK"]});yield t.present()})}updateTabPacks(t,e){let i=t,s=this.packs.findIndex(t=>t._id===e);this.packs.splice(s,1,i)}updateTabProducts(t,e){let i=t,s=this.products.findIndex(t=>t._id===e);this.products.splice(s,1,i)}updateTabProResto(t,e){return(0,n.mG)(this,void 0,void 0,function*(){let i=t,s=this.productResto.findIndex(t=>t._id===e);this.productResto.splice(s,1,i),this.productResto2=yield this.groupByService.groupArticles(this.productResto)})}clearCache(t){this.imageLoader.clearCache()}screenCheck(){this.screensizeService.isDesktopView().pipe((0,l.R)(this.destroy$)).subscribe(t=>{this.isDesktop=t})}takeGame(){return(0,n.mG)(this,void 0,void 0,function*(){this.notification.presentLoading(),this.notification.dismissLoading(),this.restApiService.getBillardList().pipe((0,l.R)(this.destroy$)).subscribe(t=>(0,n.mG)(this,void 0,void 0,function*(){let e=JSON.parse(localStorage.getItem("user")).storeId;this.productListTab=t.product.filter(t=>t.storeId==e).sort((t,e)=>t.name>e.name?1:-1),this.gammeService.setProducts(this.productListTab),this.notification.dismissLoading()}))})}getAllGamme(){return(0,n.mG)(this,void 0,void 0,function*(){let t=JSON.parse(localStorage.getItem("user")).storeId;this.cacheService.getCachedRequest("gammeList").then(e=>{this.gammeListTab=e,this.gammeService.getGammeList().pipe((0,l.R)(this.destroy$)).subscribe(e=>(0,n.mG)(this,void 0,void 0,function*(){e&&(this.gammeListTab=e.filter(e=>e.storeId==t),console.log("les gammes ici ===>",this.gammeListTab))}))}).catch(e=>{this.gammeService.getGammeList().pipe((0,l.R)(this.destroy$)).subscribe(e=>(0,n.mG)(this,void 0,void 0,function*(){console.log(e),e&&(this.gammeListTab=e.filter(e=>e.storeId==t))}))})})}confirmAndPrint(t){return(0,n.mG)(this,void 0,void 0,function*(){console.log("hello data",t),this.saveRandom.setData(t);const e=yield this.modalController.create({component:g.e,backdropDismiss:!0});return e.onDidDismiss().then(t=>(0,n.mG)(this,void 0,void 0,function*(){console.log(t)})),yield e.present().then(t=>{})})}getValueR(t,e){let i=parseInt(t.detail.value);i&&i>e.quantityItems?(e.toSale&&(e.quantityItems=e.quantityItems+e.toSale),e.toSale=0,this.buyItemGame(e,0),this.calculGrammage(e.masse,e),this.notifi.presentToast(`la quantit\xe9 en stock est inf\xe9rieur a ${i}`,"danger")):i&&i>0?(e.toSale=i,this.buyItemGame(e,i),this.calculGrammage(e.masse,e)):0==i?(e.toSale=0,this.buyItemGame(e,i),this.calculGrammage(e.masse,e)):(e.toSale&&(e.quantityItems=e.quantityItems+e.toSale),e.toSale=0,this.randomObj[e._id]&&(delete this.randomObj[e._id],this.generateArrayManagerMode()),this.buyItemGame(e,0))}typeDeClient(t){console.log(t),"SM"==t.detail.value?(this.clientType=t.detail.value,this.productListTab.forEach(t=>{t.randomPrices=t.sellingPrice,t.sellingPrice=t.superMarketPrice})):t.detail.value&&"SM"!==t.detail.value&&(this.clientType=t.detail.value,this.productListTab.forEach(t=>{t.randomPrices&&(t.sellingPrice=t.randomPrices)})),console.log(this.productListTab)}findProductList(t){const e=t.target.value;e&&""!==e.trim()?(this.isItemAvailable3=!0,this.arrList2=this.productListTab.filter(t=>t.name.toLowerCase().indexOf(e.toLowerCase())>-1)):this.isItemAvailable3=!1}segmentChanged(t){return(0,n.mG)(this,void 0,void 0,function*(){this.showMe=!1,this.notification.presentLoading(),this.pet=t.target.value,this.isLoad=!0,setTimeout(()=>{this.showMe=!0,this.notification.dismissLoading()},200)})}buyGamme(t){return(0,n.mG)(this,void 0,void 0,function*(){this.gammeService.setGamme(t);const e=yield this.modalController.create({component:u.W,componentProps:{}});return e.onDidDismiss().then(e=>(0,n.mG)(this,void 0,void 0,function*(){if(e.data&&1==e.data.add){let i=e.data.quantity;console.log(e);for(const c of e.data.gamme.productList)t.productList.find(t=>t._id==c._id)||(console.log("je pousse un nouveau"),t.productList.push(c));let s=e.data.reste,o=!0,a=[],r=[],n=[];if(n=this.productListTab,s.length?s.forEach(t=>{let e=n.findIndex(e=>e._id==t._id);e>=0&&(n[e].quantityItems<t.toRemove*i?(o=!1,a.push(n[e])):n[e].quantityItems=n[e].quantityItems-t.toRemove*i)}):t.productList.forEach(t=>{let e=n.findIndex(e=>e._id==t._id);e>=0?n[e].quantityItems<t.toRemove*i?(o=!1,a.push(n[e])):n[e].quantityItems=n[e].quantityItems-t.toRemove*i:(console.log("not found"),r.push(t))}),t.sellingPrice=e.data.prix,t.removeProductList=this.gammeService.getRemoveProductList(),t.addProductList=this.gammeService.getaddProductList(),r.length)this.notification.cancelSale(r);else{if(!o)return void this.notification.cancelSale(a);for(let s=0;s<i;s++)t.productList=e.data.gamme.productList,yield this.addGammeToCart(t);console.log("=====end here===")}}})),yield e.present()})}addGammeToCart(t){return new Promise((e,i)=>{if(this.cartValue=this.restApiService.getCart2(),this.cartValue&&this.cartValue.cart){let i={};i.product=t,i.cart=this.cartValue.cart;let s=this.manageCartService.addToCart(i);this.totalItems=s.totalQty,this.totalPrice=s.totalPrice,this.restApiService.saveCart({cart:s,products:s.generateArray()}),t.nbr=t.nbr?t.nbr+1:1,e(t)}else{let i=this.manageCartService.addToCart(t);this.totalItems=i.totalQty,this.totalPrice=i.totalPrice,this.restApiService.saveCart({cart:i,products:i.generateArray()}),t.nbr=t.nbr?t.nbr+1:1,e(t)}})}removeIn(t){return(0,n.mG)(this,void 0,void 0,function*(){if(console.log(t),t.nbr>0&&(t.nbr=t.nbr-1),0==t.nbr&&(t.nbr=0),"Gamme"==t.productType){let e=[];this.productListTab.forEach(t=>{e=[...e,...t]}),t.productList&&t.productList.forEach(t=>{let i=e.findIndex(e=>e._id==t._id);i>=0&&(e[i].quantityStore=e[i].quantityStore+1)})}else setTimeout(()=>{this.removeOneItem(t),t.quantityStore=t.quantityStore+1},500)})}removeOneItem(t,e){return(0,n.mG)(this,void 0,void 0,function*(){let i,s=this.restApiService.getCart2();console.log("shop page.ts 1137 ===>",t),i=e?this.manageCartService.removeOneToCart(t._id,s.cart,e):this.manageCartService.removeOneToCart(t._id,s.cart),console.log("shop page.ts 1146 ===>",i),this.totalItems=i.cart.totalQty,this.totalPrice=i.cart.totalPrice,this.restApiService.saveCart({cart:i.cart,products:i.cart.generateArray()})})}calculGrammage(t,e){let i=parseInt(t);i?(delete this.randomObj[e._id],e.grammage=e.toSale*i,this.randomObj[e._id]=e):delete this.randomObj[e._id],this.generateArrayManagerMode()}generateArrayManagerMode(){let t=0;for(var e in this.randomObj)this.randomObj[e].grammage&&(t+=this.randomObj[e].grammage);this.grammage=t,this.saveRandom.setGrammage(this.grammage)}selectZone(t){console.log(t.detail.value);let e=this.zoneList.find(e=>e.name==t.detail.value);console.log(e),this.saveRandom.setZone(e)}}return t.\u0275fac=function(e){return new(e||t)(m.Y36(p.e),m.Y36(f.B),m.Y36(v.w),m.Y36(a.SH),m.Y36(a.IN),m.Y36(a.Br),m.Y36(r.F0),m.Y36(a.HT),m.Y36(S.w),m.Y36(b.t),m.Y36(T.S),m.Y36(a.yF),m.Y36(y.l),m.Y36(A.e2),m.Y36(Z.i),m.Y36(q.j),m.Y36(a.Dh),m.Y36(I.J),m.Y36(a._q),m.Y36(C.t),m.Y36(L.g),m.Y36(P.z),m.Y36(x.n),m.Y36(k.W),m.Y36(G.n),m.Y36(a.t4),m.Y36(_.$),m.Y36(O.i),m.Y36(R.k),m.Y36(N.f),m.Y36(w.K),m.Y36(E.sK),m.Y36(L.g),m.Y36(s.Ye))},t.\u0275cmp=m.Xpm({type:t,selectors:[["app-sc-shop"]],decls:32,vars:8,consts:[["slot","start"],["defaultHref","/start"],[1,"custom-header"],["showCancelButton","focus","type","text","debounce","500",3,"ionChange"],["slot","start","name","man-outline"],["value","REPRESENTANT","interface","popover",3,"ionChange"],["value","RP"],["value","SM"],["value","FR"],["slot","end"],["fill","clear",4,"ngIf"],["id","notification-button","fill","clear",3,"disabled","click"],["color","dark","slot","end","name","cart"],["id","notifications-badge","color","danger"],["scrollable","",3,"value","ngModel","ionChange","ngModelChange",4,"ngIf"],[4,"ngIf"],["fill","clear"],["color","primary"],["scrollable","",3,"value","ngModel","ionChange","ngModelChange"],["class","btnseg","style","text-align: center",3,"value",4,"ngFor","ngForOf"],[1,"btnseg",2,"text-align","center",3,"value"],[1,"header-component"],["size-sm","3","size-md","3","size-lg","3"],[1,"ion-text-center"],["class","data-row data-update","style","font-size: 11px",3,"ngStyle",4,"ngFor","ngForOf"],[1,"data-row","data-update",2,"font-size","11px",3,"ngStyle"],[1,"ion-text-start","ion-text-uppercase","smallSize"],[1,"ion-text-center","ion-text-uppercase","smallSize"],["slot","end","placeholder","Enter ","type","number","debounce","1500",3,"ionChange"],["style","\n        flex-grow: 1;\n        padding-right: 10px;\n        padding-left: 10px;\n        border-right: 2px solid black;\n      ",4,"ngIf"],[2,"flex-grow","1","padding-right","10px","padding-left","10px","border-right","2px solid black"],[2,"font-size","14px","font-weight","bold"],["size","12"],[1,"ion-text-center","ion-text-uppercase"],["size-sm","2","size-md","2","size-lg","2"],["size-sm","2","size-md","2","size-lg","2",4,"ngIf"],["size","4","sizeLg","3","sizeMd","4","sizeSm","6","sizeXs","6",4,"ngFor","ngForOf"],["size","4","sizeLg","3","sizeMd","4","sizeSm","6","sizeXs","6"],[1,"cardimage"],[1,"colstyle"],[1,"badge2"],["slot","end","color","warning",3,"click",4,"ngIf"],[1,"img-container",3,"click"],[3,"src","spinner","isLoad",4,"ngIf"],[1,"divname",2,"text-align","center"],["slot","end","color","warning",3,"click"],[3,"src","spinner","isLoad"],["size","6"],[1,"container","footer2"]],template:function(t,e){1&t&&(m.TgZ(0,"ion-header"),m.TgZ(1,"ion-toolbar"),m.TgZ(2,"ion-buttons",0),m._UZ(3,"ion-back-button",1),m.qZA(),m.TgZ(4,"div",2),m.TgZ(5,"ion-item"),m.TgZ(6,"ion-searchbar",3),m.NdJ("ionChange",function(t){return e.findProductList(t)}),m.qZA(),m.qZA(),m.TgZ(7,"ion-item"),m._UZ(8,"ion-icon",4),m.TgZ(9,"ion-label"),m._uU(10,"Type de client"),m.qZA(),m.TgZ(11,"ion-select",5),m.NdJ("ionChange",function(t){return e.typeDeClient(t)}),m.TgZ(12,"ion-select-option",6),m._uU(13,"R\xe9presentant"),m.qZA(),m.TgZ(14,"ion-select-option",7),m._uU(15,"Super march\xe9"),m.qZA(),m.TgZ(16,"ion-select-option",8),m._uU(17,"Franchise"),m.qZA(),m.qZA(),m.qZA(),m._UZ(18,"ion-item"),m._UZ(19,"ion-item"),m.qZA(),m.TgZ(20,"ion-buttons",9),m.YNc(21,U,3,1,"ion-button",10),m.TgZ(22,"ion-button",11),m.NdJ("click",function(){return e.openCart()}),m._UZ(23,"ion-icon",12),m.TgZ(24,"ion-badge",13),m._uU(25),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.qZA(),m.TgZ(26,"ion-content"),m.YNc(27,M,2,3,"ion-segment",14),m.YNc(28,$,14,1,"div",15),m.YNc(29,D,2,1,"div",15),m.YNc(30,tt,4,1,"div",15),m.qZA(),m.YNc(31,it,12,10,"ion-footer",15)),2&t&&(m.xp6(21),m.Q6J("ngIf",e.grammage>0),m.xp6(1),m.Q6J("disabled",0===e.totalItems),m.xp6(3),m.hij(" ",e.totalItems," "),m.xp6(2),m.Q6J("ngIf",e.storeTypeTab&&e.storeTypeTab.length>1),m.xp6(1),m.Q6J("ngIf",e.isItemAvailable3),m.xp6(1),m.Q6J("ngIf","produits"===e.pet),m.xp6(1),m.Q6J("ngIf","Gammes"===e.pet),m.xp6(1),m.Q6J("ngIf",e.totalItems))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.Ie,a.VI,a.j9,a.gu,a.Q$,a.t9,a.QI,a.n0,s.O5,a.YG,a.yp,a.W2,a.cJ,o.JJ,o.On,s.sg,a.GO,a.jY,a.Nd,a.wI,s.PC,a.pK,a.as,a.PM,a.FN,J.a,a.fr],pipes:[s.H9],styles:[".lesbtn2[_ngcontent-%COMP%]{font-size:50%;text-transform:uppercase}.shopbtn[_ngcontent-%COMP%]{position:relative;left:8px}.col[_ngcontent-%COMP%]{align-items:center;background-color:aqua}.Btnitempack[_ngcontent-%COMP%], .col[_ngcontent-%COMP%]{text-align:center}ion-list[_ngcontent-%COMP%] > .productname[_ngcontent-%COMP%]{text-transform:uppercase;font-weight:700}.title[_ngcontent-%COMP%]{font-size:7px}.spane[_ngcontent-%COMP%], .title[_ngcontent-%COMP%]{font-weight:700}.spane[_ngcontent-%COMP%]{font-size:8px;position:absolute;bottom:70%;background-color:#151615;color:#fff}ion-card[_ngcontent-%COMP%]{box-shadow:none!important}.footer[_ngcontent-%COMP%]{background-color:#fff;padding-top:8%;padding-left:8%;padding-right:8%;position:relative}.footer2[_ngcontent-%COMP%]{background-color:#08d46e;padding:3%;text-align:center}ion-card-content[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#000;padding:1%;text-align:center}.colp[_ngcontent-%COMP%]{font-size:10px;text-transform:uppercase;padding:0}.badge[_ngcontent-%COMP%]{position:absolute;top:7%}.custom-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between}"]}),t})()}];let ot=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.oAB({type:t}),t.\u0275inj=m.cJS({imports:[[r.Bz.forChild(st)],r.Bz]}),t})();var at=i(9547);let rt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.oAB({type:t}),t.\u0275inj=m.cJS({imports:[[s.ez,o.u5,a.Pc,ot,at.G]]}),t})()}}]);