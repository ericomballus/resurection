(self.webpackChunkWebsite=self.webpackChunkWebsite||[]).push([[2772],{2772:(e,t,i)=>{"use strict";i.r(t),i.d(t,{PurchaseVoucherPageModule:()=>Y});var o=i(1511),n=i(6073),s=i(8158),r=i(8777),c=i(4762),l=i(5959),a=i(5416),d=i(994),h=i(1572),g=i(5511),u=i(2874),m=i(5946),Z=i(4375),p=i(731),f=i(2968),v=i(6529),A=i(4418),q=i(1064),y=i(2909);function T(e,t){if(1&e&&(h.TgZ(0,"ion-col",18),h.TgZ(1,"pre"),h._uU(2),h.qZA(),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.lnq("",e.model.day,"/",e.model.month,"/",e.model.year,"")}}function b(e,t){if(1&e&&(h.TgZ(0,"ion-col",18),h.TgZ(1,"pre"),h._uU(2),h.qZA(),h.qZA()),2&e){const e=h.oxw();h.xp6(2),h.lnq("",e.model2.day,"/",e.model2.month,"/",e.model2.year,"")}}function S(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"ion-col",19),h.TgZ(1,"div",20),h.TgZ(2,"ion-button",21),h.NdJ("click",function(){return h.CHM(e),h.oxw().takeInventory()}),h._uU(3," submit"),h.qZA(),h.qZA(),h.qZA()}}function k(e,t){1&e&&(h.TgZ(0,"ion-row",22),h.TgZ(1,"ion-col",3),h.TgZ(2,"div",20),h.TgZ(3,"small"),h._uU(4),h.ALo(5,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(6,"ion-col",3),h.TgZ(7,"div",20),h.TgZ(8,"small"),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(11,"ion-col",3),h.TgZ(12,"div",20),h.TgZ(13,"small"),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(16,"ion-col",23),h._UZ(17,"div",20),h.qZA(),h.qZA()),2&e&&(h.xp6(4),h.Oqu(h.lcZ(5,3,"MENU.date")),h.xp6(5),h.Oqu(h.lcZ(10,5,"MENU.customer")),h.xp6(5),h.Oqu(h.lcZ(15,7,"MENU.amount")))}const w=function(e){return{"background-color":e}},x=function(e){return[e,"FCFA","symbol","3.0-0","fr"]};function C(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"ion-row",24),h.TgZ(1,"ion-col",25),h.TgZ(2,"div",26),h.TgZ(3,"small",27),h._uU(4),h.ALo(5,"date"),h.qZA(),h._UZ(6,"br"),h.TgZ(7,"small",27),h._uU(8),h.ALo(9,"date"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(10,"ion-col",25),h.TgZ(11,"div",26),h.TgZ(12,"small",27),h._uU(13),h.qZA(),h.qZA(),h.qZA(),h.TgZ(14,"ion-col",25),h.TgZ(15,"div",26),h.TgZ(16,"small",27),h._uU(17),h.ALo(18,"currency"),h.qZA(),h.qZA(),h.qZA(),h.TgZ(19,"ion-col",25),h.TgZ(20,"div",26),h.TgZ(21,"ion-button",28),h.NdJ("click",function(){h.CHM(e);const i=t.$implicit,o=t.index;return h.oxw().viewMobileManageOrder(i,o)}),h._uU(22," action "),h.qZA(),h.qZA(),h.qZA(),h.qZA()}if(2&e){const e=t.$implicit;h.Q6J("ngStyle",h.VKq(16,w,t.index%2==0?"#f1f1f1":"white")),h.xp6(4),h.hij(" ",h.lcZ(5,5,e.created),""),h.xp6(4),h.hij(" ",h.xi3(9,7,e.created,"shortTime"),""),h.xp6(5),h.hij(" ",e.customer?e.customer.name:".",""),h.xp6(4),h.hij(" ",h.G7q(18,10,h.VKq(18,x,e.price)),"")}}const U=function(){return{padding:"15px"}},I=[{path:"",component:(()=>{class e{constructor(e,t,i,o,n,s,r,c,a,d,h,g,u,m,Z,p){this.calendar=e,this.notif=t,this.adminService=i,this.saveRandom=o,this.translateConfigService=n,this.alertController=s,this.urlService=r,this.loadingController=c,this.modalController=a,this.router=d,this.screensizeService=h,this.manageSocket=g,this.notifi=u,this.actionSheet=m,this.translate=Z,this.voucherService=p,this.invoices=[],this.montant=0,this.rembourse=0,this.tabRoles=[],this.tabBill=[],this.isLoading=!1,this.printAutorisation=!1,this.destroy$=new l.xQ,this.produitRetour=[]}ngOnInit(){}ionViewWillLeave(){this.destroy$.next(),this.destroy$.complete()}ionViewWillEnter(){this.model=this.calendar.getToday(),this.model2=this.calendar.getToday(),this.getVouchers(),this.screenCheck(),this.setting=this.saveRandom.getSetting(),this.useGamme=this.setting.use_gamme,this.languageChanged();let e=localStorage.getItem("adminId");this.webServerSocket(e)}languageChanged(){let e=localStorage.getItem("language");console.log(e),e&&this.translateConfigService.setLanguage(e)}takeInventory(){let e,t,i;if(this.notifi.presentLoading(),i=`${this.model.year.toString()}`,this.model.day.toString(),e=`${this.model.day+1}`,this.model.month.toString(),t=`${this.model.month}`,new Date(this.model.year,this.model.month,this.model.day).getTime()>new Date(this.model2.year,this.model2.month,this.model2.day).getTime())console.log("impossible"),this.notif.presentError("Sorry, the start date must be less than the end date","danger");else{let e={};e.start=new Date(this.model.year,this.model.month-1,this.model.day+1).toISOString(),e.end=new Date(this.model2.year,this.model2.month-1,this.model2.day+1).toISOString(),e.start==e.end&&(e.start=new Date(this.model.year,this.model.month-1,this.model.day).toISOString())}}getVouchers(){return(0,c.mG)(this,void 0,void 0,function*(){this.notif.presentLoading(),this.voucherService.getPurchaseOrder().subscribe(e=>{this.invoices=e,console.log(this.invoices),this.invoices.forEach((e,t)=>{let i=0;e.toRemove.forEach(e=>{i+=e.totalPrice}),e.price=i,e.customerId&&this.getCustomer(e.customerId,e,t)}),this.notif.dismissLoading()},e=>{this.notif.dismissLoading()})})}screenCheck(){setTimeout(()=>{this.screensizeService.isDesktopView().subscribe(e=>{this.isDesktop=e})},10)}displayDetails(e,t){return(0,c.mG)(this,void 0,void 0,function*(){const i=yield this.modalController.create({component:d.k,componentProps:{order:e,order2:e,Bill:!0},cssClass:"custom-modal"});return i.onDidDismiss().then(e=>{e.data&&e.data.cancel&&this.invoices.splice(t,1,e.data.result)}),yield i.present()})}action(e,t){console.log(e)}webServerSocket(e){let t=this.saveRandom.getStoreId();this.manageSocket.getSocket().pipe((0,a.R)(this.destroy$)).subscribe(i=>{i.on(`${e}billCancel`,e=>{console.log("bill cancel",e)}),i.on(`${e}${t}purchaseOrderChange`,e=>{console.log("purchase order change",e),this.invoices=this.invoices.filter(t=>t._id?t._id!==e._id:t.localId!==e.localId)})})}viewMobileManageOrder(e,t){return(0,c.mG)(this,void 0,void 0,function*(){let i={};this.translate.get("MENU.backCash").subscribe(e=>{i.refundVoucher=e}),this.translate.get("MENU.replacewith").subscribe(e=>{i.replacewith=e}),this.translate.get("MENU.cancel").subscribe(e=>{i.cancel=e}),this.translate.get("MENU.returnProductConfirm").subscribe(e=>{i.returnProduct=e});const o=yield this.actionSheet.create({buttons:[{text:i.refundVoucher+"?",role:"destructive",icon:"eye",handler:()=>{console.log(e),e.posConfirm=!0,e.managerSend=!1,e.repaymentWithCash=!0,this.notifi.presentAlertConfirm(i.returnProduct).then(i=>{e.returnProduct=!0,this.notifi.presentLoading(),this.updateVoucher(e,t)}).catch(i=>{e.returnProduct=!1,this.notifi.presentLoading(),this.updateVoucher(e,t)})}},{text:i.replacewith+"?",role:"destructive",icon:"cash",handler:()=>{e.repaymentWithOtherProducts=!0,console.log(e),this.saveRandom.setVoucher(e),this.router.navigateByUrl("/shop")}},{text:"No",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield o.present();const{role:n}=yield o.onDidDismiss();console.log("onDidDismiss resolved with role",n)})}getCustomer(e,t,i){this.adminService.getOneCustumer(e).subscribe(e=>{console.log(e),t.customer=e,this.invoices[i]=t})}updateVoucher(e,t){this.voucherService.updatePurchaseOrder(e).subscribe(i=>{console.log("result here",t,i),this.invoices=this.invoices.filter(t=>t._id!==e._id),this.notifi.dismissLoading(),this.notifi.presentToast("ok","primary")})}}return e.\u0275fac=function(t){return new(t||e)(h.Y36(g.vL),h.Y36(u.g),h.Y36(m.l),h.Y36(Z.i),h.Y36(p.w),h.Y36(s.Br),h.Y36(f.i),h.Y36(s.HT),h.Y36(s.IN),h.Y36(r.F0),h.Y36(v.j),h.Y36(A.W),h.Y36(u.g),h.Y36(s.BX),h.Y36(q.sK),h.Y36(y.d))},e.\u0275cmp=h.Xpm({type:e,selectors:[["app-purchase-voucher"]],decls:33,vars:9,consts:[["slot","start"],["defaultHref","/start"],[2,"display","none",3,"ngStyle"],["size","3"],[1,"form-inline"],[1,"form-group"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control",2,"display","none",3,"ngModel","ngModelChange"],["d","ngbDatepicker"],[1,"input-group-append"],["fill","clear","size","small","type","button",1,"btn","btn-outline-secondary","calendar",3,"click"],["name","calendar"],["size","3","class","ion-padding ion-align-self-center",4,"ngIf"],["d2","ngbDatepicker"],[1,"ion-align-items-center"],["class","ion-align-self-center",4,"ngIf"],["class","header-row",4,"ngIf"],["class","data-row data-update",3,"ngStyle",4,"ngFor","ngForOf"],["size","3",1,"ion-padding","ion-align-self-center"],[1,"ion-align-self-center"],[1,"ion-text-center"],["size","small",3,"click"],[1,"header-row"],["size","3","size-md","3"],[1,"data-row","data-update",3,"ngStyle"],["size","3",1,"ion-no-margin"],[1,"ion-text-center","ion-text-uppercase","ion-text-nowrap"],[1,"namesmalle2"],["fill","outline",3,"click"]],template:function(e,t){if(1&e){const e=h.EpF();h.TgZ(0,"ion-header"),h.TgZ(1,"ion-toolbar"),h.TgZ(2,"ion-buttons",0),h._UZ(3,"ion-back-button",1),h.qZA(),h.qZA(),h.qZA(),h.TgZ(4,"ion-content"),h.TgZ(5,"div",2),h.TgZ(6,"ion-row"),h.TgZ(7,"ion-col",3),h.TgZ(8,"form",4),h.TgZ(9,"div",5),h.TgZ(10,"div",6),h.TgZ(11,"input",7,8),h.NdJ("ngModelChange",function(e){return t.model=e}),h.qZA(),h.TgZ(13,"div",9),h.TgZ(14,"ion-button",10),h.NdJ("click",function(){return h.CHM(e),h.MAs(12).toggle()}),h._uU(15,"start "),h._UZ(16,"ion-icon",11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.YNc(17,T,3,3,"ion-col",12),h.YNc(18,b,3,3,"ion-col",12),h.TgZ(19,"ion-col",3),h.TgZ(20,"form",4),h.TgZ(21,"div",5),h.TgZ(22,"div",6),h.TgZ(23,"input",7,13),h.NdJ("ngModelChange",function(e){return t.model2=e}),h.qZA(),h.TgZ(25,"div",9),h.TgZ(26,"ion-button",10),h.NdJ("click",function(){return h.CHM(e),h.MAs(24).toggle()}),h._uU(27,"End "),h._UZ(28,"ion-icon",11),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.qZA(),h.TgZ(29,"ion-row",14),h.YNc(30,S,4,0,"ion-col",15),h.qZA(),h.qZA(),h.YNc(31,k,18,9,"ion-row",16),h.YNc(32,C,23,20,"ion-row",17),h.qZA()}2&e&&(h.xp6(5),h.Q6J("ngStyle",h.DdM(8,U)),h.xp6(6),h.Q6J("ngModel",t.model),h.xp6(6),h.Q6J("ngIf",t.model),h.xp6(1),h.Q6J("ngIf",t.model2),h.xp6(5),h.Q6J("ngModel",t.model2),h.xp6(7),h.Q6J("ngIf",t.model&&t.model2),h.xp6(1),h.Q6J("ngIf",t.invoices.length),h.xp6(1),h.Q6J("ngForOf",t.invoices))},directives:[s.Gu,s.sr,s.Sm,s.oU,s.cs,s.W2,o.PC,s.Nd,s.wI,n.Y7,n.JL,n.F,g.J4,n.Fj,n.JJ,n.On,s.YG,s.gu,o.O5,o.sg],pipes:[q.X$,o.uU,o.H9],styles:[""]}),e})()}];let M=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=h.oAB({type:e}),e.\u0275inj=h.cJS({imports:[[r.Bz.forChild(I)],r.Bz]}),e})(),Y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=h.oAB({type:e}),e.\u0275inj=h.cJS({imports:[[o.ez,n.u5,s.Pc,M,g.IJ,q.aw.forChild()]]}),e})()},4418:(e,t,i)=>{"use strict";i.d(t,{W:()=>l});var o=i(1344),n=i.n(o),s=i(8512),r=i(1572),c=i(2968);let l=(()=>{class e{constructor(e){this.urlService=e,this.mysocket=new s.X(null),this.sock=!1,this.takeUrl()}takeUrl(){console.log("je demmare ici url"),this.urlService.getUrl().subscribe(e=>{this.url=e,this.adminId=localStorage.getItem("adminId"),this.sockets=n()(this.url),this.mysocket.next(this.sockets)})}getSocket(){return this.mysocket}disconnectSocket(){this.sockets.disconnect()}getMySocket(){return this.sockets}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(c.i))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);